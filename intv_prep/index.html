<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://rezonated.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rezonated.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rezonated.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://rezonated.github.io/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://rezonated.github.io/apple-touch-icon.png><meta name=description content="A little bit about everything that I have gained and has been useful so far"><title>V's Personal Interview Preparation Note | V's personal site</title><link rel=canonical href=https://rezonated.github.io/intv_prep/><meta property="og:url" content="https://rezonated.github.io/intv_prep/"><meta property="og:site_name" content="V's personal site"><meta property="og:title" content="V's Personal Interview Preparation Note"><meta property="og:description" content="A little bit about everything that I have gained and has been useful so far"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><link rel=stylesheet href=/assets/combined.min.44deaa6678e01a128f508829cd0a154395ad2bd3fb767197239c535cd99516a1.css media=all></head><body class=dark><div class=content><header><div class=header></div></header><main class=main><div class=breadcrumbs><a href=/>~</a><span class=breadcrumbs-separator>/</span>
<a href=/intv_prep/>V's Personal Interview Preparation Note</a></div><div><article><header class=single-intro-container><h1 class=single-title>V's Personal Interview Preparation Note</h1><div class=single-subsummary><div><p class=single-date>&nbsp; Â· &nbsp;150 min read</p></div></div></header><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#fundamentals-and-c>Fundamentals and C++</a><ul><li><a href=#1-scope-and-lifetime>1. Scope and lifetime</a></li><li><a href=#2-automatic-storage-stack-scope>2. Automatic storage (stack scope)</a></li><li><a href=#3-static-storage-static-keyword>3. Static storage (<code>static</code> keyword)</a><ul><li><a href=#3a-static-local-variable>3a. Static local variable</a></li><li><a href=#3b-static-class-member>3b. Static class member</a></li></ul></li><li><a href=#4-raii-resource-acquisition-is-initialization>4. RAII (Resource Acquisition is Initialization)</a></li><li><a href=#5-member-initialization-order>5. Member initialization order</a></li><li><a href=#6-constructors-and-destructors>6. Constructors and Destructors</a><ul><li><a href=#6a-lifecycle>6a. Lifecycle</a></li></ul></li><li><a href=#6b-virtual-destructor>6b. Virtual Destructor</a><ul><li><a href=#6c-initialization-lists-vs-assignment>6c. Initialization lists vs. Assignment</a><ul><li><a href=#option-a-assignment-inside-the-body>Option A: Assignment, inside the body</a></li><li><a href=#option-b-initialization-list-after-the-colon>Option B: Initialization list, after the colon</a></li></ul></li><li><a href=#6d-the-rule-of-three-and-five-lol>6d. The rule of three (and five lol)</a></li><li><a href=#6e-explicit-keyword>6e. <code>explicit</code> keyword</a></li></ul></li><li><a href=#7-stack-and-heap-allocation>7. Stack and Heap allocation</a><ul><li><a href=#7a-the-stack-fast-automatic-but-small>7a. The Stack. Fast, automatic but small</a></li><li><a href=#7b-the-heap-slow-manual-but-large>7b. The Heap. Slow, manual but large</a></li><li><a href=#7c-game-loop>7c. &ldquo;Game Loop&rdquo;</a></li><li><a href=#7d-smart-pointers-modern-c>7d. Smart Pointers (Modern C++)</a></li><li><a href=#7e-the-pointer-chasing-problem>7e. The &ldquo;Pointer-chasing&rdquo; problem</a></li><li><a href=#7f-pro-gamer-move-memory-arena>7f. Pro-gamer move: &ldquo;Memory Arena&rdquo;</a></li></ul></li><li><a href=#8-common-c-containers>8. Common C++ containers</a><ul><li><a href=#8a-stdvector>8a. <code>std::vector</code></a></li><li><a href=#8b-stdlist>8b. <code>std::list</code></a></li><li><a href=#8c-stdmap>8c. <code>std::map</code></a></li><li><a href=#8d-stdunordered_map>8d. <code>std::unordered_map</code></a></li><li><a href=#8e-stdarray>8e. <code>std::array</code></a></li><li><a href=#8f-pro-gamer-move-swap-and-pop-array-unordered-arrayswapback-array>8f. Pro-gamer move: Swap-and-Pop array (Unordered array/Swapback array)</a></li><li><a href=#8g-iterator-invalidation>8g. Iterator Invalidation</a></li></ul></li><li><a href=#9-strings>9. Strings</a><ul><li><a href=#9a-cost-of-stdstring>9a. Cost of <code>std::string</code></a></li><li><a href=#9b-sso-small-string-optimization>9b. SSO (Small String Optimization)</a></li><li><a href=#9c-const-char-vs-stdstring-vs-stdstring_view>9c. <code>const char*</code> vs <code>std::string</code> vs <code>std::string_view</code></a><ul><li><a href=#1const-char-the-c-style-string>1.<code>const char*</code>, the C-Style String</a></li><li><a href=#2-stdstring>2. <code>std::string</code></a></li><li><a href=#3-stdstring_view>3. <code>std::string_view</code></a></li></ul></li><li><a href=#9d-string-hashing>9d. String Hashing</a></li><li><a href=#9e-snprintf--fmt-for-formatting>9e. <code>snprintf() / fmt()</code> for Formatting</a><ul><li><a href=#snprintf-c-style-fast-writes-to-a-stack-buffer><code>snprintf</code> (C-Style). Fast, writes to a stack buffer</a></li><li><a href=#stdformat-c20-type-safe-fast-and-modern><code>std::format</code> (C++20). Type-safe, fast and modern</a></li></ul></li></ul></li><li><a href=#10-alignment-and-padding>10. Alignment and Padding</a><ul><li><a href=#10a-cpu-word-size>10a. CPU word size</a></li><li><a href=#10b-padding-visualizatoin>10b. Padding visualizatoin</a></li><li><a href=#10c-alignof-and-sizeof>10c. <code>alignof</code> and <code>sizeof</code></a></li><li><a href=#10d-cache-lines-the-64-byte-rule>10d. Cache lines (the 64-byte rule)</a></li><li><a href=#10d-simd-single-instruction-multiple-data-alignment-vectorization>10d. SIMD (Single Instruction, Multiple Data) alignment (vectorization)</a><ul><li><a href=#simd-concept>SIMD concept</a></li><li><a href=#alignment-requirement>Alignment requirement</a></li><li><a href=#concrete-example-the-vector-class>Concrete example, the vector class</a></li><li><a href=#heap-allocation-gotcha>Heap allocation gotcha</a></li></ul></li></ul></li><li><a href=#11-v-table-or-how-virtual-functions-work>11. V-Table, or how Virtual Functions work</a></li><li><a href=#12-c-casting>12. C++ casting</a><ul><li><a href=#12a-static_castt>12a. <code>static_cast&lt;T></code></a></li><li><a href=#12b-dynamic_castt>12b. <code>dynamic_cast&lt;T></code></a></li><li><a href=#12c-const_castt>12c. <code>const_cast&lt;T></code></a></li><li><a href=#12d-reinterpret_castt>12d. <code>reinterpret_cast&lt;T></code></a></li><li><a href=#12e-example>12e. Example</a></li></ul></li><li><a href=#13-const-correctness>13. <code>const</code> correctness</a></li><li><a href=#14-special-member-functions-the-implicit-rules>14. Special Member Functions (The Implicit Rules)</a></li><li><a href=#15-crtp-curiously-recurring-template-pattern>15. CRTP (Curiously Recurring Template Pattern)</a></li><li><a href=#16-sfinae-substitution-failure-is-not-an-error>16. SFINAE (Substitution Failure Is Not An Error)</a></li><li><a href=#17-concepts-c20s-replacement-for-sfinae>17. Concepts (C++20&rsquo;s replacement for SFINAE)</a><ul><li><a href=#17a-replacing-sfinae-with-concepts>17a. Replacing SFINAE with concepts</a></li><li><a href=#17b-custom-concepts-aka-duck-typing>17b. Custom Concepts aka. Duck Typing</a></li></ul></li><li><a href=#18-template-metaprogramming-tmp>18. Template Metaprogramming (TMP)</a></li></ul></li><li><a href=#oop-vs-dod>OOP vs DOD</a><ul><li><a href=#1-the-fundamental-difference>1. The fundamental difference</a></li><li><a href=#2-the-hardware-reality-cpu-cache>2. The hardware reality (CPU cache)</a></li><li><a href=#3-when-to-use-oop-vs-dod>3. When to use OOP vs DOD?</a></li><li><a href=#4-converting-oop---dod-code-example>4. Converting OOP -> DOD code example</a></li><li><a href=#4-ecs>4. ECS</a></li><li><a href=#5-parallelization>5. Parallelization</a><ul><li><a href=#5a-oop-concurrency-problem>5a. OOP concurrency problem</a></li><li><a href=#5b-data-parallelism>5b. Data parallelism</a></li><li><a href=#5c-code-example>5c. Code example</a></li><li><a href=#5d-false-sharing>5d. False Sharing</a></li></ul></li></ul></li><li><a href=#ue-specific-notes>UE specific notes</a><ul><li><a href=#1-tick-problem>1. <code>Tick()</code> problem</a></li><li><a href=#2-bp-vs-c>2. BP vs C++</a></li><li><a href=#3-event-driven-architecture>3. Event-driven architecture</a></li><li><a href=#4-timers>4. Timers</a></li><li><a href=#5-significance-manager>5. Significance Manager</a></li><li><a href=#6-cast-vs-interface-soft-reference>6. Cast vs Interface (Soft Reference)</a></li><li><a href=#7-ues-uobject-castt>7. UE&rsquo;s UObject <code>Cast&lt;T></code></a><ul><li><a href=#7a-the-problem-dynamic_cast-vs-castt>7a. The Problem: <code>dynamic_cast</code> vs <code>Cast&lt;T></code></a></li><li><a href=#7b-how-castt-works-the-two-step-process>7b. How <code>Cast&lt;T></code> Works (The Two-Step Process)</a></li><li><a href=#7c-performance-difference-in-editor-vs-shipping>7c. Performance difference in Editor vs. Shipping</a></li><li><a href=#7d-other-cast-types>7d. Other Cast Types</a></li></ul></li><li><a href=#8-modular-architecture>8. Modular Architecture</a><ul><li><a href=#8a-the-concept>8a. The concept</a></li><li><a href=#8b-clean-dependency-rule-via-buildcs>8b. &ldquo;Clean&rdquo; dependency rule via <code>Build.cs</code></a></li><li><a href=#8c-concrete-example-inventory-module>8c. Concrete example, inventory module</a></li></ul></li><li><a href=#9-automation-testing>9. Automation testing</a><ul><li><a href=#9a-unit-testing>9a. Unit testing</a></li><li><a href=#9b-functional-testing-integration-test>9b. Functional Testing (Integration Test)</a></li><li><a href=#9c-running-test-headlessly-cicd-friendly>9c. Running test headlessly (CI/CD-friendly)</a></li></ul></li><li><a href=#10-networking>10. Networking</a><ul><li><a href=#10a-quantization>10a. Quantization</a></li><li><a href=#10b-custom-struct-serialization-netserialize>10b. Custom Struct Serialization (<code>NetSerialize</code>)</a></li><li><a href=#10c-fast-array-serialization-ffastarrayserializer>10c. Fast Array Serialization (<code>FFastArraySerializer</code>)</a></li><li><a href=#10d-replication-graph>10d. Replication Graph</a></li><li><a href=#10e-iris-new-data-oriented-replication-system>10e. Iris, new data-oriented replication system</a></li></ul></li><li><a href=#11-ues-multithreading>11. UE&rsquo;s Multithreading</a><ul><li><a href=#11a-stdmutex--fcriticalsection>11a. <code>std::mutex</code> / <code>FCriticalSection</code></a></li><li><a href=#11b-stdatomic>11b. <code>std::atomic</code></a></li><li><a href=#11c-job-systems-task-graph>11c. Job Systems (Task Graph)</a></li></ul></li></ul></li><li><a href=#finding-and-fixing-framerate-hitches>Finding and Fixing Framerate Hitches</a><ul><li><a href=#1-the-tools-of-the-trade>1. The Tools of the Trade</a></li><li><a href=#2-what-to-see-and-search>2. What to see and search</a><ul><li><a href=#2a-the-game-logic-spike-cpu-bound>2a. The &ldquo;Game Logic&rdquo; Spike (CPU Bound)</a></li><li><a href=#2b-the-garbage-collection-spike-memory-bound>2b. The &ldquo;Garbage Collection&rdquo; Spike (Memory Bound)</a></li><li><a href=#2c-the-render-spike-gpudraw-call-bound>2c. The &ldquo;Render&rdquo; Spike (GPU/Draw Call Bound)</a></li><li><a href=#2d-the-loading-spike-io-bound>2d. The &ldquo;Loading&rdquo; Spike (I/O Bound)</a></li><li><a href=#3-how-to-fix>3. How to fix</a><ul><li><a href=#3a-object-pooling-fixes-spawnactor--gc-spikes>3a. Object Pooling (Fixes SpawnActor & GC Spikes)</a></li><li><a href=#3b-amortization-fixes-tick-spikes>3b. Amortization (Fixes <code>Tick</code> Spikes)</a></li><li><a href=#3c-lods--culling-fixes-render-spikes>3c. LODs & Culling (Fixes <code>Render</code> Spikes)</a></li></ul></li></ul></li></ul></li><li><a href=#debugging-and-crash-analysis>Debugging and Crash Analysis</a><ul><li><a href=#1-unreal-asserts-check-ensure-verify>1. Unreal Asserts: <code>check</code>, <code>ensure</code>, <code>verify</code></a><ul><li><a href=#1a-checkcondition>1a. <code>check(Condition)</code></a></li><li><a href=#1b-ensurecondition>1b. <code>ensure(Condition)</code></a></li><li><a href=#1c-verifycondition>1c. <code>verify(Condition)</code></a></li></ul></li><li><a href=#2-data-breakpoints-the-god-tier-tool>2. Data Breakpoints (The &ldquo;God Tier&rdquo; Tool)</a></li><li><a href=#3-memory-stomps>3. Memory Stomps</a></li><li><a href=#4-reading-a-call-stack>4. Reading a Call Stack</a></li></ul></li><li><a href=#game-math>Game Math</a><ul><li><a href=#1-vectors-the-basics>1. Vectors: The Basics</a></li><li><a href=#1a-lookat-formula>1a. LookAt formula</a></li><li><a href=#1b-normalization>1b. Normalization</a></li><li><a href=#2-the-dot-product>2. The Dot Product</a></li><li><a href=#3-the-cross-product>3. The Cross Product</a></li><li><a href=#4-interpolation-lerp>4. Interpolation (Lerp)</a></li><li><a href=#5-quaternion-vs-euler-angles>5. Quaternion vs Euler Angles</a><ul><li><a href=#5a-euler-angles-frotator>5a. Euler Angles (<code>FRotator</code>)</a></li><li><a href=#5b-quaternions-fquat>5b. Quaternions (<code>FQuat</code>)</a></li><li><a href=#5c-code-example-1>5c. Code example</a></li><li><a href=#5d-misc-things-that-could-caught-you-off-guard-and-conclusion>5d. Misc things that could caught you off-guard and conclusion</a></li></ul></li><li><a href=#6-distance-squared>6. Distance Squared</a></li></ul></li><li><a href=#modular-project-example>Modular project example</a><ul><li><a href=#home>Home</a><ul><li><a href=#introduction>Introduction</a></li><li><a href=#system-architecture>System Architecture</a></li><li><a href=#core-gameplay-loop-casting-and-catching>Core Gameplay Loop: Casting and Catching</a><ul><li><a href=#input-handling>Input Handling</a></li><li><a href=#the-fishing-sequence>The Fishing Sequence</a></li></ul></li><li><a href=#key-components-and-actors>Key Components and Actors</a><ul><li><a href=#uactorcomponent_fishingcomponent><code>UActorComponent_FishingComponent</code></a></li><li><a href=#aactor_fishingrod><code>AActor_FishingRod</code></a></li><li><a href=#aactor_fish><code>AActor_Fish</code></a></li><li><a href=#aactor_fishspawnarea><code>AActor_FishSpawnArea</code></a></li></ul></li><li><a href=#state-and-event-management>State and Event Management</a><ul><li><a href=#gameplay-tags-ffishingtags>Gameplay Tags (<code>FFishingTags</code>)</a></li><li><a href=#game-mode-state-transitions>Game Mode State Transitions</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#getting-started>Getting Started</a><ul><li><a href=#related-pages>Related Pages</a></li></ul></li></ul></li><li><a href=#getting-started-1>Getting Started</a><ul><li><a href=#core-architecture-and-components>Core Architecture and Components</a><ul><li><a href=#key-components>Key Components</a></li></ul></li><li><a href=#gameplay-flow>Gameplay Flow</a><ul><li><a href=#initialization-and-fish-spawning>Initialization and Fish Spawning</a></li><li><a href=#the-casting-process>The Casting Process</a></li><li><a href=#catching-a-fish>Catching a Fish</a></li></ul></li><li><a href=#state-management-and-messaging>State Management and Messaging</a><ul><li><a href=#component-state-machine>Component State Machine</a></li><li><a href=#messaging-system>Messaging System</a></li></ul></li><li><a href=#configuration-via-data-assets>Configuration via Data Assets</a></li><li><a href=#editor-enhancements>Editor Enhancements</a></li><li><a href=#module-overview>Module Overview</a><ul><li><a href=#related-pages-1>Related Pages</a></li></ul></li></ul></li><li><a href=#module-overview-1>Module Overview</a><ul><li><a href=#core-modules>Core Modules</a><ul><li><a href=#module-dependency-diagram>Module Dependency Diagram</a></li></ul></li><li><a href=#gameplay-flow-and-state-management>Gameplay Flow and State Management</a><ul><li><a href=#state-management>State Management</a></li><li><a href=#gameplay-sequence-diagram>Gameplay Sequence Diagram</a></li></ul></li><li><a href=#event-driven-communication>Event-Driven Communication</a><ul><li><a href=#key-gameplay-tags>Key Gameplay Tags</a></li></ul></li><li><a href=#fishing-mechanic-implementation>Fishing Mechanic Implementation</a><ul><li><a href=#class-relationship-diagram>Class Relationship Diagram</a></li><li><a href=#core-components>Core Components</a></li></ul></li><li><a href=#input-handling-1>Input Handling</a></li><li><a href=#editor-customization>Editor Customization</a></li><li><a href=#core-gameplay-classes>Core Gameplay Classes</a><ul><li><a href=#related-pages-2>Related Pages</a></li></ul></li></ul></li><li><a href=#core-gameplay-classes-1>Core Gameplay Classes</a><ul><li><a href=#system-architecture-overview>System Architecture Overview</a></li><li><a href=#agamestatebase_stairwayfishinggame><code>AGameStateBase_StairwayFishingGame</code></a><ul><li><a href=#state-management-1>State Management</a></li></ul></li><li><a href=#agamemodebase_stairwayfishinggame><code>AGameModeBase_StairwayFishingGame</code></a><ul><li><a href=#responding-to-state-changes>Responding to State Changes</a></li><li><a href=#state-transition-flow>State Transition Flow</a></li></ul></li><li><a href=#aplayercontroller_stairwayfishinggameplayercontroller><code>APlayerController_StairwayFishingGamePlayerController</code></a></li><li><a href=#input-handling-2>Input Handling</a></li><li><a href=#apawn_stairwayfishinggame><code>APawn_StairwayFishingGame</code></a><ul><li><a href=#components>Components</a></li><li><a href=#view-switching>View Switching</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#messaging-system-vagameplaymessaging>Messaging System (VAGameplayMessaging)</a><ul><li><a href=#related-pages-3>Related Pages</a></li></ul></li></ul></li><li><a href=#messaging-system-vagameplaymessaging-1>Messaging System (VAGameplayMessaging)</a><ul><li><a href=#core-architecture>Core Architecture</a><ul><li><a href=#component-relationships>Component Relationships</a></li></ul></li><li><a href=#broadcasting-messages>Broadcasting Messages</a><ul><li><a href=#broadcast-flow-diagram>Broadcast Flow Diagram</a></li></ul></li><li><a href=#listening-for-messages>Listening for Messages</a><ul><li><a href=#listener-registration-and-cancellation-flow>Listener Registration and Cancellation Flow</a></li></ul></li><li><a href=#message-structure>Message Structure</a><ul><li><a href=#channels-fgameplaytag>Channels (<code>FGameplayTag</code>)</a></li><li><a href=#payloads-fvaanyunreal>Payloads (<code>FVAAnyUnreal</code>)</a></li></ul></li><li><a href=#lifecycle-management>Lifecycle Management</a></li><li><a href=#key-components-summary>Key Components Summary</a></li><li><a href=#conclusion-1>Conclusion</a></li><li><a href=#fishing-gameplay-loop>Fishing Gameplay Loop</a><ul><li><a href=#related-pages-4>Related Pages</a></li></ul></li></ul></li><li><a href=#fishing-gameplay-loop-1>Fishing Gameplay Loop</a><ul><li><a href=#core-components-1>Core Components</a><ul><li><a href=#component-relationships-1>Component Relationships</a></li></ul></li><li><a href=#state-management-with-gameplay-tags>State Management with Gameplay Tags</a><ul><li><a href=#fishing-component-states>Fishing Component States</a></li><li><a href=#animation-states>Animation States</a></li><li><a href=#state-machine-flow>State Machine Flow</a></li></ul></li><li><a href=#the-fishing-process-step-by-step>The Fishing Process Step-by-Step</a><ul><li><a href=#1-initialization-and-spawning>1. Initialization and Spawning</a></li><li><a href=#2-casting-the-line>2. Casting the Line</a></li><li><a href=#3-throwing-and-waiting>3. Throwing and Waiting</a></li><li><a href=#4-reeling-in-the-catch>4. Reeling In the Catch</a></li><li><a href=#5-success-and-failure>5. Success and Failure</a></li></ul></li><li><a href=#system-communication-and-game-state-flow>System Communication and Game State Flow</a></li><li><a href=#testability>Testability</a></li><li><a href=#player-input-and-controls>Player Input and Controls</a><ul><li><a href=#related-pages-5>Related Pages</a></li></ul></li></ul></li><li><a href=#player-input-and-controls-1>Player Input and Controls</a><ul><li><a href=#architecture-overview>Architecture Overview</a><ul><li><a href=#input-handling-flow>Input Handling Flow</a></li></ul></li><li><a href=#key-components-1>Key Components</a><ul><li><a href=#aplayercontroller_stairwayfishinggameplayercontroller-1>APlayerController_StairwayFishingGamePlayerController</a><ul><li><a href=#initialization-and-mapping>Initialization and Mapping</a></li><li><a href=#iplayeractioninputinterface>IPlayerActionInputInterface</a></li></ul></li><li><a href=#uactorcomponent_fishingcomponent-1>UActorComponent_FishingComponent</a><ul><li><a href=#delegate-binding>Delegate Binding</a></li></ul></li></ul></li><li><a href=#input-mode-management>Input Mode Management</a><ul><li><a href=#state-driven-control>State-Driven Control</a></li></ul></li><li><a href=#configuration-with-data-assets>Configuration with Data Assets</a><ul><li><a href=#related-pages-6>Related Pages</a></li></ul></li></ul></li><li><a href=#configuration-with-data-assets-1>Configuration with Data Assets</a><ul><li><a href=#core-configuration-architecture>Core Configuration Architecture</a></li><li><a href=#fishing-component-configuration>Fishing Component Configuration</a><ul><li><a href=#udataasset_fishingcomponentconfig><code>UDataAsset_FishingComponentConfig</code></a></li></ul></li><li><a href=#fishing-rod-configuration>Fishing Rod Configuration</a><ul><li><a href=#udataasset_fishingrodconfig><code>UDataAsset_FishingRodConfig</code></a></li></ul></li><li><a href=#fish-actor-configuration>Fish Actor Configuration</a><ul><li><a href=#udataasset_actorfishconfig><code>UDataAsset_ActorFishConfig</code></a></li></ul></li><li><a href=#fish-spawning-configuration>Fish Spawning Configuration</a><ul><li><a href=#udataasset_fishspawnareaconfig><code>UDataAsset_FishSpawnAreaConfig</code></a></li><li><a href=#asynchronous-spawning-flow>Asynchronous Spawning Flow</a></li></ul></li><li><a href=#conclusion-2>Conclusion</a></li><li><a href=#ui-widgets>UI Widgets</a><ul><li><a href=#related-pages-7>Related Pages</a></li></ul></li></ul></li><li><a href=#ui-widgets-1>UI Widgets</a><ul><li><a href=#ui-architecture-overview>UI Architecture Overview</a><ul><li><a href=#key-ui-widgets>Key UI Widgets</a></li></ul></li><li><a href=#cast-meter-bar>Cast Meter Bar</a><ul><li><a href=#initialization-and-state>Initialization and State</a></li><li><a href=#event-listening-and-data-flow>Event Listening and Data Flow</a></li></ul></li><li><a href=#fishing-done-screen>Fishing Done Screen</a><ul><li><a href=#visibility-control>Visibility Control</a></li><li><a href=#ui-message-subscriptions>UI Message Subscriptions</a></li></ul></li><li><a href=#functional-testing>Functional Testing</a><ul><li><a href=#related-pages-8>Related Pages</a></li></ul></li></ul></li><li><a href=#functional-testing-1>Functional Testing</a><ul><li><a href=#test-framework-architecture>Test Framework Architecture</a><ul><li><a href=#base-test-class-afunctionaltest_fishingfeaturetest>Base Test Class: AFunctionalTest_FishingFeatureTest</a></li><li><a href=#test-execution-flow>Test Execution Flow</a></li></ul></li><li><a href=#test-scenarios>Test Scenarios</a><ul><li><a href=#able-to-catch-fish-test>Able to Catch Fish Test</a></li><li><a href=#reel-in-test>Reel In Test</a></li></ul></li></ul></li><li><a href=#summary-1>Summary</a></li></ul></li></ul></nav></aside><div class=single-content><p>Wow you found this page, welcome! It&rsquo;s either you;</p><ul><li>Typed the correct URL (if that&rsquo;s the case, congrats!)</li><li>One of people that I trust and owe something to, so I hope this can help and paid a bit of something I owed</li></ul><p>Here&rsquo;s my personal interview preparation note. It started as an old note that I wrote back in college as a fresh-graduate, found in an old hard drive</p><p>But I decided to improve the whole thing by fact-checking and adding some things that either actually get asked in the interview or things that I learned, gained and experienced during my ~4+ years of career thus far</p><p><em>// TODO: Visualize several things with three.js just like <a href=../posts/1000_boids>1000 boids</a> article?</em></p><h1 class=heading id=fundamentals-and-c>Fundamentals and C++
<a class=anchor href=#fundamentals-and-c>#</a></h1><h2 class=heading id=1-scope-and-lifetime>1. Scope and lifetime
<a class=anchor href=#1-scope-and-lifetime>#</a></h2><ul><li><strong>Scope</strong>: Where the variable is <em>visible</em> (where you can type its name and the compiler knows what it is)</li><li><strong>Lifetime</strong>: When the variable actually <em>exists</em> in the memory</li></ul><p>Usually these overlaps, <em>but not always</em></p><p>Example of mismatch: If an object gets created on the <em>Heap</em> via <code>new</code> keyword, the pointer variable <em>might go out of scope</em> (you can&rsquo;t see it anymore), but the object itself has an infinite <strong>lifetime</strong>, until you explicitly <em>delete</em> it. Typically this is called <strong>a memory leak</strong></p><h2 class=heading id=2-automatic-storage-stack-scope>2. Automatic storage (stack scope)
<a class=anchor href=#2-automatic-storage-stack-scope>#</a></h2><p>Default behavior for variables declared inside functions or code blocks <code>{}</code></p><p>Object is created when execution reaches the declaration. It is <strong>automatically destroyed</strong> when execution reaches the closing curly brace <code>}</code> of that block</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    Player() { std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Player Created</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>~</span>Player() { std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Player Destroyed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>GameLoop</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Start Loop</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// Scope 1: The Function Body
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    Player p1; <span style=color:#6272a4>// Created here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#6272a4>// Scope 2: A nested block (e.g., inside an if statement)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Entering Block</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        Player p2; <span style=color:#6272a4>// Created here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Leaving Block</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    } <span style=color:#6272a4>// &lt;--- p2 is DESTROYED here immediately. p1 is still alive.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;End Loop</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>} <span style=color:#6272a4>// &lt;--- p1 is DESTROYED here.
</span></span></span></code></pre></div><p>Understand that <code>p2</code> does not exist outside that small block. Typically we often use <code>{}</code> blocks to specifically force an object (like a temporary texture or mutex lock) to die early to free up resources</p><h2 class=heading id=3-static-storage-static-keyword>3. Static storage (<code>static</code> keyword)
<a class=anchor href=#3-static-storage-static-keyword>#</a></h2><h3 class=heading id=3a-static-local-variable>3a. Static local variable
<a class=anchor href=#3a-static-local-variable>#</a></h3><p>A variable inside a function that gets marked as <code>static</code> is initialized <strong>only once</strong>, the first time the code runs and it <strong>retains its value</strong> between function calls. Its lifetime is the entire program execution</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>GetNextID</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#6272a4>// This line runs ONLY the first time GetNextID is called
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>static</span> <span style=color:#8be9fd>int</span> counter <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    counter<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>return</span> counter;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4>// Usage:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// GetNextID() -&gt; returns 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>// GetNextID() -&gt; returns 2 (It remembers!)
</span></span></span></code></pre></div><h3 class=heading id=3b-static-class-member>3b. Static class member
<a class=anchor href=#3b-static-class-member>#</a></h3><p>A variable in a class marked <code>static</code> is shared <strong>by all instances</strong> of that class. It is not stored inside the object itself</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Enemy</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#ff79c6>static</span> <span style=color:#8be9fd>int</span> EnemyCount; <span style=color:#6272a4>// Declaration
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    Enemy() { EnemyCount<span style=color:#ff79c6>++</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>~</span>Enemy() { EnemyCount<span style=color:#ff79c6>--</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4>// Definition (must be done outside the class, usually in .cpp)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>int</span> Enemy<span style=color:#ff79c6>::</span>EnemyCount <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>// If you spawn 50 Enemy objects, there is still only ONE &#34;EnemyCount&#34; variable in memory.
</span></span></span></code></pre></div><h2 class=heading id=4-raii-resource-acquisition-is-initialization>4. RAII (Resource Acquisition is Initialization)
<a class=anchor href=#4-raii-resource-acquisition-is-initialization>#</a></h2><p>Stupid name. But arguably one of the most important concept in modern C++. It relies entirely on Scope and Lifetime</p><p>The concept: You <em>acquire a resource</em> (open a file, allocate memory, lock a thread) in the <strong>Constructor</strong> and you <em>release it</em> in the <strong>Destructor</strong>. C++ guarantees destructors run when a stack object goes out of scope, this subsequently prevents leaks</p><p><strong>=== BAD CODE ===</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>ProcessFile</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    FILE<span style=color:#ff79c6>*</span> f <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;data.txt&#34;</span>, <span style=color:#f1fa8c>&#34;r&#34;</span>); <span style=color:#6272a4>// Acquire
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>f) <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// ... do work ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (ErrorDetected) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#ff79c6>return</span>; <span style=color:#6272a4>// DANGER! We returned without closing &#39;f&#39;. Resource leak!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    fclose(f); <span style=color:#6272a4>// Release
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p><strong>=== GOOD CODE ===</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>FileHandler</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    FILE<span style=color:#ff79c6>*</span> f;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    FileHandler(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> name) { f <span style=color:#ff79c6>=</span> fopen(name, <span style=color:#f1fa8c>&#34;r&#34;</span>); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>~</span>FileHandler() { <span style=color:#ff79c6>if</span>(f) fclose(f); } <span style=color:#6272a4>// Destructor handles cleanup
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>ProcessFile</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    FileHandler myFile(<span style=color:#f1fa8c>&#34;data.txt&#34;</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// ... do work ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (ErrorDetected) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#ff79c6>return</span>; <span style=color:#6272a4>// SAFE. myFile goes out of scope, destructor runs, file closes.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><p>Typically this proves that you know how to write &ldquo;exception safe&rdquo; code. If the game crashes or throws an error, RAII ensures you don&rsquo;t leave any memory leaks behind</p><h2 class=heading id=5-member-initialization-order>5. Member initialization order
<a class=anchor href=#5-member-initialization-order>#</a></h2><p>Class members are initialized in the order they are <strong>declared in the header file</strong>, <em>NOT</em> the order they appear in the constructor&rsquo;s initialization list. This is often the trap that catches me off-guard</p><p><strong>The trap:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>BadClass</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>int</span> y;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#8be9fd>int</span> x; <span style=color:#6272a4>// Declared SECOND
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#6272a4>// Constructor attempts to init x first, then use x to init y.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Looks fine here...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>    BadClass(<span style=color:#8be9fd>int</span> val) <span style=color:#ff79c6>:</span> x(val), y(x <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>2</span>) {} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>};
</span></span></code></pre></div><p><strong>The bug:</strong></p><ul><li>The compiler looks at the header</li><li><code>y</code> is declared first</li><li>It initializes <code>y</code> first</li><li>It tries to set <code>y = x * 2</code></li><li><strong>BUT <code>x</code> hasn&rsquo;t been initialized yet!</strong> it contains garbage memory</li><li><code>y</code> becomes garbage value</li><li>Then <code>x</code> is initialized</li></ul><p>To fix, always keep initialization list in the same order as your variable declarations. Most compilers will actually warn you about this (<code>-Wreorder</code>)</p><h2 class=heading id=6-constructors-and-destructors>6. Constructors and Destructors
<a class=anchor href=#6-constructors-and-destructors>#</a></h2><h3 class=heading id=6a-lifecycle>6a. Lifecycle
<a class=anchor href=#6a-lifecycle>#</a></h3><ul><li><strong>Constructor (<code>MyClass()</code>)</strong>: Called automatically when an object is created. It sets up the &ldquo;invariant&rdquo; (state required for the object to function)</li><li><strong>Destructor (<code>~MyClass()</code>)</strong>: Called automatically when an object is destroyed, either due to eithergoes out of scope or <code>delete</code> is explicitly called</li></ul><p>It&rsquo;s a good idea to avoid heavy logic in Constructors. Why? C++ constructors cannot return error codes. Let&rsquo;s say if loading a texture fails inside a constructor, you have to throw an exception (which many game engines disable) or leave the object in an invalid &ldquo;zombie&rdquo; state</p><p>Safe pattern: Lightweight constructor + an <code>Init()</code> function that returns a <code>bool</code> for success/failure</p><h2 class=heading id=6b-virtual-destructor>6b. Virtual Destructor
<a class=anchor href=#6b-virtual-destructor>#</a></h2><p>Say you have a Base class <code>Enemy</code>, and a derived class <code>Boss</code>. You are holding a pointer to the <strong>Base</strong> class, but <em>it points</em> to the <strong>derived object</strong></p><p><strong>The trap:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Enemy</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    Enemy() { std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Enemy Created</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// NON-VIRTUAL Destructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>~</span>Enemy() { std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Enemy Destroyed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; } 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Boss</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> Enemy {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#8be9fd>int</span><span style=color:#ff79c6>*</span> heavyData;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    Boss() { heavyData <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[<span style=color:#bd93f9>1000</span>]; std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Boss Created</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>~</span>Boss() { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#ff79c6>delete</span>[] heavyData; <span style=color:#6272a4>// Cleanup
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Boss Destroyed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>KillEnemy</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#6272a4>// Polymorphism: Base pointer holding Derived object
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>    Enemy<span style=color:#ff79c6>*</span> e <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Boss(); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// ... game logic ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#ff79c6>delete</span> e; <span style=color:#6272a4>// &lt;--- PROBLEM HERE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>This essentially makes it so that if <code>~Enemy()</code> is <strong>not</strong> marked as <code>virtual</code>, the compiler only looks at the pointer of type <code>Enemy*</code>. It calls <code>~Enemy()</code>, but <strong>it never calls <code>~Boss()</code></strong>. Thus, <code>heavyData</code> array in <code>Boss</code> never gets deleted, causing memory leak</p><p><strong>The fix:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Enemy</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#ff79c6>~</span>Enemy() { std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Enemy Destroyed</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>};
</span></span></code></pre></div><p>Simple enough. Now, <code>delete e</code> looks up the <code>vtable</code> and sees that the object is actually a <code>Boss</code>. Subsequently calls <code>~Boss()</code> first, followed by <code>~Enemy()</code></p><h3 class=heading id=6c-initialization-lists-vs-assignment>6c. Initialization lists vs. Assignment
<a class=anchor href=#6c-initialization-lists-vs-assignment>#</a></h3><p>There are two ways to give values to member variables in a constructor. One is faster; the other is sometimes impossible</p><h4 class=heading id=option-a-assignment-inside-the-body>Option A: Assignment, inside the body
<a class=anchor href=#option-a-assignment-inside-the-body>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    std<span style=color:#ff79c6>::</span>string name;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    Player(std<span style=color:#ff79c6>::</span>string n) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        name <span style=color:#ff79c6>=</span> n; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>};
</span></span></code></pre></div><ul><li><code>name</code> is default constructed (empty string created)</li><li>The assignment operator is called to copy <code>n</code> into <code>name</code></li><li>The temporary string is destroyed</li></ul><p><strong>We&rsquo;re wasting CPU cycles creating an empty string, just to overwrite it immediately</strong></p><h4 class=heading id=option-b-initialization-list-after-the-colon>Option B: Initialization list, after the colon
<a class=anchor href=#option-b-initialization-list-after-the-colon>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    std<span style=color:#ff79c6>::</span>string name;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    Player(std<span style=color:#ff79c6>::</span>string n) <span style=color:#ff79c6>:</span> name(n) { <span style=color:#6272a4>// &lt;--- This is the list
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Body is empty
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>};
</span></span></code></pre></div><p>Now, <code>name</code> is <strong>copy constructed</strong> directly from <code>n</code>. More efficient since we no longer waste CPU cycle for creating empty string</p><p>It&rsquo;s almost always a good idea to use initialization lists for:</p><ul><li><code>const</code> members, since they cannot be assigned to later</li><li>Reference members (<code>int& ref</code>, etc.), since they must be bound upon creation</li><li>Objects without default constructors. If a member class requires arguments to be built, you must pass them in the list</li></ul><h3 class=heading id=6d-the-rule-of-three-and-five-lol>6d. The rule of three (and five lol)
<a class=anchor href=#6d-the-rule-of-three-and-five-lol>#</a></h3><p>This relates to how C++ handles copying objects. By default, C++ <strong>does a shallow copy</strong>, which just copies the bits</p><p>It creates a problem, if your class manages a raw pointer (i.e., to a texture or an array), a shallow copy <em>copies the address</em>, not the data itself</p><p>Hypotetically, it goes like this:</p><ul><li>Obj A is created. Allocates memory at address <code>0x123</code></li><li>Obj B is created as <em>a copy of A</em>. It <em>also points to <code>0x123</code></em></li><li>Obj A is destroyed, deletes <code>0x123</code></li><li>Obj B is destroyed as well, it tries to delete <code>0x123</code> <strong>again</strong></li><li>Crash, double free error</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;algorithm&gt;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// For std::copy
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Buffer</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#8be9fd>int</span><span style=color:#ff79c6>*</span> data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    size_t size;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// 1. Constructor (Resource Acquisition)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    Buffer(size_t s) <span style=color:#ff79c6>:</span> size(s) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[size]; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        <span style=color:#6272a4>// Fill with dummy data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>for</span>(size_t i<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>; i<span style=color:#ff79c6>&lt;</span>size; <span style=color:#ff79c6>++</span>i) data[i] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#6272a4>// 2. Destructor (Resource Release)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>~</span>Buffer() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#ff79c6>delete</span>[] data; <span style=color:#6272a4>// If we didn&#39;t implement Copy logic, this would crash on copy!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#6272a4>// 3. Copy Constructor (Deep Copy)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Called when: Buffer b = a;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    Buffer(<span style=color:#ff79c6>const</span> Buffer<span style=color:#ff79c6>&amp;</span> other) <span style=color:#ff79c6>:</span> size(other.size) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        <span style=color:#6272a4>// A. Allocate NEW memory
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>        data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[size];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        <span style=color:#6272a4>// B. Copy the VALUES (Deep Copy), not the pointer
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>copy(other.data, other.data <span style=color:#ff79c6>+</span> size, data);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#6272a4>// 4. Copy Assignment Operator (Deep Copy)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Called when: b = a; (Both already exist)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4></span>    Buffer<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(<span style=color:#ff79c6>const</span> Buffer<span style=color:#ff79c6>&amp;</span> other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>        <span style=color:#6272a4>// A. Self-assignment check (Critical!)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// If someone writes &#34;a = a;&#34;, we shouldn&#39;t delete our own data.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span> <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>&amp;</span>other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>        <span style=color:#6272a4>// B. Clean up OLD memory
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>delete</span>[] data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>        <span style=color:#6272a4>// C. Allocate NEW memory and Copy
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#6272a4></span>        size <span style=color:#ff79c6>=</span> other.size;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>        data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[size];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>        std<span style=color:#ff79c6>::</span>copy(other.data, other.data <span style=color:#ff79c6>+</span> size, data);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>        <span style=color:#6272a4>// D. Return *this to allow chaining (a = b = c)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>};
</span></span></code></pre></div><p><strong>The rule of three</strong>: If you need to define a custom <strong>Destructor</strong> (to delete memory), you almost certainly <em>also</em> need to define a custom <strong>Copy Constrcutor</strong> and <strong>Copy Assignment Operator</strong> to handle <strong>Deep Copies</strong> (allocating new memory for the copy)</p><p>Now with modern C++, there&rsquo;s <strong>the rule of five</strong>: For performance sake, we also add:</p><ul><li><strong>Move Constructor</strong>, instead of copying data, we <em>&ldquo;steal&rdquo;</em> the pointer from the temporary object that is about to die anyway</li><li><strong>Move assignment operator</strong></li></ul><p>Typically this is called move semantics</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Buffer</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#6272a4>// ... (Previous Rule of Three code goes here) ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#6272a4>// 5. Move Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Called when: Buffer b = std::move(a);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Note: &#39;other&#39; is not const, because we are going to modify it.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    Buffer(Buffer<span style=color:#ff79c6>&amp;&amp;</span> other) <span style=color:#ff79c6>noexcept</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#ff79c6>:</span> data(<span style=color:#ff79c6>nullptr</span>), size(<span style=color:#bd93f9>0</span>) <span style=color:#6272a4>// Initialize self to empty
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#6272a4>// A. Steal the resources
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>        data <span style=color:#ff79c6>=</span> other.data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        size <span style=color:#ff79c6>=</span> other.size;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// B. Null out the source (So its destructor deletes nothing)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        other.data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>nullptr</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        other.size <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#6272a4>// 6. Move Assignment Operator
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Called when: b = std::move(a);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>    Buffer<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(Buffer<span style=color:#ff79c6>&amp;&amp;</span> other) <span style=color:#ff79c6>noexcept</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// A. Self-assignment check
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>this</span> <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>&amp;</span>other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#6272a4>// B. Clean up OUR old memory (We are being overwritten)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>delete</span>[] data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>        <span style=color:#6272a4>// C. Steal resources
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>        data <span style=color:#ff79c6>=</span> other.data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        size <span style=color:#ff79c6>=</span> other.size;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        <span style=color:#6272a4>// D. Null out the source
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4></span>        other.data <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>nullptr</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>        other.size <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>};
</span></span></code></pre></div><p><strong>Pro-gamer move</strong>: There&rsquo;s this trick called <strong>Copy-and-Swap</strong>. It simplifies above rules by reusing code and providing strong exception safety. Albeit with an addition of a <code>swap()</code> function</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Buffer</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>int</span><span style=color:#ff79c6>*</span> data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    size_t size;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    Buffer(size_t s) <span style=color:#ff79c6>:</span> size(s), data(<span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[s]) {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// Destructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>~</span>Buffer() { <span style=color:#ff79c6>delete</span>[] data; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// Copy Constructor (Same as before)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    Buffer(<span style=color:#ff79c6>const</span> Buffer<span style=color:#ff79c6>&amp;</span> other) <span style=color:#ff79c6>:</span> size(other.size), data(<span style=color:#ff79c6>new</span> <span style=color:#8be9fd>int</span>[other.size]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        std<span style=color:#ff79c6>::</span>copy(other.data, other.data <span style=color:#ff79c6>+</span> size, data);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// Move Constructor (Same as before)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    Buffer(Buffer<span style=color:#ff79c6>&amp;&amp;</span> other) <span style=color:#ff79c6>noexcept</span> <span style=color:#ff79c6>:</span> data(<span style=color:#ff79c6>nullptr</span>), size(<span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        swap(<span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>, other);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// FRIEND SWAP FUNCTION
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Swaps the guts of two objects efficiently
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>friend</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>swap</span>(Buffer<span style=color:#ff79c6>&amp;</span> first, Buffer<span style=color:#ff79c6>&amp;</span> second) <span style=color:#ff79c6>noexcept</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        <span style=color:#ff79c6>using</span> std<span style=color:#ff79c6>::</span>swap;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        swap(first.size, second.size);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        swap(first.data, second.data);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#6272a4>// UNIFIED ASSIGNMENT OPERATOR
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Handles BOTH Copy-Assign and Move-Assign!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Notice the parameter is passed by VALUE (creates a copy or move automatically)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4></span>    Buffer<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(Buffer other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>        <span style=color:#6272a4>// Swap our (old) data with the copy&#39;s (new) data.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// When &#39;other&#39; goes out of scope at the end of this function,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// the destructor cleans up our old data automatically.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4></span>        swap(<span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>, other);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>};
</span></span></code></pre></div><h3 class=heading id=6e-explicit-keyword>6e. <code>explicit</code> keyword
<a class=anchor href=#6e-explicit-keyword>#</a></h3><p>Prevents accidental type conversion that can cause weird-ass bugs</p><p><strong>The trap:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Health</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>// Constructor that takes ONE argument
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    Health(<span style=color:#8be9fd>int</span> hp) { ... } 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>HealPlayer</span>(Health h) { ... }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4>// Usage
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>HealPlayer(<span style=color:#bd93f9>50</span>); <span style=color:#6272a4>// &lt;--- This compiles!
</span></span></span></code></pre></div><p>Compiler sees you passed an <code>int</code> (50), sees <code>Health</code> has a constructor that takes an <code>int</code>, and <strong>implicitly</strong> converts 50 into a <code>Health</code> object. This is often confusing and likely unintended</p><p><strong>The fix:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Health</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>explicit</span> Health(<span style=color:#8be9fd>int</span> hp) { ... }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>HealPlayer(<span style=color:#bd93f9>50</span>); <span style=color:#6272a4>// Compiler Error!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>HealPlayer(Health(<span style=color:#bd93f9>50</span>)); <span style=color:#6272a4>// Allowed. You must be explicit.
</span></span></span></code></pre></div><h2 class=heading id=7-stack-and-heap-allocation>7. Stack and Heap allocation
<a class=anchor href=#7-stack-and-heap-allocation>#</a></h2><h3 class=heading id=7a-the-stack-fast-automatic-but-small>7a. The Stack. Fast, automatic but small
<a class=anchor href=#7a-the-stack-fast-automatic-but-small>#</a></h3><p>Think of The Stack like a <em>stack</em> of plates. <strong>You can only add to the top, and take off the top</strong>.</p><ul><li>Allocation is extremely fast. The CPU internally just moves a pointer, the &ldquo;Stack Pointer&rdquo; down to make a room. Typically only cost one CPU instruction</li><li>Deallocation is also extremely fast. The CPU moves the pointer back up. The memory is &ldquo;freed&rdquo; instantly</li><li>Lifetime is stricly tied to scope blocks <code>{}</code></li><li>Size limit is very small, usually 1-8MB depending on the OS</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdatePlayer</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#6272a4>// Stack Allocation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 1. Fast.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 2. Automatically deleted when function ends.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    Vector3 position <span style=color:#ff79c6>=</span> {<span style=color:#bd93f9>10.0f</span>, <span style=color:#bd93f9>20.0f</span>, <span style=color:#bd93f9>30.0f</span>}; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#8be9fd>int</span> health <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>100</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// If you create a huge array here, you get a &#34;Stack Overflow&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// double hugeArray[1000000]; // &lt;--- CRASH
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h3 class=heading id=7b-the-heap-slow-manual-but-large>7b. The Heap. Slow, manual but large
<a class=anchor href=#7b-the-heap-slow-manual-but-large>#</a></h3><p>Also called the &ldquo;Free Store&rdquo;, a giant pool of unstructured memory</p><ul><li>Allocation is slow. When calling <code>new</code> or <code>malloc</code>, the OS <strong>has to search</strong> through The Heap to find a continous block of empty memory that fits the request. This takes time</li><li>Deallocation is slow and manual, must explicity call <code>delete</code> or <code>free</code></li><li>Lifetime persists until explicitly destroy it</li><li>Size limit depends on the physical RAM</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>CreateLevel</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#6272a4>// Heap Allocation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 1. Slower (OS has to find space).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 2. Must be manually deleted.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    Enemy<span style=color:#ff79c6>*</span> boss <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Enemy(); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#6272a4>// ... game runs ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>delete</span> boss; <span style=color:#6272a4>// If you forget this -&gt; Memory Leak.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h3 class=heading id=7c-game-loop>7c. &ldquo;Game Loop&rdquo;
<a class=anchor href=#7c-game-loop>#</a></h3><p>Never allocate on The Heap, inside the main Game Loop (<code>Tick()</code>/<code>Update()</code>). Why?</p><ul><li><code>new</code> is slow. Doing it 60 times/second (or 1000x a frame for particle systems, perhaps) definitely kills framerate</li><li>Fragmentation, imagine The Heap as a block of Swiss Cheese<ul><li>Allocate 10 bytes, then 20, then 10</li><li>You delete the middle (20 bytes one)</li><li>You now have a &ldquo;hole&rdquo;</li><li>If you then later try to allocate 30 bytes, you can&rsquo;t fit it in the hole. You have to go to the end and then <em>re-allocate</em></li><li>Over hours of gameplay, The Heap becomes a mess of tiny holes (fragmentation), and eventually could cause an out of memory crash even if you technically still have free RAM</li></ul></li></ul><p>Then, when should we use Heap? Use heap for large assets, like textures or levels or objects that need to live longer than the current function scope</p><p>However, avoid Heap allocation inside game loop calls to prevent fragmentation and CPU spikes. For temporary data in a frame, prefer the stack</p><h3 class=heading id=7d-smart-pointers-modern-c>7d. Smart Pointers (Modern C++)
<a class=anchor href=#7d-smart-pointers-modern-c>#</a></h3><p>Since manual <code>delete</code> calls are error-prone, Modern C++ (>= C++11) introduced smart pointers</p><ol><li><code>std::unique_ptr</code></li></ol><ul><li>Owns the object <code>exclusively</code>, when the pointer goes out of scope, it automatically calls <code>delete</code> on the object</li><li>Overhead is <em>almost</em> zero, it&rsquo;s just a wrapper around a raw pointer</li><li>I&rsquo;d suggest to use this by default for heap objects</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;memory&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>SpawnEnemy</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// Creates an Enemy on the heap, wrapped in a unique_ptr
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>unique_ptr<span style=color:#ff79c6>&lt;</span>Enemy<span style=color:#ff79c6>&gt;</span> e <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>make_unique<span style=color:#ff79c6>&lt;</span>Enemy<span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    e<span style=color:#ff79c6>-&gt;</span>Attack();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// No need to call delete! 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// When &#39;e&#39; goes out of scope here, the Enemy is deleted.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><ol start=2><li><code>std::shared_ptr</code></li></ol><ul><li>Multiple pointers can own the same object. The object is only deleted when the <em>last</em> pointer looking at it dies</li><li>Overhead is high since it maintains a &ldquo;reference count&rdquo; (internally, an int) that must be thread-safe (atomic). Every time you copy the pointer, it has to ++ or &ndash; the counter</li><li>I&rsquo;d suggest to use this sparingly, only when ownership <strong>is truly</strong> shared. E.g., texture used by 50 different models. The texture should die when all 50 models are gone</li></ul><h3 class=heading id=7e-the-pointer-chasing-problem>7e. The &ldquo;Pointer-chasing&rdquo; problem
<a class=anchor href=#7e-the-pointer-chasing-problem>#</a></h3><p>Connects to a topic called <strong>Cache locality</strong></p><ul><li>In stack, data is usually contigous (next to each other). CPU <strong>loves this</strong>. It loads a &ldquo;Cache Line&rdquo; (typically 64 bytes) and gets all your variables at once</li><li>In heap, the data is scattered randomly<ul><li>If you have a <code>std::vector&lt;Enemy*></code>, the vector is just a list of ptrs</li><li>To update enemy 1, the CPU jumps address to address A</li><li>To update enemy 2, the CPU jumps address to address B</li><li>This jumping causes <strong>Cache misses</strong>, which are very slow</li></ul></li></ul><p>Prefer contigous memory as much as possible, like <code>std::vector&lt;Enemy></code> instead of <code>std::vector&lt;Enemy*></code> because it keeps the data close togehter and avoids &ldquo;Pointer Chasing&rdquo; on The Heap.</p><h3 class=heading id=7f-pro-gamer-move-memory-arena>7f. Pro-gamer move: &ldquo;Memory Arena&rdquo;
<a class=anchor href=#7f-pro-gamer-move-memory-arena>#</a></h3><p>The concept: Heap size, Stack speed</p><p>Now that we know that standard heap allocation is slow and causes fragmentation, while stack allocation is fast but the stack is too small - there&rsquo;s a neat trick that carries the best of both worlds called <strong>Memory Arena</strong></p><ul><li>You allocate <strong>a huge block</strong> of memory on The Heap <strong>at startup</strong>, e.g., 100MB</li><li>You manage this block yourself, using a simple pointer</li><li>To &ldquo;allocate&rdquo; an object, you just move the pointer forward</li><li>To &ldquo;free&rdquo; memory, you <strong>don&rsquo;t delete</strong> individual objects. Just <strong>reset the pointer</strong> to the start</li></ul><p>Essentially this makes it so that:</p><ul><li>Allocating is just an integer addition, O(1), no OS overhead - fast</li><li>Since you allocate objects one after another, they sit next to each other in RAM (cache locality)</li><li>No fragmentation, since you immediately fill the block linearly, no holes</li><li>Instant cleanup since we can free objects contained in the arenas by setting <code>Head = 0</code></li></ul><p><strong>The Trap: Destructors</strong>
<code>Reset()</code> effectively frees the memory, but it <strong>does not call destructors</strong></p><ul><li>If you store <strong>POD</strong> (Plain Old Data, like <code>int</code>, <code>Vector3</code>, <code>Matrix</code>), this is fine</li><li>If you store complex objects (like <code>std::vector</code> or <code>std::string</code>) inside the arena, the object <em>wrapper</em> is freed, but the memory <em>it allocated internally</em> is leaked forever</li></ul><p><strong>The Fix:</strong> Only use Arenas for POD types, or manually call the destructor <code>p->~T()</code> before resetting</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cstddef&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cstdint&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MemoryArena</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>*</span> MemoryBlock; <span style=color:#6272a4>// The big chunk of memory
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    size_t Size;          <span style=color:#6272a4>// Total size (e.g., 100MB)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    size_t Offset;        <span style=color:#6272a4>// Current &#34;Head&#34; position
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// 1. Startup: Allocate the big block once (using malloc/new)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    MemoryArena(size_t sizeBytes) <span style=color:#ff79c6>:</span> Size(sizeBytes), Offset(<span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        MemoryBlock <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>uint8_t</span>[sizeBytes]; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// 2. Shutdown: Free the big block
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>~</span>MemoryArena() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        <span style=color:#ff79c6>delete</span>[] MemoryBlock;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// 3. Allocate: The &#34;Pointer Bump&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> <span style=color:#50fa7b>Alloc</span>(size_t sizeBytes) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        <span style=color:#6272a4>// Check if we have space
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (Offset <span style=color:#ff79c6>+</span> sizeBytes <span style=color:#ff79c6>&gt;</span> Size) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nullptr</span>; <span style=color:#6272a4>// Out of memory!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>        <span style=color:#6272a4>// Get the pointer to the current free spot
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span>        <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> ptr <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>MemoryBlock[Offset];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>        <span style=color:#6272a4>// Move the head forward
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4></span>        Offset <span style=color:#ff79c6>+=</span> sizeBytes;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        <span style=color:#ff79c6>return</span> ptr;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>    <span style=color:#6272a4>// 4. Deallocate: The Magic Reset
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We don&#39;t free individual items. We wipe everything at once.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Reset</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>        Offset <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#6272a4>// Usage in game loop
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Particle</span> { <span style=color:#8be9fd>float</span> x, y; }; <span style=color:#6272a4>// POD type: Safe!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    MemoryArena FrameArena(<span style=color:#bd93f9>1024</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>1024</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    <span style=color:#ff79c6>while</span> (GameIsRunning) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>        FrameArena.Reset(); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>        <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1000</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>            <span style=color:#6272a4>// Placement new
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#6272a4></span>            <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> mem <span style=color:#ff79c6>=</span> FrameArena.Alloc(<span style=color:#ff79c6>sizeof</span>(Particle));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>            Particle<span style=color:#ff79c6>*</span> p <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span>(mem) Particle(); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>        Render();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>}
</span></span></code></pre></div><p>When to use this? I found several useful case that benefits from this trick:</p><ol><li><p>Frame allocator
I used a linear memory arena for temporary data that only needs to exist <strong>for one frame</strong>. E.g., UI text meshes, temp arrays for physics queries or debug drawing lines. At the end of the frame, I just call <code>Reset()</code> lol</p></li><li><p>Level allocator
When loading a level, I typically allocate <strong>all</strong> assets (textures, meshes, etc.) into a specific arena. When the player leaves the level, I don&rsquo;t have to track down <em>every single texture</em> to delete it. I just destroy the entire level arena. Effectively doing instant cleanup and guarantees zero memory leaks between levels</p></li></ol><p><strong>Important note</strong></p><p>Since <code>Alloc()</code> returns a <code>void*</code> (raw memory), the constructor is not called automatically. We need to use something called <strong>Placement New</strong></p><ul><li>Standard <code>new Player()</code> -> allocates memory AND calls constructor</li><li>Placement New <code>new(ptr) Player()</code> -> uses EXISTING memory <code>ptr</code> and calls constructor there</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> mem <span style=color:#ff79c6>=</span> Arena.Alloc(<span style=color:#ff79c6>sizeof</span>(Enemy));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>Enemy<span style=color:#ff79c6>*</span> e <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span>(mem) Enemy(); <span style=color:#6272a4>// Construct the enemy in our arena
</span></span></span></code></pre></div><p><strong>The Trap: Alignment</strong>
If you allocate a <code>char</code> (1 byte) and then immediately allocate an <code>int</code> (4 bytes), the int might end up at memory address <code>0x01</code>. This is unaligned. On x86 CPUs, this is slow. On ARM (Mobile/Switch), this crashes the game</p><p><strong>The Fix</strong>: We must align the pointer before returning it</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cstddef&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cstdint&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;memory&gt;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// for std::align
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MemoryArena</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#8be9fd>uint8_t</span><span style=color:#ff79c6>*</span> MemoryBlock; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    size_t Size;          
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    size_t Offset;        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    MemoryArena(size_t sizeBytes) <span style=color:#ff79c6>:</span> Size(sizeBytes), Offset(<span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        MemoryBlock <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>uint8_t</span>[sizeBytes]; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#ff79c6>~</span>MemoryArena() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#6272a4>// WARNING: This does NOT call destructors for objects inside!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Only use Arena for POD (Plain Old Data) or manually call destructors before resetting.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>delete</span>[] MemoryBlock;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> <span style=color:#50fa7b>Alloc</span>(size_t sizeBytes, size_t alignment) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// 1. Calculate current address
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        uintptr_t currentPtr <span style=color:#ff79c6>=</span> (uintptr_t)MemoryBlock <span style=color:#ff79c6>+</span> Offset;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        <span style=color:#6272a4>// 2. Calculate padding needed to align this address
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Example: Address is 1, alignment is 4. We need 3 bytes padding.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>        size_t padding <span style=color:#ff79c6>=</span> (alignment <span style=color:#ff79c6>-</span> (currentPtr <span style=color:#ff79c6>%</span> alignment)) <span style=color:#ff79c6>%</span> alignment;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#6272a4>// 3. Check space
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (Offset <span style=color:#ff79c6>+</span> padding <span style=color:#ff79c6>+</span> sizeBytes <span style=color:#ff79c6>&gt;</span> Size) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>nullptr</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        <span style=color:#6272a4>// 4. Apply padding and return aligned pointer
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4></span>        Offset <span style=color:#ff79c6>+=</span> padding;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>        <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> ptr <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>MemoryBlock[Offset];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        Offset <span style=color:#ff79c6>+=</span> sizeBytes;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>        <span style=color:#ff79c6>return</span> ptr;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Reset</span>() { Offset <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#6272a4>// Usage
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#6272a4>// alignof(T) gets the required alignment for a type
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> mem <span style=color:#ff79c6>=</span> Arena.Alloc(<span style=color:#ff79c6>sizeof</span>(Enemy), <span style=color:#ff79c6>alignof</span>(Enemy));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>Enemy<span style=color:#ff79c6>*</span> e <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span>(mem) Enemy();
</span></span></code></pre></div><h2 class=heading id=8-common-c-containers>8. Common C++ containers
<a class=anchor href=#8-common-c-containers>#</a></h2><p>Choosing the right container is often a choice between &ldquo;easy to write&rdquo; vs &ldquo;runs fast&rdquo;. Understanding of <strong>Big O notation</strong> and <strong>CPU cache behavior</strong> is important</p><h3 class=heading id=8a-stdvector>8a. <code>std::vector</code>
<a class=anchor href=#8a-stdvector>#</a></h3><p>Under the hood this is just a dynamic array. It allocates a contigous block of memory on The Heap</p><ul><li>Performance:<ul><li>Random access via <code>v[i]</code>: O(1)</li><li>Insertion at the end via <code>push_back()</code>: O(1) amortized, usually fast but slow when need to resize</li><li>Insertion/Deletion in Middle: O(n), since it has to <strong>shift all</strong> subsequent elements in memory</li></ul></li><li>CPU loves it. Since it&rsquo;s a contigous memory. The data sits side-by-side, thus the CPU loads it into the cache efficiently. Iterating through a vector is the fastest thing a CPU can do</li></ul><p><strong><code>reserve()</code> trick</strong></p><p>When a vector fills up, it has to:</p><ul><li>Allocate a new, bigger block of memory (usually 2x current size)</li><li><strong>Move or Copy</strong> everything from the old block to the new one.</li><li><strong>The Trap:</strong> <code>std::vector</code> will only <strong>Move</strong> (fast) if your Move Constructor is marked <code>noexcept</code>. If it isn&rsquo;t, C++ falls back to <strong>Copying</strong> (slow) to guarantee exception safety.</li><li>Delete the old block</li></ul><p>This is slow. By reserving a certain number of elements in the array, we&rsquo;ll avoid reallocation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Enemy<span style=color:#ff79c6>&gt;</span> enemies;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>enemies.reserve(<span style=color:#bd93f9>100</span>); <span style=color:#6272a4>// No reallocation for the first 100 items.
</span></span></span></code></pre></div><p>It&rsquo;s also a good idea to mark your Move Constructor as <code>noexcept</code> though:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Particle</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#6272a4>// FAST: Vector will move this when resizing
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    Particle(Particle<span style=color:#ff79c6>&amp;&amp;</span> other) <span style=color:#ff79c6>noexcept</span> { ... }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#6272a4>// SLOW: Vector will COPY this when resizing because it&#39;s not safe to move
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>    Particle(Particle<span style=color:#ff79c6>&amp;&amp;</span> other) { ... } 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>};
</span></span></code></pre></div><p><strong>Usage example: Entity Manager</strong></p><p>Say you have a list of enemies, bullets or particles. You need to update them every single frame, and need maximum iteration speed</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Enemy</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>int</span> id;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#8be9fd>float</span> health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Update</span>() { <span style=color:#6272a4>/* AI logic */</span> }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>EnemyManager</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#6272a4>// CHOICE: vector because we iterate this 60 times a second.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// The contiguous memory means the CPU cache stays hot.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Enemy<span style=color:#ff79c6>&gt;</span> enemies;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#8be9fd>void</span> InitLevel(<span style=color:#8be9fd>int</span> enemyCount) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        <span style=color:#6272a4>// OPTIMIZATION: Reserve memory upfront to prevent resizing lag spikes.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>        enemies.reserve(enemyCount); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#ff79c6>for</span>(<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> enemyCount; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>            enemies.push_back(Enemy{i, <span style=color:#bd93f9>100.0f</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateAll</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// Fast iteration
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>e</span> : enemies) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            e.Update();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>};
</span></span></code></pre></div><ul><li>Why not List? A list would scatter enemies across memory, causing cache misses every time we move to the next enemy</li><li>Why not Map? We don&rsquo;t need to look them up by ID here, just need to process <em>all</em> of them</li></ul><h3 class=heading id=8b-stdlist>8b. <code>std::list</code>
<a class=anchor href=#8b-stdlist>#</a></h3><p>This is a doubly linked list. Each node contains <code>the data + a pointer to the next node + a pointer to the previous node</code></p><ul><li>Performance<ul><li>Random access via <code>l[i]</code>: O(n), terrible. Since you have to walk the chain from the start to find the nth element</li><li>Insertion/Deletion: O(1), you just change the pointer. <em>However</em>, you have to find the spot first (which takes O(n))</li></ul></li><li>CPU hates it. Prone to cache misses since the nodes are scattered all over the heap. Iterating a list is significantly slower than a vector because the CPU has to wait for memory fetches constantly</li><li>Use this only when you need to frequently insert/remove items from the <em>middle</em> of the sequence and you already have a pointer to that location</li></ul><p><strong>Usage example: Status effect system</strong></p><p>Say a player might have &ldquo;Poison&rdquo;, &ldquo;Regen&rdquo; and &ldquo;Stun&rdquo; effects active. The effects expire at different times and with a random order. We frequently need to delete an effect from the <em>middle</em> of the list when its timer runs out</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>StatusEffect</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    std<span style=color:#ff79c6>::</span>string name;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#8be9fd>float</span> duration;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#6272a4>// CHOICE: list because we delete from the middle frequently.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Removing an item from a list is just rewiring pointers (cheap).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Removing from the middle of a vector requires shifting all data (expensive).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>list<span style=color:#ff79c6>&lt;</span>StatusEffect<span style=color:#ff79c6>&gt;</span> activeEffects;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#8be9fd>void</span> AddEffect(std<span style=color:#ff79c6>::</span>string name, <span style=color:#8be9fd>float</span> time) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        activeEffects.push_back({name, time});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>TickEffects</span>(<span style=color:#8be9fd>float</span> deltaTime) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#ff79c6>auto</span> it <span style=color:#ff79c6>=</span> activeEffects.begin();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        <span style=color:#ff79c6>while</span> (it <span style=color:#ff79c6>!=</span> activeEffects.end()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>            it<span style=color:#ff79c6>-&gt;</span>duration <span style=color:#ff79c6>-=</span> deltaTime;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>            
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>            <span style=color:#ff79c6>if</span> (it<span style=color:#ff79c6>-&gt;</span>duration <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>                <span style=color:#6272a4>// Efficient removal from middle (No data shifting)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>                it <span style=color:#ff79c6>=</span> activeEffects.erase(it); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>            } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>                <span style=color:#ff79c6>++</span>it;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>};
</span></span></code></pre></div><ul><li>Why not Vector? If you have 50 effects and remove index 0, a vector has to <em>shift the other 49 items</em> down one slot. A list just updates two pointers</li></ul><h3 class=heading id=8c-stdmap>8c. <code>std::map</code>
<a class=anchor href=#8c-stdmap>#</a></h3><p>Under the hood, it&rsquo;s usually a Red-Black Tree (Binary Search Tree) that keeps elements <strong>sorted</strong> by key</p><p>Performance typically is O(log n) for lookups, insertions and deletions</p><p>Use this when you need the data to be sorted</p><p><strong>Usage example: Event Timeline / Replay System</strong></p><p>Say you want to store game events (player jumped, enemy died, etc.) keyed by the <strong>Time</strong> they occured. You need to process them strictly in chronological order</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>GameEvent</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    std<span style=color:#ff79c6>::</span>string action;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#8be9fd>int</span> actorID;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>ReplaySystem</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#6272a4>// CHOICE: map because it automatically sorts by Key (Time).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// float = Time (Key), GameEvent = Data (Value)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>map<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>float</span>, GameEvent<span style=color:#ff79c6>&gt;</span> timeline;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#8be9fd>void</span> RecordEvent(<span style=color:#8be9fd>float</span> time, std<span style=color:#ff79c6>::</span>string action, <span style=color:#8be9fd>int</span> id) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#6272a4>// Insertions are O(log n), but they are automatically sorted.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>        timeline[time] <span style=color:#ff79c6>=</span> {action, id};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Playback</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#6272a4>// Iterating a map ALWAYS goes from smallest Key to largest Key.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> <span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>pair</span> : timeline) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>            <span style=color:#8be9fd>float</span> time <span style=color:#ff79c6>=</span> pair.first;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>            <span style=color:#ff79c6>const</span> GameEvent<span style=color:#ff79c6>&amp;</span> evt <span style=color:#ff79c6>=</span> pair.second;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>            
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>            std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;At &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> time <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;s: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> evt.action <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>};
</span></span></code></pre></div><h3 class=heading id=8d-stdunordered_map>8d. <code>std::unordered_map</code>
<a class=anchor href=#8d-stdunordered_map>#</a></h3><p>Under the hood, it&rsquo;s a hash table. It hashes the Key to find a &ldquo;bucket&rdquo;. Unlike <code>std::map</code>, the elements are <strong>stored in random order</strong></p><p>Performance typically O(1), faster than std::map</p><p>There&rsquo;s a catch though, if many keys hash to the same bucket (collision), performance degrades to O(n). Also, calculating the Hash takes time</p><p><strong>Usage example: Asset Manager (Texture Cache)</strong></p><p>Say you need to load a texture by its filename. You don&rsquo;t care about the alphabetical order of files; you just want say &ldquo;Give me <code>Hero.png</code>&rdquo;, and get it instantly</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Texture</span> { <span style=color:#6272a4>/* ... heavy image data ... */</span> };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AssetManager</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// CHOICE: unordered_map for O(1) lookup speed.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Key = Filename (string), Value = Pointer to Texture
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>unordered_map<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>string, Texture<span style=color:#ff79c6>*&gt;</span> textureCache;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    Texture<span style=color:#ff79c6>*</span> GetTexture(std<span style=color:#ff79c6>::</span>string filename) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#6272a4>// 1. Check if we already loaded it (Fast lookup)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>auto</span> it <span style=color:#ff79c6>=</span> textureCache.find(filename);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#ff79c6>if</span> (it <span style=color:#ff79c6>!=</span> textureCache.end()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>            <span style=color:#ff79c6>return</span> it<span style=color:#ff79c6>-&gt;</span>second; <span style=color:#6272a4>// Found it! Return existing.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#6272a4>// 2. Not found, load from disk (Slow)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>        Texture<span style=color:#ff79c6>*</span> newTex <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Texture(); <span style=color:#6272a4>// (Pseudo-code loading)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        textureCache[filename] <span style=color:#ff79c6>=</span> newTex;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        <span style=color:#ff79c6>return</span> newTex;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>};
</span></span></code></pre></div><h3 class=heading id=8e-stdarray>8e. <code>std::array</code>
<a class=anchor href=#8e-stdarray>#</a></h3><p>This is a fixed-size array that lives on The Stack, usually.</p><ul><li>Syntax: <code>std::array&lt;int, 5> myArr;</code></li><li>Performance is identical to a raw C-Array (<code>int myArr[5]</code>)</li><li>Use this over raw C-Array since it adds safe and handy features like <code>.size()</code> for capacity check and <code>.at()</code> for bounds checking, without any neglible performance cost</li></ul><p><strong>Usage example: Equipment Slots</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>PlayerEquipment</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#ff79c6>enum</span> <span style=color:#50fa7b>Slot</span> { HEAD, CHEST, LEGS, FEET, COUNT };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#6272a4>// CHOICE: array because the size is known at compile time (4 slots).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// It lives on the Stack (inside the class), avoiding Heap allocation overhead.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>array<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span>, Slot<span style=color:#ff79c6>::</span>COUNT<span style=color:#ff79c6>&gt;</span> itemIDs;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    PlayerEquipment() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#6272a4>// Safe filling
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>        itemIDs.fill(<span style=color:#bd93f9>0</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Equip</span>(Slot s, <span style=color:#8be9fd>int</span> id) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// .at() provides bounds checking (throws error if s is invalid)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// unlike raw C-arrays which would just overwrite random memory.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>        itemIDs.at(s) <span style=color:#ff79c6>=</span> id; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>};
</span></span></code></pre></div><ul><li>Why not Vector? A vector would allocate heap memory for just 4 integers. That&rsquo;s wasteful.</li></ul><h3 class=heading id=8f-pro-gamer-move-swap-and-pop-array-unordered-arrayswapback-array>8f. Pro-gamer move: Swap-and-Pop array (Unordered array/Swapback array)
<a class=anchor href=#8f-pro-gamer-move-swap-and-pop-array-unordered-arrayswapback-array>#</a></h3><p>As described above, deleting an object from a <code>std::vector</code> without <code>reserve()</code>-ing it ahead of time is inefficient. The following container is a simple workaround, albeit with a glaring downside</p><p>If you <strong>don&rsquo;t care about the order</strong> of elements, you can use a technique called Swap-and-Pop</p><ul><li><p>The technique:</p><ul><li>Take the <strong>last element</strong> in the array</li><li>Copy/Move it into the slot of the <strong>dead element</strong></li><li>Delete the <strong>last element</strong> (cheap!)</li></ul></li><li><p>Cost: O(1), moved <strong>exactly</strong> one object</p></li><li><p>Use this when:</p><ul><li>Order doesn&rsquo;t matter. E.g., particle system, pool of active enemies, list of SFXs, etc.</li><li>Frequent deletions, you add and remove items constantly every frame</li></ul></li><li><p>Don&rsquo;t use this when:</p><ul><li>Order matters. E.g., rendering layer. Don&rsquo;t show background layer on after UI layer and vice versa</li><li>Indices are cached externally. If another system holds &ldquo;index 5&rdquo; to refer to a specific enemy, and you swap a different enemy into index 5, the other system will now point to the wrong enemy</li></ul></li></ul><p><strong>Implementation</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// We can implement this as a wrapper around std::vector
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;vector&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cassert&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>SwapbackArray</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// Standard access
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    T<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span>[](size_t index) { <span style=color:#ff79c6>return</span> data[index]; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>const</span> T<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span>[](size_t index) <span style=color:#ff79c6>const</span> { <span style=color:#ff79c6>return</span> data[index]; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    size_t <span style=color:#50fa7b>size</span>() <span style=color:#ff79c6>const</span> { <span style=color:#ff79c6>return</span> data.size(); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// O(1) Insertion (Same as vector)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>push_back</span>(<span style=color:#ff79c6>const</span> T<span style=color:#ff79c6>&amp;</span> value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        data.push_back(value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// THE MAGIC: O(1) Removal
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>remove_at</span>(size_t index) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>        assert(index <span style=color:#ff79c6>&lt;</span> data.size());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        <span style=color:#6272a4>// 1. Overwrite the item to be removed with the last item
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We use std::move to be efficient if T is a complex object
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>        data[index] <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>move(data.back());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#6272a4>// 2. Remove the last item (now that it has been moved)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// pop_back on a vector is O(1)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>        data.pop_back();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4>// Usage example: A particle system. We iterate through particles. If one dies, remove it instantly without breaking the loop or shifting memory
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Particle</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    <span style=color:#8be9fd>float</span> lifeTime;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#8be9fd>float</span> x, y;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    SwapbackArray<span style=color:#ff79c6>&lt;</span>Particle<span style=color:#ff79c6>&gt;</span> particles;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    <span style=color:#6272a4>// Spawn 10,000 particles
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span>(<span style=color:#8be9fd>int</span> i<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>; i<span style=color:#ff79c6>&lt;</span><span style=color:#bd93f9>10000</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>        particles.push_back({<span style=color:#bd93f9>10.0f</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>0</span>});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    <span style=color:#6272a4>// Update Loop
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// NOTICE: We iterate BACKWARDS or handle the index carefully
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// because swapping changes the current index!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (size_t i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> particles.size(); <span style=color:#6272a4>/* no increment here */</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>        Particle<span style=color:#ff79c6>&amp;</span> p <span style=color:#ff79c6>=</span> particles[i];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>        p.lifeTime <span style=color:#ff79c6>-=</span> <span style=color:#bd93f9>0.016f</span>; <span style=color:#6272a4>// DeltaTime
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>        <span style=color:#ff79c6>if</span> (p.lifeTime <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>            <span style=color:#6272a4>// O(1) Removal
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#6272a4></span>            <span style=color:#6272a4>// The particle at &#39;i&#39; is replaced by the last particle.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#6272a4></span>            <span style=color:#6272a4>// We do NOT increment &#39;i&#39;, because we need to process 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span><span style=color:#6272a4></span>            <span style=color:#6272a4>// the *new* particle that just got swapped into this slot.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#6272a4></span>            particles.remove_at(i);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span>            <span style=color:#6272a4>// Only increment if we didn&#39;t remove
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>++</span>i;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span>}
</span></span></code></pre></div><h3 class=heading id=8g-iterator-invalidation>8g. Iterator Invalidation
<a class=anchor href=#8g-iterator-invalidation>#</a></h3><p>What happens to iterators when you modify a container?</p><p>Say you&rsquo;re looping through a <code>vector</code> of enemies, and you decide to delete one</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> numbers <span style=color:#ff79c6>=</span> {<span style=color:#bd93f9>1</span>, <span style=color:#bd93f9>2</span>, <span style=color:#bd93f9>3</span>, <span style=color:#bd93f9>4</span>, <span style=color:#bd93f9>5</span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>auto</span> it <span style=color:#ff79c6>=</span> numbers.begin(); it <span style=color:#ff79c6>!=</span> numbers.end(); <span style=color:#ff79c6>++</span>it) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>*</span>it <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>3</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        numbers.erase(it); <span style=color:#6272a4>// &lt;--- CRASH / Undefined Behavior
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// The &#39;erase&#39; function invalidates the iterator &#39;it&#39;.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// The loop then tries to do &#39;++it&#39; on a dead iterator.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p><strong>The fix</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>auto</span> it <span style=color:#ff79c6>=</span> numbers.begin(); it <span style=color:#ff79c6>!=</span> numbers.end(); <span style=color:#6272a4>/* empty */</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>*</span>it <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>3</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        it <span style=color:#ff79c6>=</span> numbers.erase(it); <span style=color:#6272a4>// Update &#39;it&#39; to the next valid element
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        <span style=color:#ff79c6>++</span>it; <span style=color:#6272a4>// Only increment if we didn&#39;t delete
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><h2 class=heading id=9-strings>9. Strings
<a class=anchor href=#9-strings>#</a></h2><h3 class=heading id=9a-cost-of-stdstring>9a. Cost of <code>std::string</code>
<a class=anchor href=#9a-cost-of-stdstring>#</a></h3><p>Unlike an <code>int</code> (which is just 4 bytes on stack), a <code>std::string</code> is a complex object</p><ul><li>Heap allocation: If the text is long, <code>std::string</code> calls <code>new</code> to store the characters on The Heap</li><li>Copying is expensive (<code>std::string a = b;</code>) usually triggers a heap allocation and memory copy (<code>memcpy</code>)</li><li>When the string goes out of the scope, it calls <code>delete</code></li></ul><p>The following code allocates and frees memory every single frame (60 times/sec). This causes heap fragmentation and CPU overhead. We should cache the string or use a fixed-size buffer</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateHUD</span>(<span style=color:#8be9fd>int</span> score) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#6272a4>// 1. Converts int to string (allocation)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 2. Creates &#34;Score: &#34; (allocation)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// 3. Concatenates them (allocation + copy)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>string text <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Score: &#34;</span> <span style=color:#ff79c6>+</span> std<span style=color:#ff79c6>::</span>to_string(score); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    RenderText(text);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>} <span style=color:#6272a4>// text is destroyed (deallocation)
</span></span></span></code></pre></div><h3 class=heading id=9b-sso-small-string-optimization>9b. SSO (Small String Optimization)
<a class=anchor href=#9b-sso-small-string-optimization>#</a></h3><p>This is a compiler optimization in <code>std::string</code>. To avoid the expensive heap allocation for short strings like &ldquo;Name&rdquo;, &ldquo;HP&rdquo;, &ldquo;Ammo&rdquo;, <code>std::string</code> has a small internal buffer (typically 15-22 chars) directly inside the object itself</p><ul><li>Short string (&lt; 16 chars) -> stored on The Stack, inside the object itself. Fast, no <code>new</code>/<code>delete</code></li><li>Long string (> 16 chars) -> stored on The Heap, slow</li></ul><p>Keep frequently used strings, like obj names or tags short enough to fit in SSO so it can avoid heap allocation</p><h3 class=heading id=9c-const-char-vs-stdstring-vs-stdstring_view>9c. <code>const char*</code> vs <code>std::string</code> vs <code>std::string_view</code>
<a class=anchor href=#9c-const-char-vs-stdstring-vs-stdstring_view>#</a></h3><h4 class=heading id=1const-char-the-c-style-string>1.<code>const char*</code>, the C-Style String
<a class=anchor href=#1const-char-the-c-style-string>#</a></h4><ul><li>Just a pointer to a read-only array of chars ending in a null terminator <code>\0</code></li><li>Zero overhead, it&rsquo;s just a pointer (8 bytes)</li><li>Unsafe, since you don&rsquo;t know the size. Have to use <code>strlen()</code> to find the length, which is O(n)</li></ul><h4 class=heading id=2-stdstring>2. <code>std::string</code>
<a class=anchor href=#2-stdstring>#</a></h4><ul><li>Safe, easy to resize, owns the memory</li><li>It&rsquo;s heavy since it does allocations</li><li>Use this when you need to <em>store</em> or <em>modify</em> texts</li></ul><h4 class=heading id=3-stdstring_view>3. <code>std::string_view</code>
<a class=anchor href=#3-stdstring_view>#</a></h4><ul><li>A lightweight wrapper that looks at an existing string, either <code>char*</code> or <code>std::string</code> without actually copying it. Consists of just a pointer and a length</li><li>Use this for <strong>function parameters</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// BAD: Copies the string (Heap allocation if long)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>ProcessName</span>(std<span style=color:#ff79c6>::</span>string name) { ... }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>// BETTER: Pass by const reference (No copy, but requires a std::string input)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>ProcessName</span>(<span style=color:#ff79c6>const</span> std<span style=color:#ff79c6>::</span>string<span style=color:#ff79c6>&amp;</span> name) { ... }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4>// BEST (C++17): Accepts &#34;char*&#34; OR &#34;std::string&#34; with ZERO copies/allocations
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>ProcessName</span>(std<span style=color:#ff79c6>::</span>string_view name) { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>if</span> (name <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;Player&#34;</span>) { ... } <span style=color:#6272a4>// Fast comparison
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h3 class=heading id=9d-string-hashing>9d. String Hashing
<a class=anchor href=#9d-string-hashing>#</a></h3><p>Comparing strings (<code>"Player" == "Player"</code>) is slow. It has to check every character; <code>P == P</code>, <code>l == l</code>, etc. This is O(n), where n is the length of the string</p><p>Hashing/interning is used to get around this. In Unreal , we convert strings into integers (Hashes)</p><ul><li>&ldquo;Player&rdquo; -> Hash function -> <code>0xA1B2C3D4</code></li><li>&ldquo;Enemy&rdquo; -> Hash function -> <code>0xE5F6G7H8</code></li></ul><p>Then the comparison becomes:
<code>if (0xA1B2C3D4 == 0xE5F6G7H8)</code>, just a single integer comparison. O(1), extremely fast</p><p>In UE, <code>FName</code> is a hashed string. It is <strong>case-insensitive</strong> and <strong>immutable</strong>. It is used to identify assets, bones and sockets cz comparison is instant</p><h3 class=heading id=9e-snprintf--fmt-for-formatting>9e. <code>snprintf() / fmt()</code> for Formatting
<a class=anchor href=#9e-snprintf--fmt-for-formatting>#</a></h3><p>Concatenating strings with <code>+</code> is slow and messy</p><p><code>std::string s = "Health: " + std::to_string(hp) + " / " + std::to_string(maxHp);</code></p><p><strong>Better alternatives</strong>:</p><h4 class=heading id=snprintf-c-style-fast-writes-to-a-stack-buffer><code>snprintf</code> (C-Style). Fast, writes to a stack buffer
<a class=anchor href=#snprintf-c-style-fast-writes-to-a-stack-buffer>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>char</span> buffer[<span style=color:#bd93f9>64</span>];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>snprintf(buffer, <span style=color:#ff79c6>sizeof</span>(buffer), <span style=color:#f1fa8c>&#34;Health: %d / %d&#34;</span>, hp, maxHp);
</span></span></code></pre></div><h4 class=heading id=stdformat-c20-type-safe-fast-and-modern><code>std::format</code> (C++20). Type-safe, fast and modern
<a class=anchor href=#stdformat-c20-type-safe-fast-and-modern>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>std<span style=color:#ff79c6>::</span>string s <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>format(<span style=color:#f1fa8c>&#34;Health: {} / {}&#34;</span>, hp, maxHp);
</span></span></code></pre></div><h2 class=heading id=10-alignment-and-padding>10. Alignment and Padding
<a class=anchor href=#10-alignment-and-padding>#</a></h2><h3 class=heading id=10a-cpu-word-size>10a. CPU word size
<a class=anchor href=#10a-cpu-word-size>#</a></h3><p>The CPU reads memory <strong>in chunks</strong>, not byte-by-byte</p><ul><li>A 64-bit CPU wants to read data from addresses that are multiples of 8 (64 bits)</li><li>A 32-bit integer wants to live at an address that is divisible by 4</li></ul><p>If you put a 4-byte <code>int</code> at address <code>0x01</code> instead of <code>0x00</code> or <code>0x04</code>, the CPU has to do extra work (two reads + bit shifting) to get that number</p><p>This is called <strong>Unaligned Access</strong>. To prevent this, the compiler automatically inserts <strong>Padding</strong> (empty bytes)</p><h3 class=heading id=10b-padding-visualizatoin>10b. Padding visualizatoin
<a class=anchor href=#10b-padding-visualizatoin>#</a></h3><p>Let&rsquo;s look at the following struct. You might think the size is just the sum of its parts. It&rsquo;s not</p><p><strong>Naive struct</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>BadStruct</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>char</span> a;     <span style=color:#6272a4>// 1 byte
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// --- 3 bytes of PADDING inserted here ---
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> b;      <span style=color:#6272a4>// 4 bytes (Needs 4-byte alignment)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>char</span> c;     <span style=color:#6272a4>// 1 byte
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// --- 3 bytes of PADDING inserted here ---
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Total Size: 1 + 3 + 4 + 1 + 3 = 12 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4></span>};
</span></span></code></pre></div><ul><li><code>int b</code> needs to start at an address divisible by 4. Since <code>char a</code> only took 1 byte, the compiler adds 3 junk bytes so <code>b</code> starts at offset 4</li><li>We&rsquo;re wasting 6 bytes due to padding (50%!)</li></ul><p><strong>Nicely packed struct</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>GoodStruct</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>int</span> b;      <span style=color:#6272a4>// 4 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>char</span> a;     <span style=color:#6272a4>// 1 byte
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>char</span> c;     <span style=color:#6272a4>// 1 byte
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// --- 2 bytes of PADDING at the end ---
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Total Size: 4 + 1 + 1 + 2 = 8 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>};
</span></span></code></pre></div><p>The key is to <strong>reorder variables from largest to smallest</strong>. Doing so, we reduced the size from 12 bytes -> 8 bytes</p><p>This looks like it won&rsquo;t matter that much, but consider if you have an array of 1.000.000 particles,</p><ul><li><code>BadStruct</code> -> 12MB RAM usage</li><li><code>GoodStruct</code> -> 8MB RAM usage</li></ul><p>We saved 4MB of RAM usage and significantly reduced the number of times the CPU has to fetch data from main memory due to fewer cache misses</p><h3 class=heading id=10c-alignof-and-sizeof>10c. <code>alignof</code> and <code>sizeof</code>
<a class=anchor href=#10c-alignof-and-sizeof>#</a></h3><p>Consider the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#ff79c6>sizeof</span>(BadStruct); <span style=color:#6272a4>// Output: 12
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span>std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#ff79c6>alignof</span>(BadStruct); <span style=color:#6272a4>// Output: 4 (Because the largest member is an int)
</span></span></span></code></pre></div><p>The alignment of a struct is <em>usually</em> equal to the alignment of its largest member</p><h3 class=heading id=10d-cache-lines-the-64-byte-rule>10d. Cache lines (the 64-byte rule)
<a class=anchor href=#10d-cache-lines-the-64-byte-rule>#</a></h3><p>Modern CPUs fetch memory in &ldquo;Cache Lines&rdquo;, typically 64 bytes</p><ul><li>When you ask for <code>Variable A</code>, the CPU fetches <strong><code>Variable A</code> + the next ~60 bytes of data automatically</strong></li><li>The key here is you want your struct <strong>to fit nearly inside a cache line</strong> so CPU gets <em>everything</em> in one go</li></ul><p><strong>Important note</strong>:</p><p>There&rsquo;s a condition called <strong>False sharing</strong>, where 2 threads are writing to 2 different variables that <em>happen</em> to sit on the <em>same</em> cache line. The CPU cores fight over that cache line, causing massive slowdowns</p><p>To fix this, use <code>alignas(64)</code> to force a variable to start on a new cache line</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>ThreadSafeCounter</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#ff79c6>alignas</span>(<span style=color:#bd93f9>64</span>) <span style=color:#8be9fd>int</span> counterA; <span style=color:#6272a4>// Thread 1 uses this
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>alignas</span>(<span style=color:#bd93f9>64</span>) <span style=color:#8be9fd>int</span> counterB; <span style=color:#6272a4>// Thread 2 uses this
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Now they are far apart in memory. No fighting.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>};
</span></span></code></pre></div><h3 class=heading id=10d-simd-single-instruction-multiple-data-alignment-vectorization>10d. SIMD (Single Instruction, Multiple Data) alignment (vectorization)
<a class=anchor href=#10d-simd-single-instruction-multiple-data-alignment-vectorization>#</a></h3><h4 class=heading id=simd-concept>SIMD concept
<a class=anchor href=#simd-concept>#</a></h4><p>If you are doing heavy math (physics, graphics), you might use SIMD (Single Instruction, Multiple Data) instructions (SSE/AVX)</p><ul><li>These instructions operate on <code>4 floats</code> <em>at once</em> (128 bits) or <code>8 floats</code> (256 bits)</li><li>It is important that the data <em>must</em> be aligned to 16 bytes (for SSE) or 32 bytes (for AVX). Otherwise, the program might crash</li></ul><p>UE uses this internally inside <code>FVector</code>, often aligned specifically to allow fast math operations</p><p>Normal C++ code is SISD (Single Instruction, Single Data)</p><p><code>float c = a + b;</code>, simple enough - one addition</p><h4 class=heading id=alignment-requirement>Alignment requirement
<a class=anchor href=#alignment-requirement>#</a></h4><p>To load data into these special registers efficiently, the memory address <strong>must</strong> be a multiple of the register size (typically 16 bytes for SSE)</p><ul><li>Aligned load via <code>_mm_load_ps</code>: Fast. Requires the addrress to end in <code>0</code>, <code>10</code>, <code>20</code>, etc. (Hex!). <strong>Crashes</strong> if address is wrong</li><li>Unaligned load via <code>__mm_loadu_ps</code>: Historically slower, but on modern CPUs (Haswell and newer), the performance penalty is <strong>negligible</strong>. It is safe to use on <em>any</em> address</li><li><strong>The Crash:</strong> The real danger isn&rsquo;t speed, it&rsquo;s using an <em>Aligned</em> instruction on <em>Unaligned</em> memory (e.g., address ending in <code>0x04</code>). The CPU throws a hardware exception and the game crashes instantly</li></ul><h4 class=heading id=concrete-example-the-vector-class>Concrete example, the vector class
<a class=anchor href=#concrete-example-the-vector-class>#</a></h4><p><strong>The &ldquo;Normal&rdquo; Class (Dangerous for SIMD)</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Vector4</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>float</span> x, y, z, w; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>// Size: 16 bytes.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Alignment: 4 bytes (because &#39;float&#39; needs 4-byte alignment).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Math</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#6272a4>// This might be allocated at address 0x1004.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    Vector4 v; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p><strong>The &ldquo;SIMD-Ready&rdquo; Class</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// We use the alignas keyword (C++11) to force the compiler to pad the memory so it always starts on a 16-byte boundary.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;immintrin.h&gt;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// Header for SIMD intrinsics (SSE/AVX)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>// Force this struct to always start at a memory address divisible by 16
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>alignas</span>(<span style=color:#bd93f9>16</span>) Vector4SIMD {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#8be9fd>float</span> x, y, z, w;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>FastAdd</span>(Vector4SIMD<span style=color:#ff79c6>*</span> a, Vector4SIMD<span style=color:#ff79c6>*</span> b, Vector4SIMD<span style=color:#ff79c6>*</span> result) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// 1. Load data from RAM into 128-bit CPU Registers
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// _mm_load_ps REQUIRES 16-byte alignment.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// If we didn&#39;t use alignas(16) above, this line would CRASH.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>__m128</span> vecA <span style=color:#ff79c6>=</span> _mm_load_ps(<span style=color:#ff79c6>&amp;</span>a<span style=color:#ff79c6>-&gt;</span>x); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#ff79c6>__m128</span> vecB <span style=color:#ff79c6>=</span> _mm_load_ps(<span style=color:#ff79c6>&amp;</span>b<span style=color:#ff79c6>-&gt;</span>x);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// 2. Do the math (Add 4 floats at once)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>__m128</span> vecRes <span style=color:#ff79c6>=</span> _mm_add_ps(vecA, vecB);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#6272a4>// 3. Store back to RAM
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    _mm_store_ps(<span style=color:#ff79c6>&amp;</span>result<span style=color:#ff79c6>-&gt;</span>x, vecRes);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div><h4 class=heading id=heap-allocation-gotcha>Heap allocation gotcha
<a class=anchor href=#heap-allocation-gotcha>#</a></h4><p><code>alignas(16)</code> works perfectly for variables on the <strong>Stack</strong> or <strong>Global</strong> variables. The compiler handles it</p><p><strong>However</strong>, if you use <code>new</code>:</p><p><code>Vector4SIMD* ptr = new Vector4SIMD();</code></p><p>The standard <code>new</code> operator <strong>does not guarantee 16-byte alignment</strong> on all platforms, especially older Windows versions. It might give you an address ending in <code>8</code></p><p><strong>The fix</strong>:</p><p>Override the <code>new</code> and <code>delete</code> operators for your class to use <code>_aligned_malloc</code> for Windows or <code>posix_memalign</code> for Linux/Consoles</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>alignas</span>(<span style=color:#bd93f9>16</span>) Vector4SIMD {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>float</span> x, y, z, w;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// Override new to ensure heap allocation is aligned
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> <span style=color:#ff79c6>operator</span> <span style=color:#ff79c6>new</span>(size_t i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        <span style=color:#ff79c6>return</span> _aligned_malloc(i, <span style=color:#bd93f9>16</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>operator</span> <span style=color:#ff79c6>delete</span>(<span style=color:#8be9fd>void</span><span style=color:#ff79c6>*</span> p) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        _aligned_free(p);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>};
</span></span></code></pre></div><h2 class=heading id=11-v-table-or-how-virtual-functions-work>11. V-Table, or how Virtual Functions work
<a class=anchor href=#11-v-table-or-how-virtual-functions-work>#</a></h2><p>How does the computer actually know which function to call at runtime?</p><p>When a class has at least one <code>virtual</code> function, the compiler <em>secretly</em> adds a hidden pointer to the class called the <code>vptr</code> (vritual pointer). This points to a static table in memory called <code>vtable</code> (virtual table)</p><ul><li>The vtable is an array of function pointers, shared by all objects of that class</li><li>The cost:<ul><li>Memory, every object gets 8 bytes larger (on 64-bit systems) to hold the <code>vptr</code></li><li>Performance, calling a virtual function requires an extra memory lookup. Dereferencing <code>vptr</code> -> finding function address -> actually calling it. Again, this could cause cache miss due to indirect lookup. This also prevent compiler from inlining the function</li></ul></li></ul><p>Then, every function shouldn&rsquo;t be virtual. Because of the overhead explained above</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Base</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>int</span> x;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Bark</span>() {} <span style=color:#6272a4>// &lt;--- Causes creation of vtable
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4>// Memory Layout of &#39;Base&#39; object:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4>// [ vptr ] (8 bytes) -&gt; Points to Base::vtable
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4>// [  x   ] (4 bytes)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#6272a4>// [ pad  ] (4 bytes)
</span></span></span></code></pre></div><h2 class=heading id=12-c-casting>12. C++ casting
<a class=anchor href=#12-c-casting>#</a></h2><p>In games, you constantly have a generic pointer (e.g., <code>AActor*</code> in Unreal or <code>GameObject</code> in Unity) and you need to cast it to a specific class (e.g., <code>Player*</code>)</p><h3 class=heading id=12a-static_castt>12a. <code>static_cast&lt;T></code>
<a class=anchor href=#12a-static_castt>#</a></h3><p>I like to call this the &ldquo;I know what I&rsquo;m doing&rdquo; cast lol</p><ul><li>When? Compile-time check. Used when you are 100% sure the types are compatible (e.g., <code>float</code> to <code>int</code>, or <code>Base</code> to <code>Derived</code> if you are certain).</li><li>Cost is free, zero runtime overhead</li><li>Danger: If you cast a generic <code>Enemy*</code> to <code>Boss*</code>, but it was actually a <code>Minion*</code>, the game will crash or have a corrupted memory</li></ul><h3 class=heading id=12b-dynamic_castt>12b. <code>dynamic_cast&lt;T></code>
<a class=anchor href=#12b-dynamic_castt>#</a></h3><p>This is the &ldquo;safety check&rdquo; cast</p><ul><li>When? Runtime check. Used when you don&rsquo;t know what the object is</li><li>If the cast is illega, it returns <code>nullptr</code></li><li>Cost is slow, since it relies on RTTI (Run-time type information). It has to crawl through the class hierarchy string names to check compatibility</li><li>Many game engines like UE disable RTTI for performance and provide their own version <code>Cast&lt;T></code></li></ul><h3 class=heading id=12c-const_castt>12c. <code>const_cast&lt;T></code>
<a class=anchor href=#12c-const_castt>#</a></h3><ul><li>When? To remove the <code>const</code> property</li><li>Red flag: If you use this, you usually designed your architecture wrong</li></ul><h3 class=heading id=12d-reinterpret_castt>12d. <code>reinterpret_cast&lt;T></code>
<a class=anchor href=#12d-reinterpret_castt>#</a></h3><p>Or as how I like to call it the &ldquo;Trust me, bro&rdquo; cast lol</p><ul><li>When? Treating bits as something else. e.g., Casting a pointer to an integer</li><li>Usage is typically in low-level networking or serialization</li></ul><h3 class=heading id=12e-example>12e. Example
<a class=anchor href=#12e-example>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>OnHit</span>(Entity<span style=color:#ff79c6>*</span> other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#6272a4>// BAD: C-Style cast (Hard to search for, unsafe)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Player* p = (Player*)other; 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#6272a4>// GOOD: Dynamic cast (Safe, but slow)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    Player<span style=color:#ff79c6>*</span> p <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>dynamic_cast</span><span style=color:#ff79c6>&lt;</span>Player<span style=color:#ff79c6>*&gt;</span>(other);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#ff79c6>if</span> (p) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        p<span style=color:#ff79c6>-&gt;</span>TakeDamage();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// BEST (In Unreal Engine):
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Player* p = Cast&lt;Player&gt;(other); // Uses custom fast casting
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=13-const-correctness>13. <code>const</code> correctness
<a class=anchor href=#13-const-correctness>#</a></h2><p>This is a &ldquo;character trait&rdquo;, shows you are <strong>disciplined</strong></p><p>If a function does not modify the object, it <strong>must</strong> be marked as <code>const</code></p><p>Why?</p><ul><li>Safety, the compiler will error if you accidentally change a variable inside the function body</li><li>API design, implicitly tells other programmer that &ldquo;it&rsquo;s safe to call this function, this won&rsquo;t break anything since it doesn&rsquo;t mutate any value&rdquo;</li></ul><p>I typically got caught off-guard about this: <code>const int*</code> vs <code>int* const</code></p><ul><li><code>const int* ptr</code>: The data is constant. (You can&rsquo;t change the value <code>*ptr = 5</code>, but you can move the pointer <code>ptr++</code>)</li><li><code>int* const ptr</code>: The pointer is constant. (You can change the value <code>*ptr = 5</code>, but you can&rsquo;t move the pointer <code>ptr++</code>)</li><li><code>const int* const ptr</code>: Both are constant</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Weapon</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>int</span> ammo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// This function MUST be const because it just reads data.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> GetAmmo() <span style=color:#ff79c6>const</span> { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        <span style=color:#6272a4>// ammo--; // &lt;--- Compiler Error! Good!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> ammo; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// This function cannot be const because it changes state.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Fire</span>() { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        ammo<span style=color:#ff79c6>--</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateUI</span>(<span style=color:#ff79c6>const</span> Weapon<span style=color:#ff79c6>&amp;</span> w) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// Because &#39;w&#39; is passed as const reference...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> w.GetAmmo(); <span style=color:#6272a4>// Allowed (GetAmmo is const)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// w.Fire(); // Compiler Error! (Fire is not const)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=14-special-member-functions-the-implicit-rules>14. Special Member Functions (The Implicit Rules)
<a class=anchor href=#14-special-member-functions-the-implicit-rules>#</a></h2><p>We touched on the Rule of three and five. But you need to know exactly <strong>what</strong> the compiler generates for you and <strong>when</strong> it stops doing so</p><p>The 6 special members:</p><ol><li>Default Constructor</li><li>Destructor</li><li>Copy Constructor</li><li>Copy Assignment Operator</li><li>Move Constructor</li><li>Move Assignment Operator</li></ol><p>The hidden rules:</p><ol><li>If you declare <em>any</em> constrctor, the compiler <strong>stops generating the Default Constructor</strong></li><li>If you declare a Move operation, be it constructor or assignment, the compiler <strong>deletes</strong> the Copy operations implicitly</li></ol><p>Rule 2 caught me off-guard so many times</p><p>Say you write this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#8be9fd>int</span> health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    std<span style=color:#ff79c6>::</span>string name;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>};
</span></span></code></pre></div><p>Here is the <strong>exact</strong> code the compiler generates behind the scenes. It performs <strong>Member-wise</strong> operations</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>int</span> health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    std<span style=color:#ff79c6>::</span>string name;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// 1. Implicit Default Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// It calls the default constructor of every member.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Note: &#39;health&#39; (int) is NOT initialized (contains garbage) because it&#39;s a primitive.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// &#39;name&#39; (string) IS initialized to &#34;&#34; because std::string has a constructor.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    Player() <span style=color:#ff79c6>:</span> health(), name() {} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// 2. Implicit Destructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Calls destructors of members in REVERSE order of declaration.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>~</span>Player() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// name.~string(); // Called automatically
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// health (int) has no destructor, so nothing happens.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#6272a4>// 3. Implicit Copy Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Copies every member.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    Player(<span style=color:#ff79c6>const</span> Player<span style=color:#ff79c6>&amp;</span> other) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        <span style=color:#ff79c6>:</span> health(other.health), name(other.name) {} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#6272a4>// 4. Implicit Copy Assignment Operator
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>    Player<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(<span style=color:#ff79c6>const</span> Player<span style=color:#ff79c6>&amp;</span> other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        health <span style=color:#ff79c6>=</span> other.health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>        name <span style=color:#ff79c6>=</span> other.name; <span style=color:#6272a4>// Calls std::string::operator=
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#6272a4>// 5. Implicit Move Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Casts every member to r-value reference (std::move).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4></span>    Player(Player<span style=color:#ff79c6>&amp;&amp;</span> other) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>        <span style=color:#ff79c6>:</span> health(std<span style=color:#ff79c6>::</span>move(other.health)), name(std<span style=color:#ff79c6>::</span>move(other.name)) {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#6272a4>// 6. Implicit Move Assignment Operator
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4></span>    Player<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(Player<span style=color:#ff79c6>&amp;&amp;</span> other) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        health <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>move(other.health);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        name <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>move(other.name); <span style=color:#6272a4>// Calls std::string::operator=(string&amp;&amp;)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>};
</span></span></code></pre></div><p>Typical game engine usage: <code>delete</code> keyword</p><p>In games, many object like <code>RenderContext</code> and <code>NetworkSocket</code> <strong>should never be copied</strong>. You must <strong>explicitly</strong> disable these functions</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Texture</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>// 1. Allow Default Construction
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    Texture() <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>default</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// 2. DISABLE Copying (Unique Asset)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// If someone tries: Texture b = a; -&gt; Compiler Error.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    Texture(<span style=color:#ff79c6>const</span> Texture<span style=color:#ff79c6>&amp;</span>) <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>delete</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    Texture<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(<span style=color:#ff79c6>const</span> Texture<span style=color:#ff79c6>&amp;</span>) <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>delete</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// 3. ALLOW Moving (Transfer ownership)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    Texture(Texture<span style=color:#ff79c6>&amp;&amp;</span>) <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>default</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    Texture<span style=color:#ff79c6>&amp;</span> <span style=color:#ff79c6>operator</span><span style=color:#ff79c6>=</span>(Texture<span style=color:#ff79c6>&amp;&amp;</span>) <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>default</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>};
</span></span></code></pre></div><h2 class=heading id=15-crtp-curiously-recurring-template-pattern>15. CRTP (Curiously Recurring Template Pattern)
<a class=anchor href=#15-crtp-curiously-recurring-template-pattern>#</a></h2><p>This is a technique to achieve <strong>Polymorphism</strong> (overriding behavior) without <strong>Virtual Functions</strong>. Weird, right?</p><p>Why it matters?
Virtual functions have runtime overhead (vtable lookup). CRTP resolves the function call at <strong>Compile Time</strong>. It is heavily used in engine math libraries and ECS frameworks</p><p>The pattern: The Base class takes the Derived class as a template parameter</p><p><code>class Derived : public Base&lt;Derived> { ... }</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> Derived<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>SpriteBase</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#8be9fd>void</span> Draw() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#6272a4>// STATIC POLYMORPHISM
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We cast &#39;this&#39; to the Derived type at compile time.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// No vtable. No runtime lookup. The compiler inlines this.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>static_cast</span><span style=color:#ff79c6>&lt;</span>Derived<span style=color:#ff79c6>*&gt;</span>(<span style=color:#ff79c6>this</span>)<span style=color:#ff79c6>-&gt;</span>DrawImplementation();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>PlayerSprite</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> SpriteBase<span style=color:#ff79c6>&lt;</span>PlayerSprite<span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#8be9fd>void</span> DrawImplementation() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Drawing Player</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>EnemySprite</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> SpriteBase<span style=color:#ff79c6>&lt;</span>EnemySprite<span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#8be9fd>void</span> DrawImplementation() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Drawing Enemy</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4>// Usage
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#8be9fd>void</span> Render(SpriteBase<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;&amp;</span> sprite) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    sprite.Draw(); <span style=color:#6272a4>// Calls specific implementation directly
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=16-sfinae-substitution-failure-is-not-an-error>16. SFINAE (Substitution Failure Is Not An Error)
<a class=anchor href=#16-sfinae-substitution-failure-is-not-an-error>#</a></h2><p>C++ and their stupid naming. Sounds scary but this is actually useful</p><p>It allows you to write functions that <em>only exist</em> for specific types</p><p>Why it matters?</p><p>You might want a generic <code>Serialize()</code> function, but you&rsquo;d like it to behave differntly for <code>int</code>, <code>struct</code>, and <code>ptrs</code>. SFINAE lets you enable/disable functions based on the type passed in</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;type_traits&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>// Function 1: Only compiles if T is a Floating Point number (float, double)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>enable_if<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_floating_point<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value, <span style=color:#8be9fd>void</span><span style=color:#ff79c6>&gt;::</span>type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>ProcessMath(T value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Processing Float: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> value <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>// Function 2: Only compiles if T is an Integer (int, long)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>enable_if<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value, <span style=color:#8be9fd>void</span><span style=color:#ff79c6>&gt;::</span>type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>ProcessMath(T value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Processing Int: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> value <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    ProcessMath(<span style=color:#bd93f9>10.5f</span>); <span style=color:#6272a4>// Calls Function 1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>    ProcessMath(<span style=color:#bd93f9>5</span>);     <span style=color:#6272a4>// Calls Function 2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// ProcessMath(&#34;String&#34;); // Compiler Error: No matching function found!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=17-concepts-c20s-replacement-for-sfinae>17. Concepts (C++20&rsquo;s replacement for SFINAE)
<a class=anchor href=#17-concepts-c20s-replacement-for-sfinae>#</a></h2><p>In the previous section, we looked at SFINAE (<code>std::enable_if</code>). It is ugly, hard to read, and produces terrifying compiler error messages (often 100 lines of template garbage)</p><p><strong>Concepts</strong> are the modern replacement. They allow you to specify <strong>Constraints</strong> on template parameters in plain English</p><h3 class=heading id=17a-replacing-sfinae-with-concepts>17a. Replacing SFINAE with concepts
<a class=anchor href=#17a-replacing-sfinae-with-concepts>#</a></h3><p>Let&rsquo;s rewrite the Math example from the previous section</p><p>SFINAE code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>typename</span> std<span style=color:#ff79c6>::</span>enable_if<span style=color:#ff79c6>&lt;</span>std<span style=color:#ff79c6>::</span>is_integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;::</span>value, <span style=color:#8be9fd>void</span><span style=color:#ff79c6>&gt;::</span>type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>Process(T value) { ... }
</span></span></code></pre></div><p>Concepts code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;concepts&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4>// Syntax 1: The &#34;requires&#34; clause
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>requires</span> std<span style=color:#ff79c6>::</span>integral<span style=color:#ff79c6>&lt;</span>T<span style=color:#ff79c6>&gt;</span> <span style=color:#6272a4>// &lt;--- Readable!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> Process(T value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Processing Int: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> value <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// Syntax 2: Abbreviated Template (Even cleaner)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Process</span>(std<span style=color:#ff79c6>::</span>floating_point <span style=color:#ff79c6>auto</span> value) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Processing Float: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> value <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><h3 class=heading id=17b-custom-concepts-aka-duck-typing>17b. Custom Concepts aka. Duck Typing
<a class=anchor href=#17b-custom-concepts-aka-duck-typing>#</a></h3><p>You can define a Concept that says: &ldquo;<em>Look, I don&rsquo;t care what class this is, as long as it has a <code>Draw()</code> function</em>&rdquo;.</p><p>Define the concept:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>template</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>typename</span> T<span style=color:#ff79c6>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6>concept</span> Renderable <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>requires</span>(T a) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    { a.Draw() } <span style=color:#ff79c6>-&gt;</span> std<span style=color:#ff79c6>::</span>same_as<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>void</span><span style=color:#ff79c6>&gt;</span>; <span style=color:#6272a4>// Must have Draw() returning void
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    { a.GetZOrder() } <span style=color:#ff79c6>-&gt;</span> std<span style=color:#ff79c6>::</span>convertible_to<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span>; <span style=color:#6272a4>// Must have GetZOrder() returning int
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>};
</span></span></code></pre></div><p>Using the concept:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Player</span> { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#8be9fd>void</span> Draw() {} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>GetZOrder</span>() { <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>1</span>; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>SoundManager</span> { 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#6272a4>// No Draw() function
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>// This function ONLY accepts types that fit the &#39;Renderable&#39; concept
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>RenderObject</span>(Renderable <span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;</span> obj) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    obj.Draw();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    Player p;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    RenderObject(p); <span style=color:#6272a4>// OK!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    SoundManager s;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#6272a4>// RenderObject(s); 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// ERROR: &#34;SoundManager does not satisfy concept Renderable. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>//        because &#39;a.Draw()&#39; would be invalid.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=18-template-metaprogramming-tmp>18. Template Metaprogramming (TMP)
<a class=anchor href=#18-template-metaprogramming-tmp>#</a></h2><p>Wikipedia calls it &ldquo;art&rdquo; of writing code that runs entirely during <strong>Compilation</strong>. Depending on your use-case though, this might actually complicate things and &ldquo;muck&rdquo; the &ldquo;art&rdquo;</p><p>Why it matters?
If you can calculate something at compile time, like Sine Table or a String Hash, the CPU can save cycles at runtime. As they say, &ldquo;Runtime is expensive, Compile time is free&rdquo;</p><p>In modern C++, we use <code>constexpr</code>. Unlike old C++ that uses recursive templates, starting from C++17 onwards, we use <code>constexpr</code> instead, which look like normal code but runs during compilation</p><p>Code example: Compile-time String Hashing
As discussed in the String section, game engines typically hashes Strings into integer IDs for faster comparison and indexing. With TMP, we can hash the string <code>"Player.png"</code> into an integer <code>0xA1B2</code> <em>while the game is compiling</em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// C++17 constexpr function
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>uint32_t</span> <span style=color:#50fa7b>HashString</span>(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>char</span><span style=color:#ff79c6>*</span> str) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#8be9fd>uint32_t</span> hash <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5381</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>while</span> (<span style=color:#ff79c6>*</span>str) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        hash <span style=color:#ff79c6>=</span> ((hash <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#bd93f9>5</span>) <span style=color:#ff79c6>+</span> hash) <span style=color:#ff79c6>+</span> <span style=color:#ff79c6>*</span>str; <span style=color:#6272a4>// hash * 33 + c
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>        str<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>return</span> hash;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// This calculation happens inside the compiler.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// The resulting binary just contains the number: 228562779
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// NO runtime CPU cost.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>constexpr</span> <span style=color:#8be9fd>uint32_t</span> PlayerID <span style=color:#ff79c6>=</span> HashString(<span style=color:#f1fa8c>&#34;Player&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#ff79c6>switch</span>(InputID) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>PlayerID</span>: <span style=color:#6272a4>// We can even use it in switch cases!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>            <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div><h1 class=heading id=oop-vs-dod>OOP vs DOD
<a class=anchor href=#oop-vs-dod>#</a></h1><p>A trendy topic. Game engines like Unity with DOTS and UE with Mass Entity are traditionally an OOP engine that attempting to move towards DOD. But why?</p><h2 class=heading id=1-the-fundamental-difference>1. The fundamental difference
<a class=anchor href=#1-the-fundamental-difference>#</a></h2><ul><li>OOP, <em>object-oriented</em>. Organizes code around &ldquo;<strong>Things</strong>&rdquo; (Objects)<ul><li><em>Mental model</em>: A <code>Player</code> is a:<ul><li>Box that contains<ul><li><code>Health</code></li><li><code>Pos</code></li><li><code>Velocity</code></li><li><code>Update()</code> func</li></ul></li></ul></li></ul></li><li>DOD, <em>data-oriented</em>. Organizes code around &ldquo;<strong>Data</strong>&rdquo; (Arrays)<ul><li><em>Mental model</em>: There&rsquo;s arrays of:<ul><li><code>Healths</code></li><li><code>Positions</code></li><li><code>Velocities</code></li></ul></li><li>Player is just an <code>index</code> in all those arrays</li></ul></li></ul><h2 class=heading id=2-the-hardware-reality-cpu-cache>2. The hardware reality (CPU cache)
<a class=anchor href=#2-the-hardware-reality-cpu-cache>#</a></h2><ul><li>CPU is <em>super</em> fast. While RAM is slow</li><li>When the CPU asks for data, it fetches a <strong>Cache Line</strong> (64 bytes)</li><li>Your goal is to: if you fetch 64 bytes, you want <em>all</em> 64 bytes to be <strong>useful</strong> data</li></ul><p><strong>The OOP problem (Array of Structs - AoS)</strong></p><p>Imagine you have an array of <code>Enemy</code> objects. You&rsquo;d want to update their positions via <code>Pos += Vel * dt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Enemy</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#8be9fd>bool</span> isDead;        <span style=color:#6272a4>// 1 byte (+3 padding)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>    Vector3 position;   <span style=color:#6272a4>// 12 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    Vector3 velocity;   <span style=color:#6272a4>// 12 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> aiState;        <span style=color:#6272a4>// 4 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> health;       <span style=color:#6272a4>// 4 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    Texture<span style=color:#ff79c6>*</span> sprite;    <span style=color:#6272a4>// 8 bytes
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Total: ~48 bytes per Enemy
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Enemy<span style=color:#ff79c6>&gt;</span> enemies; <span style=color:#6272a4>// The &#34;Array of Structures&#34;
</span></span></span></code></pre></div><p>The loop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>&amp;</span> <span style=color:#8be9fd;font-style:italic>e</span> : enemies) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    e.position <span style=color:#ff79c6>+=</span> e.velocity <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span></code></pre></div><p>What the CPU sees:</p><ol><li>Fetch <code>Enemy[0]</code>. We need <code>position</code> and <code>velocity</code> (24 bytes)</li><li>We also loaded <code>isDead</code>, <code>aiState</code>, <code>health</code>, and <code>sprite</code> into the cache. <strong>We don&rsquo;t need them.</strong> That is &ldquo;Waste</li><li>Because the struct is large (48 bytes), a 64-byte cache line can only hold <strong>1.3 enemies</strong></li><li>To update 1000 enemies, we need to fetch from RAM hundreds of times, slow</li></ol><p><strong>The DOD approach (Structs of Arrays - SoA)</strong></p><p>Instead of one class, we split the data into separate arrays</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>EnemySystem</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Vector3<span style=color:#ff79c6>&gt;</span> positions;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Vector3<span style=color:#ff79c6>&gt;</span> velocities;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>float</span><span style=color:#ff79c6>&gt;</span> healths;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> aiStates;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>};
</span></span></code></pre></div><p>The loop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// We only touch the position and velocity arrays
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> count; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    positions[i] <span style=color:#ff79c6>+=</span> velocities[i] <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>What the CPU sees:</p><ol><li>We load the <code>positions</code> array. It is <em>just</em> Vector3s</li><li>A 64-byte cache line holds <strong>5.3 positions</strong> (12 bytes each)</li><li>We load the <code>velocities</code> array</li></ol><p>We process 4-5x more enemies per RAM fetch and this layout is perfectfor <strong>SIMD</strong>. Allowing the CPU to update 4 positions at once</p><h2 class=heading id=3-when-to-use-oop-vs-dod>3. When to use OOP vs DOD?
<a class=anchor href=#3-when-to-use-oop-vs-dod>#</a></h2><p>DOD by itself is not a silver bullet. It is harder to write and debug</p><ul><li><p>Use OOP for:</p><ul><li>The Main Player (Complex logic, lots of unique state)</li><li>UI Systems</li><li>Game Mode / Game State logic</li><li>Interaction systems (Doors, Chests)</li></ul></li><li><p>Use DOD for:</p><ul><li>10,000 Zombies</li><li>Particle Systems</li><li>Traffic simulation</li><li>Anything where you have <strong>lots of objects doing the same thing</strong></li></ul></li></ul><h2 class=heading id=4-converting-oop---dod-code-example>4. Converting OOP -> DOD code example
<a class=anchor href=#4-converting-oop---dod-code-example>#</a></h2><p>OOP style</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Ball</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    Vector3 pos, vel;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#8be9fd>void</span> Update(<span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        pos <span style=color:#ff79c6>+=</span> vel <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Ball<span style=color:#ff79c6>&gt;</span> balls;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#6272a4>// Update: balls[i].Update(dt); -&gt; Pointer chasing / Cache pollution
</span></span></span></code></pre></div><p>DOD style</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>BallData</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Vector3<span style=color:#ff79c6>&gt;</span> positions;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Vector3<span style=color:#ff79c6>&gt;</span> velocities;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateBalls</span>(BallData<span style=color:#ff79c6>&amp;</span> data, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    size_t count <span style=color:#ff79c6>=</span> data.positions.size();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// This loop is incredibly fast and auto-vectorizable by the compiler
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (size_t i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> count; <span style=color:#ff79c6>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        data.positions[i] <span style=color:#ff79c6>+=</span> data.velocities[i] <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>}
</span></span></code></pre></div><h2 class=heading id=4-ecs>4. ECS
<a class=anchor href=#4-ecs>#</a></h2><p>ECS is the formal architectural pattern for Data-Oriented Programming.</p><ul><li><p>Entity is just an ID (int), e.g., <code>Entity #50</code></p></li><li><p>Component: <strong>Pure Data. No functions</strong></p><ul><li><code>PositionComponent { x, y, z }</code></li><li><code>VelocityComponent { x, y, z }</code></li></ul></li><li><p>System: The logic itself. Runs on arrays of components</p><ul><li><code>MovementSystem</code>: Iterats <em>all</em> <code>Position</code> and <code>Velocity</code> components, and adds them</li></ul></li><li><p>ECS uses a &lsquo;Structure of Arrays&rsquo; layout which maximizes Cache Locality</p></li><li><p>By keeping similar data contiguous in memory, we reduce Cache Misses</p></li><li><p>It also decouples logic from data, making it easier to parallelize (multithread) updates because systems don&rsquo;t have complex dependencies like OOP inheritance trees</p></li></ul><p><strong>Mini, native ECS implementation</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;vector&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5</span><span><span style=color:#6272a4>// 1. COMPONENTS (Pure Data)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Position</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8</span><span>    <span style=color:#8be9fd>float</span> x, y;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>Velocity</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12</span><span>    <span style=color:#8be9fd>float</span> x, y;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16</span><span><span style=color:#6272a4>// 2. THE ECS MANAGER (The &#34;Database&#34;)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>ECSManager</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20</span><span>    <span style=color:#6272a4>// DEFINITION OF &#34;ENTITY&#34;:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// An Entity is just an index into these arrays.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Entity 0 is index 0, Entity 1 is index 1.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24</span><span>    <span style=color:#6272a4>// STORAGE (Structure of Arrays - SoA):
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Instead of vector&lt;Object&gt;, we have vectors of data types.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// This ensures contiguous memory for the CPU cache.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Position<span style=color:#ff79c6>&gt;</span> positions;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span>Velocity<span style=color:#ff79c6>&gt;</span> velocities;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30</span><span>    <span style=color:#6272a4>// MASKS:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We need to know which entity has which component.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// (In a real engine, we&#39;d use a Bitmask, e.g., 0b0011)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&gt;</span> hasPosition;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34</span><span>    std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&gt;</span> hasVelocity;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36</span><span>    <span style=color:#6272a4>// Create a new &#34;Entity&#34; (Just resizing the arrays)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>CreateEntity</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38</span><span>        positions.emplace_back();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39</span><span>        velocities.emplace_back();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40</span><span>        hasPosition.push_back(<span style=color:#8be9fd;font-style:italic>false</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41</span><span>        hasVelocity.push_back(<span style=color:#8be9fd;font-style:italic>false</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42</span><span>        <span style=color:#ff79c6>return</span> positions.size() <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>; <span style=color:#6272a4>// Return the ID
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45</span><span>    <span style=color:#6272a4>// Add Component Functions
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>AddPosition</span>(<span style=color:#8be9fd>int</span> entityID, <span style=color:#8be9fd>float</span> x, <span style=color:#8be9fd>float</span> y) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47</span><span>        positions[entityID] <span style=color:#ff79c6>=</span> {x, y};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48</span><span>        hasPosition[entityID] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>AddVelocity</span>(<span style=color:#8be9fd>int</span> entityID, <span style=color:#8be9fd>float</span> x, <span style=color:#8be9fd>float</span> y) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52</span><span>        velocities[entityID] <span style=color:#ff79c6>=</span> {x, y};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53</span><span>        hasVelocity[entityID] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58</span><span><span style=color:#6272a4>// 3. THE SYSTEM (The Logic)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MovementSystem</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62</span><span>    <span style=color:#8be9fd>void</span> Update(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>float</span> deltaTime) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63</span><span>        <span style=color:#6272a4>// THE PERFORMANCE MAGIC:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We iterate through raw data arrays. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// The CPU loads a chunk of Positions, then a chunk of Velocities.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Very few cache misses compared to jumping between Objects.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67</span><span><span style=color:#6272a4></span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68</span><span>        size_t count <span style=color:#ff79c6>=</span> ecs.positions.size();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70</span><span>        <span style=color:#ff79c6>for</span> (size_t i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> count; <span style=color:#ff79c6>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71</span><span>            <span style=color:#6272a4>// Check if this entity has BOTH components required for movement
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72</span><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>if</span> (ecs.hasPosition[i] <span style=color:#ff79c6>&amp;&amp;</span> ecs.hasVelocity[i]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73</span><span>                
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74</span><span>                <span style=color:#6272a4>// Logic: Pos += Vel * dt
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75</span><span><span style=color:#6272a4></span>                ecs.positions[i].x <span style=color:#ff79c6>+=</span> ecs.velocities[i].x <span style=color:#ff79c6>*</span> deltaTime;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76</span><span>                ecs.positions[i].y <span style=color:#ff79c6>+=</span> ecs.velocities[i].y <span style=color:#ff79c6>*</span> deltaTime;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83</span><span><span style=color:#6272a4>// 4. USAGE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84</span><span><span style=color:#6272a4>// ==========================================
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86</span><span>    ECSManager ecs;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87</span><span>    MovementSystem mover;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89</span><span>    <span style=color:#6272a4>// 1. Create Entities
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> playerID <span style=color:#ff79c6>=</span> ecs.CreateEntity();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91</span><span>    ecs.AddPosition(playerID, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92</span><span>    ecs.AddVelocity(playerID, <span style=color:#bd93f9>10</span>, <span style=color:#bd93f9>5</span>); <span style=color:#6272a4>// Player moves
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94</span><span>    <span style=color:#8be9fd>int</span> treeID <span style=color:#ff79c6>=</span> ecs.CreateEntity();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95</span><span>    ecs.AddPosition(treeID, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>50</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96</span><span>    <span style=color:#6272a4>// Tree has NO velocity, so the system will skip it
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98</span><span>    <span style=color:#6272a4>// 2. Game Loop
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> dt <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0.016f</span>; <span style=color:#6272a4>// 60 FPS
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101</span><span>    mover.Update(ecs, dt);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103</span><span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Player Pos: &#34;</span> <span style=color:#ff79c6>&lt;&lt;</span> ecs.positions[playerID].x <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; <span style=color:#6272a4>// Output: 0.16
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104</span><span><span style=color:#6272a4></span>    std<span style=color:#ff79c6>::</span>cout <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;Tree Pos: &#34;</span>   <span style=color:#ff79c6>&lt;&lt;</span> ecs.positions[treeID].x   <span style=color:#ff79c6>&lt;&lt;</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>; <span style=color:#6272a4>// Output: 50 (Unchanged)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107</span><span>}
</span></span></code></pre></div><p><strong>IMPORTANT NOTE</strong></p><ul><li>This is a naive implementation where the Entity ID matches the Array Index</li><li>In a real engine (like EnTT or FLECS), we would use Sparse Sets or Archetypes to handle the fact that not all entities have all components, to avoid wasting memory on empty slots</li></ul><h2 class=heading id=5-parallelization>5. Parallelization
<a class=anchor href=#5-parallelization>#</a></h2><h3 class=heading id=5a-oop-concurrency-problem>5a. OOP concurrency problem
<a class=anchor href=#5a-oop-concurrency-problem>#</a></h3><p>Why is it hard to multithread standard OOP code?</p><ul><li>Hidden Dependencies: Object A might call <code>ObjectB->GetHealth()</code>. If Thread 1 updates Object A and Thread 2 updates Object B, you might get a race condition</li><li>Deadlocks: To fix race conditions, you add Mutexes/Locks. If A locks B, and B locks A, the game freezes</li><li>Pointer Chasing: Threads spend more time waiting for RAM (Cache Misses) than actually doing math</li></ul><h3 class=heading id=5b-data-parallelism>5b. Data parallelism
<a class=anchor href=#5b-data-parallelism>#</a></h3><p>In ECS, we have a contiguous array of <code>Positions</code></p><ul><li>Independence: Updating <code>Position[0]</code> has zero effect on <code>Position[1]</code></li><li>The Strategy: We don&rsquo;t need complex locks. We just split the array<ul><li>Core 1: Updates indices 0 to 5,000</li><li>Core 2: Updates indices 5,001 to 10,000</li></ul></li></ul><h3 class=heading id=5c-code-example>5c. Code example
<a class=anchor href=#5c-code-example>#</a></h3><p>We extend the previous Mini-ECS. We will use C++17 Parallel Algorithms (<code>std::execution::par</code>) to show how trivial this becomes with DOD. In UE, you&rsquo;d use <code>ParallelFor</code> instead</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;execution&gt;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// C++17 Parallel Policies
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;algorithm&gt;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// for std::for_each
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;numeric&gt;</span><span style=color:#ff79c6>   </span><span style=color:#6272a4>// for std::iota
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MovementSystem</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#6272a4>// 1. Single-Threaded (Old Way)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> UpdateSerial(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        <span style=color:#ff79c6>for</span> (size_t i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> ecs.positions.size(); <span style=color:#ff79c6>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>            ProcessEntity(ecs, i, dt);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#6272a4>// 2. Multi-Threaded (The DOD Way)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateParallel</span>(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        size_t count <span style=color:#ff79c6>=</span> ecs.positions.size();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#6272a4>// Helper: Create a vector of indices [0, 1, 2, ... count-1]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We need this to iterate over indices in parallel.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> indices(count);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        std<span style=color:#ff79c6>::</span>iota(indices.begin(), indices.end(), <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// EXECUTE IN PARALLEL
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// std::execution::par tells the compiler: 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// &#34;You can split this loop across multiple CPU cores.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>for_each(std<span style=color:#ff79c6>::</span>execution<span style=color:#ff79c6>::</span>par, indices.begin(), indices.end(), 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>            [<span style=color:#ff79c6>&amp;</span>](<span style=color:#8be9fd>int</span> i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>                <span style=color:#6272a4>// This lambda runs on multiple threads simultaneously.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4></span>                <span style=color:#6272a4>// Because &#39;i&#39; is unique for every thread, 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span>                <span style=color:#6272a4>// we have NO Race Conditions on writing data.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>                ProcessEntity(ecs, i, dt);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        );
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>    <span style=color:#6272a4>// The logic is identical, but now thread-safe by design
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> ProcessEntity(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>int</span> i, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        <span style=color:#ff79c6>if</span> (ecs.hasPosition[i] <span style=color:#ff79c6>&amp;&amp;</span> ecs.hasVelocity[i]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>            <span style=color:#6272a4>// Read from Velocity (Safe)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#6272a4></span>            <span style=color:#8be9fd>float</span> vx <span style=color:#ff79c6>=</span> ecs.velocities[i].x;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>            <span style=color:#8be9fd>float</span> vy <span style=color:#ff79c6>=</span> ecs.velocities[i].y;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>            <span style=color:#6272a4>// Write to Position (Safe - no other thread touches index &#39;i&#39;)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#6272a4></span>            ecs.positions[i].x <span style=color:#ff79c6>+=</span> vx <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>            ecs.positions[i].y <span style=color:#ff79c6>+=</span> vy <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>};
</span></span></code></pre></div><h3 class=heading id=5d-false-sharing>5d. False Sharing
<a class=anchor href=#5d-false-sharing>#</a></h3><p>There&rsquo;s a hardware pitfall in the code above</p><ul><li>CPU Cores load memory in Cache Lines (64 bytes)</li><li><code>Position</code> struct is 8 bytes (<code>float x, y</code>)</li><li>One Cache Line holds 8 Positions (<code>Pos[0]</code>-<code>Pos[7]</code>)</li></ul><p>Possible scenario:</p><ol><li>Core 1 tries to write to <code>Pos[0]</code></li><li>Core 2 tries to write to <code>Pos[1]</code></li><li>They are on the same Cache Line</li><li>The CPU cores fight over ownership of that cache line. The memory system has to &ldquo;ping-pong&rdquo; the cache line between cores
Result: Performance is worse than single-threaded code</li></ol><p>To fix this, we&rsquo;re gonna do <strong>chunking</strong>. Instead of letting the library decide how to split the work, we explicitly divide our array into Chunks (or Blocks)</p><ul><li>Chunk Size: We pick a size (e.g., 1024 items) that is guaranteed to be larger than a Cache Line (64 bytes)</li><li>The Logic: Thread 1 processes items <code>0</code>-<code>1023</code>. Thread 2 processes 1024 to 2047
The Result: They might fight over the one cache line at the very border (index 1023/1024), but the other 1023 items are processed at maximum speed with zero contention</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;execution&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;algorithm&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;vector&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;numeric&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;cmath&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MovementSystem</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#6272a4>// ... (Previous UpdateSerial code) ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// 3. Multi-Threaded with CHUNKING (False Sharing Fix)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> UpdateParallelChunked(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#8be9fd>int</span> totalEntities <span style=color:#ff79c6>=</span> ecs.positions.size();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// STEP 1: Define a Chunk Size
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// A Cache Line is 64 bytes.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Position (8 bytes) + Velocity (8 bytes) = 16 bytes per entity.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// 4 entities fill a cache line.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We choose 1024 to be extremely safe and reduce overhead.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> CHUNK_SIZE <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1024</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        <span style=color:#6272a4>// STEP 2: Calculate number of chunks needed
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// (Integer division ceiling trick: (A + B - 1) / B)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        <span style=color:#8be9fd>int</span> numChunks <span style=color:#ff79c6>=</span> (totalEntities <span style=color:#ff79c6>+</span> CHUNK_SIZE <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>/</span> CHUNK_SIZE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        <span style=color:#6272a4>// Create a list of Chunk IDs: [0, 1, 2, ... numChunks-1]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>vector<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> chunkIDs(numChunks);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        std<span style=color:#ff79c6>::</span>iota(chunkIDs.begin(), chunkIDs.end(), <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#6272a4>// STEP 3: Parallelize over CHUNKS, not Entities
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>        std<span style=color:#ff79c6>::</span>for_each(std<span style=color:#ff79c6>::</span>execution<span style=color:#ff79c6>::</span>par, chunkIDs.begin(), chunkIDs.end(), 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            [<span style=color:#ff79c6>&amp;</span>](<span style=color:#8be9fd>int</span> chunkIndex) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>                
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>                <span style=color:#6272a4>// Calculate the range for this specific thread
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4></span>                <span style=color:#8be9fd>int</span> start <span style=color:#ff79c6>=</span> chunkIndex <span style=color:#ff79c6>*</span> CHUNK_SIZE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>                
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>                <span style=color:#6272a4>// Ensure the last chunk doesn&#39;t go out of bounds
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#6272a4></span>                <span style=color:#8be9fd>int</span> end <span style=color:#ff79c6>=</span> std<span style=color:#ff79c6>::</span>min(start <span style=color:#ff79c6>+</span> CHUNK_SIZE, totalEntities);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>                <span style=color:#6272a4>// STEP 4: Process the Chunk (Serial Loop)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#6272a4></span>                <span style=color:#6272a4>// This thread now has exclusive access to this range of memory.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#6272a4></span>                <span style=color:#6272a4>// No other thread is writing to indices [start ... end].
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#6272a4></span>                <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> start; i <span style=color:#ff79c6>&lt;</span> end; <span style=color:#ff79c6>++</span>i) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>                    ProcessEntity(ecs, i, dt);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>                }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>        );
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>    <span style=color:#8be9fd>void</span> ProcessEntity(ECSManager<span style=color:#ff79c6>&amp;</span> ecs, <span style=color:#8be9fd>int</span> i, <span style=color:#8be9fd>float</span> dt) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>        <span style=color:#ff79c6>if</span> (ecs.hasPosition[i] <span style=color:#ff79c6>&amp;&amp;</span> ecs.hasVelocity[i]) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>            ecs.positions[i].x <span style=color:#ff79c6>+=</span> ecs.velocities[i].x <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>            ecs.positions[i].y <span style=color:#ff79c6>+=</span> ecs.velocities[i].y <span style=color:#ff79c6>*</span> dt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>};
</span></span></code></pre></div><h1 class=heading id=ue-specific-notes>UE specific notes
<a class=anchor href=#ue-specific-notes>#</a></h1><h2 class=heading id=1-tick-problem>1. <code>Tick()</code> problem
<a class=anchor href=#1-tick-problem>#</a></h2><p>In Unreal, <code>Tick()</code> is the function that runs <strong>every single frame</strong></p><p>Even an empty <code>Tick()</code> function has overhead. The engine has to iterate through a list of ticking actors, check if they are paused, check their tick group, and call the function</p><p>Imagine you have 1,000 enemies. Each one has a Blueprint with a Tick event checking &ldquo;Is Player Close?&rdquo;</p><ul><li>1,000 checks x 60 FPS = 60,000 checks per second</li><li>This logic runs on the <strong>Game Thread</strong>. If the Game Thread takes longer than 16.6ms, your FPS drops below 60</li></ul><p>Ideally, disbable Tick by default (<code>PrimaryActorTick.bCanEverTick = false;</code>) and only enable it for actors that absolutely need continuous updates (like a homing missile/projectiles)</p><h2 class=heading id=2-bp-vs-c>2. BP vs C++
<a class=anchor href=#2-bp-vs-c>#</a></h2><p>Blueprints (BP) are a scripting language running on a Virtual Machine (VM)</p><ul><li>The Speed Difference: Depending on the complexity, raw C++ is roughly 10x to 100x faster than Blueprint logic</li><li>The slowness comes from the &ldquo;marshalling&rdquo; overheadâcalling a C++ function from BP requires the VM to translate data types back and forth</li></ul><p>When to use which?</p><ul><li>Use C++ for:<ul><li>Heavy math (Physics calculations, procedural generation)</li><li><code>Tick()</code> logic (if you must tick)</li><li>Complex loops (looping 10,000 times in BP is suicide)</li><li>Core systems (Inventory, Health, Networking)</li></ul></li><li>Use BP for:<ul><li>One-off events (OnOverlap, OnClicked)</li><li>Visuals (Timelines, spawning particles, playing sounds)</li><li>Level Design (referencing specific assets)</li></ul></li></ul><p>Ideally, the workflow should be like this;</p><ul><li>Expose a UFUNCTION(BlueprintImplementableEvent) called OnTakeDamageVisuals() in C++</li><li>The C++ handles the math (subtracting HP), then calls the BP event so the designer can easily add a flash effect or sound without touching code</li></ul><h2 class=heading id=3-event-driven-architecture>3. Event-driven architecture
<a class=anchor href=#3-event-driven-architecture>#</a></h2><p>Instead of checking &ldquo;Is X happening?&rdquo; every frame (Polling), wait for the engine to tell you &ldquo;X happened&rdquo; (Events)</p><p><strong>Bad (Polling in Tick):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Tick</span>(<span style=color:#8be9fd>float</span> DeltaTime) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#6272a4>// Running this every frame is wasteful
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (GetDistanceTo(Player) <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>100.0f</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        Explode();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p><strong>Event-Driven</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Use a Collision Component (Sphere/Box). The physics engine is already checking overlaps efficiently using spatial partitioning (Octrees/BVH)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>// In Constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>SphereComp<span style=color:#ff79c6>-&gt;</span>OnComponentBeginOverlap.AddDynamic(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>AMine<span style=color:#ff79c6>::</span>OnOverlap);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4>// Only runs ONCE when the player actually touches the sphere
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> AMine<span style=color:#ff79c6>::</span>OnOverlap(...) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    Explode();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h2 class=heading id=4-timers>4. Timers
<a class=anchor href=#4-timers>#</a></h2><p>If you need to check something periodically (e.g., &ldquo;Regenerate Health&rdquo;), do not use Tick. Use a Timer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>GetWorldTimerManager().SetTimer(RegenHandle, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>APlayer<span style=color:#ff79c6>::</span>RegenHealth, <span style=color:#bd93f9>1.0f</span>, <span style=color:#8be9fd;font-style:italic>true</span>);
</span></span></code></pre></div><p>This runs once per second, not 60 times per second. It removes the load from the critical frame loop</p><h2 class=heading id=5-significance-manager>5. Significance Manager
<a class=anchor href=#5-significance-manager>#</a></h2><p>Not all objects are equal. An enemy 5 meters away is &ldquo;Significant.&rdquo; An enemy 500 meters away is &ldquo;Insignificant&rdquo;</p><p>How it works:</p><ul><li>You implement logic to lower the &ldquo;Tick Rate&rdquo; based on significance<ul><li>Close: Tick every frame. High quality animation</li><li>Far: Tick every 10 frames. Disable animation updates. Use lower LOD (Level of Detail) meshes</li></ul></li></ul><p>Use Significance Manager to throttle the tick rate of distant entities, or simply disable their Tick entirely until they come within range</p><h2 class=heading id=6-cast-vs-interface-soft-reference>6. Cast vs Interface (Soft Reference)
<a class=anchor href=#6-cast-vs-interface-soft-reference>#</a></h2><p>This is about <strong>Memory Management</strong></p><p>The Scenario: You have a <code>PlayerCharacter</code>. You want to interact with a <code>Chest</code>, a <code>Door</code>, and a <code>Lever</code></p><ol><li>Approach A: Casting (The &ldquo;Hard Reference&rdquo;)
If you Cast, you tell the engine: &ldquo;This Player class knows <em>about</em> the Chest class&rdquo;</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Player.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Chest.h&#34;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// &lt;--- HARD REFERENCE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Door.h&#34;</span><span style=color:#ff79c6>  </span><span style=color:#6272a4>// &lt;--- HARD REFERENCE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd>void</span> APlayer<span style=color:#ff79c6>::</span>Interact(AActor<span style=color:#ff79c6>*</span> Target) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// Try to cast to Chest
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    AChest<span style=color:#ff79c6>*</span> Chest <span style=color:#ff79c6>=</span> Cast<span style=color:#ff79c6>&lt;</span>AChest<span style=color:#ff79c6>&gt;</span>(Target);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>if</span> (Chest) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        Chest<span style=color:#ff79c6>-&gt;</span>Open();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#6272a4>// Try to cast to Door
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    ADoor<span style=color:#ff79c6>*</span> Door <span style=color:#ff79c6>=</span> Cast<span style=color:#ff79c6>&lt;</span>ADoor<span style=color:#ff79c6>&gt;</span>(Target);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#ff79c6>if</span> (Door) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>        Door<span style=color:#ff79c6>-&gt;</span>Open();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><p>When you load <code>Player.uasset</code> (or spawn the C++ class), the engine sees the <code>#include "Chest.h"</code>. It says &ldquo;I need to load the Chest class to know what it is&rdquo;</p><ul><li>The Chest class references a <code>Gold Texture</code></li><li>The Chest class references a <code>Wood Sound</code>
Just spawning the Player loads the Chest, the Door, the Gold Texture, and the Wood Sound into RAM. Even if there is no chest in the level&mldr;</li></ul><ol start=2><li>Approach B: Interfaces (The &ldquo;Decoupled&rdquo; Solution)
An Interface is a contract. &ldquo;I promise I have a function called <code>OnInteract()</code>.&rdquo; The Player doesn&rsquo;t care who implements it</li></ol><p>Step 1: Define the Interface</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// InteractInterface.h
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#pragma once
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;CoreMinimal.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;UObject/Interface.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;InteractInterface.generated.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>UINTERFACE(MinimalAPI)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>UInteractInterface</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> UInterface { GENERATED_BODY() };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>IInteractInterface</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#6272a4>// BlueprintNativeEvent allows both C++ and BP to override this
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    UFUNCTION(BlueprintNativeEvent, BlueprintCallable)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    <span style=color:#8be9fd>void</span> OnInteract();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>};
</span></span></code></pre></div><p>Step 2: Implement in Objects</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Chest.h
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AChest</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> AActor, <span style=color:#ff79c6>public</span> IInteractInterface {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>OnInteract_Implementation</span>() <span style=color:#ff79c6>override</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        OpenChestLogic();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>};
</span></span></code></pre></div><p>Step 3: Call it from Player (No Casting!)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Player.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;InteractInterface.h&#34;</span><span style=color:#ff79c6> </span><span style=color:#6272a4>// Only includes the lightweight interface
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#8be9fd>void</span> APlayer<span style=color:#ff79c6>::</span>Interact(AActor<span style=color:#ff79c6>*</span> Target) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#6272a4>// Check if the target implements the interface
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (Target <span style=color:#ff79c6>&amp;&amp;</span> Target<span style=color:#ff79c6>-&gt;</span>Implements<span style=color:#ff79c6>&lt;</span>UInteractInterface<span style=color:#ff79c6>&gt;</span>()) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#6272a4>// Execute the function. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// We don&#39;t know if it&#39;s a Chest or a Door. We don&#39;t care.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>        IInteractInterface<span style=color:#ff79c6>::</span>Execute_OnInteract(Target);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span></code></pre></div><p>The Result:</p><ul><li>The Player class does not know <code>Chest.h</code> exists</li><li>Loading the Player does not load the Chest textures/sounds</li><li>You save memory usage and reduce load times</li></ul><p>Prefer Interfaces for interaction systems to avoid creating hard reference chains. This ensures that loading the Player character doesn&rsquo;t accidentally load every interactive object in the entire game into memory</p><h2 class=heading id=7-ues-uobject-castt>7. UE&rsquo;s UObject <code>Cast&lt;T></code>
<a class=anchor href=#7-ues-uobject-castt>#</a></h2><h3 class=heading id=7a-the-problem-dynamic_cast-vs-castt>7a. The Problem: <code>dynamic_cast</code> vs <code>Cast&lt;T></code>
<a class=anchor href=#7a-the-problem-dynamic_cast-vs-castt>#</a></h3><p>In standard C++, <code>dynamic_cast</code> relies on RTTI (Run-Time Type Information)</p><ul><li>Pros: Safe. Returns nullptr if the cast fails</li><li>Cons: Slow. It has to traverse the inheritance tree at runtime</li><li>Unreal: Disables RTTI by default for performance. Therefore, <code>dynamic_cast</code> doesn&rsquo;t work on <code>UObjects</code> in the standard way</li></ul><p>Unreal created its own reflection system to handle this</p><h3 class=heading id=7b-how-castt-works-the-two-step-process>7b. How <code>Cast&lt;T></code> Works (The Two-Step Process)
<a class=anchor href=#7b-how-castt-works-the-two-step-process>#</a></h3><p>When you call <code>Cast&lt;AMyActor>(Obj)</code>, Unreal does two checks:</p><p>Step A: The Fast Path (Class Cast Flags)</p><p>For core engine classes (Actor, Pawn, Character, StaticMeshComponent, etc.), Unreal doesn&rsquo;t even look at the inheritance tree. It checks a <strong>Bitmask</strong></p><p>Every class has a <code>ClassCastFlags</code> integer.</p><ul><li><code>CASTCLASS_AActor</code></li><li><code>CASTCLASS_APawn</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Pseudo-code of what happens inside Cast&lt;&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>if</span> (Object<span style=color:#ff79c6>-&gt;</span>GetClass()<span style=color:#ff79c6>-&gt;</span>HasAnyCastFlag(TCastFlags<span style=color:#ff79c6>&lt;</span>TargetType<span style=color:#ff79c6>&gt;::</span>Value)) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>return</span> (TargetType<span style=color:#ff79c6>*</span>)Object;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span></code></pre></div><p>Cost: Bitwise AND, extremely fast</p><p>Step B: The Generic Path (<code>IsA</code> / <code>IsChildOf</code>)</p><p>If you are casting to a custom class (e.g., <code>AMyGameHero</code>) that doesn&rsquo;t have a dedicated engine flag, Unreal calls <code>IsA&lt;T>()</code>, which calls <code>IsChildOf()</code></p><p>This is where the O(1) magic happens</p><h3 class=heading id=7c-performance-difference-in-editor-vs-shipping>7c. Performance difference in Editor vs. Shipping
<a class=anchor href=#7c-performance-difference-in-editor-vs-shipping>#</a></h3><p>The implementation of <code>IsChildOf</code> changes depending on your build configuration</p><p>In Editor Builds (<code>UE_EDITOR = 1</code>)
The engine assumes classes might change at runtime (Hot Reload / Live Coding)</p><ul><li>Algorithm: It walks up the inheritance tree<ul><li>Check this. Is it Target? No</li><li>Check Super. Is it Target? No</li><li>Check Super->Super. Is it Target? Yes</li></ul></li></ul><p>Complexity: O(Depth). The deeper your hierarchy, the slower the cast</p><p>In Shipping/Game Builds (<code>UE_EDITOR = 0</code>)</p><p>The engine knows the class hierarchy is immutable (baked). It generates a <code>StructBaseChainArray</code> for every class</p><p>Concept: Every class holds an array of pointers to all its parents
Algorithm:</p><ul><li>Get the depth of the Target Class (e.g., Depth 3)</li><li>Check if <code>MyClass.StructBaseChainArray[3] == TargetClass</code></li></ul><p>Complexity: O(1). Constant time. It doesn&rsquo;t matter if the inheritance depth is 2 or 50; it is a single array lookup</p><h3 class=heading id=7d-other-cast-types>7d. Other Cast Types
<a class=anchor href=#7d-other-cast-types>#</a></h3><ul><li><p><code>CastChecked&lt;T></code></p><ul><li>Behavior: Casts the object. If it fails, Crashes the game (Asserts)</li><li>Performance: In <strong>Shipping</strong> builds, the check is stripped out. It compiles down to a <code>static_cast</code> (or raw cast), making it effectively free</li><li>Usage: Use this when you are 100% sure of the type (e.g., inside <code>BeginPlay</code> after spawning a specific blueprint) and you <em>want</em> it to crash during development if you are wrong</li></ul></li><li><p><code>ExactCast&lt;T></code></p><ul><li>Behavior: Checks if the object is exactly that class (not a child)</li><li>Logic: <code>Object->GetClass() == T::StaticClass()</code></li><li>Performance: Always O(1)</li></ul></li></ul><p>So, <code>Cast&lt;T></code> is <em>not</em> always expensive. It depends on the build configuration</p><ol><li>Fast Path: If casting to common engine classes like <code>AActor</code>, it uses a <strong>Bitmask</strong> check, which is instant</li><li>Generic Path: For custom classes, in the Editor, it walks the inheritance tree (O(Depth)). However, in Shipping builds, Unreal uses a cached <code>StructBaseChainArray</code> to perform the lookup in O(1) constant time</li></ol><h2 class=heading id=8-modular-architecture>8. Modular Architecture
<a class=anchor href=#8-modular-architecture>#</a></h2><h3 class=heading id=8a-the-concept>8a. The concept
<a class=anchor href=#8a-the-concept>#</a></h3><p>Unreal Engine is a collection of Modules (<code>Core</code>, <code>Engine</code>, <code>AIModule</code>, etc.). Your game should be too</p><p>If you put your Inventory, AI, Combat, and UI all in one module (<code>MyGame</code>):</p><ol><li>Spaghetti Dependencies: The UI accidentally accesses private AI variables</li><li>Compile Time: Changing one line in the Inventory header triggers a recompile of the AI and Combat systems</li><li>No Reuse: You can&rsquo;t easily copy your Inventory system to your next project</li></ol><p>Instead, split features into separate Modules (or Plugins)</p><ul><li><code>MyGame_Core</code>: Interfaces, Types, Math (Depends on nothing)</li><li><code>MyGame_Inventory</code>: Inventory Logic (Depends on Core)</li><li><code>MyGame_Combat</code>: Combat Logic (Depends on Core)</li><li><code>MyGame_Main</code>: The glue (Depends on Inventory & Combat)</li></ul><h3 class=heading id=8b-clean-dependency-rule-via-buildcs>8b. &ldquo;Clean&rdquo; dependency rule via <code>Build.cs</code>
<a class=anchor href=#8b-clean-dependency-rule-via-buildcs>#</a></h3><p>Understand the difference between <strong>Public</strong> and <strong>Private</strong> dependencies in the <code>.Build.cs</code> file. This is how you enforce architecture</p><ul><li>PublicDependencyModuleNames: &ldquo;I expose types from this module in my public headers.&rdquo; (Transitive)</li><li>PrivateDependencyModuleNames: &ldquo;I use this module internally, but no one including me needs to know about it.&rdquo; (Encapsulation)</li></ul><p>Example:
Your <code>Inventory</code> module uses <code>Slate</code> internally to draw debug info.</p><ul><li>Put <code>Slate</code> in <strong>PrivateDependency</strong></li><li>Now, the <code>Combat</code> module (which depends on <code>Inventory</code>) does not automatically link against Slate. This keeps the build lightweight</li></ul><h3 class=heading id=8c-concrete-example-inventory-module>8c. Concrete example, inventory module
<a class=anchor href=#8c-concrete-example-inventory-module>#</a></h3><p>Folder Structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>/</span>Source
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  <span style=color:#ff79c6>/</span>MyGame_Inventory
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>/</span>MyGame_Inventory.Build.cs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#ff79c6>/</span>Public
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>      IInventoryInterface.h  <span style=color:#ff79c6>&lt;--</span> The Contract
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>      InventoryComponent.h   <span style=color:#ff79c6>&lt;--</span> The Public API
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    <span style=color:#ff79c6>/</span>Private
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>      InventoryComponent.cpp <span style=color:#ff79c6>&lt;--</span> The Implementation
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>      InventoryInternalHelpers.h <span style=color:#ff79c6>&lt;--</span> Hidden from the rest of the game
</span></span></code></pre></div><p><strong>The Interface (<code>Public/IInventoryInterface.h</code>)</strong>:</p><p>We use an Interface to decouple systems. The UI module doesn&rsquo;t need to know about the InventoryComponent class, only that something has items</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#pragma once
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;CoreMinimal.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;UObject/Interface.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;IInventoryInterface.generated.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>UINTERFACE(MinimalAPI)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>UInventoryInterface</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> UInterface { GENERATED_BODY() };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MYGAME_INVENTORY_API</span> IInventoryInterface {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#ff79c6>virtual</span> int32 GetItemCount(FName ItemID) <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>bool</span> <span style=color:#50fa7b>AddItem</span>(FName ItemID, int32 Amount) <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>};
</span></span></code></pre></div><p><strong>The Build File (<code>MyGame_Inventory.Build.cs</code>)</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>public</span> <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MyGame_Inventory</span> <span style=color:#ff79c6>:</span> ModuleRules
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#ff79c6>public</span> <span style=color:#50fa7b>MyGame_Inventory</span>(ReadOnlyTargetRules Target) <span style=color:#ff79c6>:</span> base(Target)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        <span style=color:#6272a4>// Expose the Interface to other modules
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>        PublicDependencyModuleNames.AddRange(<span style=color:#ff79c6>new</span> string[] { <span style=color:#f1fa8c>&#34;Core&#34;</span>, <span style=color:#f1fa8c>&#34;CoreUObject&#34;</span>, <span style=color:#f1fa8c>&#34;Engine&#34;</span> });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#6272a4>// Internal logic only
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>        PrivateDependencyModuleNames.AddRange(<span style=color:#ff79c6>new</span> string[] { <span style=color:#f1fa8c>&#34;Slate&#34;</span>, <span style=color:#f1fa8c>&#34;SlateCore&#34;</span> }); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>}
</span></span></code></pre></div><h2 class=heading id=9-automation-testing>9. Automation testing
<a class=anchor href=#9-automation-testing>#</a></h2><h3 class=heading id=9a-unit-testing>9a. Unit testing
<a class=anchor href=#9a-unit-testing>#</a></h3><p>Unreal has a built-in testing framework. You should write <strong>Unit Tests</strong> for pure C++ logic (like math or inventory calculations) that doesn&rsquo;t require spawning an Actor in a world</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// File: Private/Tests/InventoryTests.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Misc/AutomationTest.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;InventoryComponent.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4>// Define the test: &#34;MyGame.Inventory.AddItem&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4>// Flags: EditorContext (Runs in Editor), EngineFilter (Standard test)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>IMPLEMENT_SIMPLE_AUTOMATION_TEST(FInventoryAddItemTest, <span style=color:#f1fa8c>&#34;MyGame.Inventory.AddItem&#34;</span>, EAutomationTestFlags<span style=color:#ff79c6>::</span>EditorContext <span style=color:#ff79c6>|</span> EAutomationTestFlags<span style=color:#ff79c6>::</span>EngineFilter)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#8be9fd>bool</span> FInventoryAddItemTest<span style=color:#ff79c6>::</span>RunTest(<span style=color:#ff79c6>const</span> FString<span style=color:#ff79c6>&amp;</span> Parameters)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// 1. Arrange (Setup)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Since UComponents usually need an Owner, we might test a plain C++ struct helper here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Or create a temporary object if possible.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// For this example, let&#39;s assume we have a helper struct &#39;FInventoryContainer&#39;.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>    FInventoryContainer Container;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#6272a4>// 2. Act (Execute)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>    Container.AddItem(<span style=color:#f1fa8c>&#34;Sword&#34;</span>, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    Container.AddItem(<span style=color:#f1fa8c>&#34;Sword&#34;</span>, <span style=color:#bd93f9>2</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// 3. Assert (Verify)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// TestEqual prints a nice error message if they don&#39;t match.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>    TestEqual(TEXT(<span style=color:#f1fa8c>&#34;Sword count should be 3&#34;</span>), Container.GetCount(<span style=color:#f1fa8c>&#34;Sword&#34;</span>), <span style=color:#bd93f9>3</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#6272a4>// TestTrue checks boolean
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>    TestTrue(TEXT(<span style=color:#f1fa8c>&#34;Container should not be empty&#34;</span>), Container.HasItems());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>}
</span></span></code></pre></div><h3 class=heading id=9b-functional-testing-integration-test>9b. Functional Testing (Integration Test)
<a class=anchor href=#9b-functional-testing-integration-test>#</a></h3><p>Unit tests are great, but in Unreal, you often need to test things that require the World, Physics, or Spawning. This is a <strong>Functional Test</strong></p><p>We use <code>AFunctionalTest</code>, an actual Actor you place in a special Test Level</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// File: Private/Tests/Functional/InventoryFunctionalTest.h
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;FunctionalTest.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;InventoryComponent.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;InventoryFunctionalTest.generated.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AInventoryFunctionalTest</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> AFunctionalTest
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    AInventoryFunctionalTest()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// Set a time limit for the test
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        TimeLimit <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5.0f</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>StartTest</span>() <span style=color:#ff79c6>override</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        Super<span style=color:#ff79c6>::</span>StartTest();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// 1. Spawn a dummy actor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        AActor<span style=color:#ff79c6>*</span> DummyActor <span style=color:#ff79c6>=</span> GetWorld()<span style=color:#ff79c6>-&gt;</span>SpawnActor<span style=color:#ff79c6>&lt;</span>AActor<span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        <span style=color:#6272a4>// 2. Add our component
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4></span>        UInventoryComponent<span style=color:#ff79c6>*</span> InvComp <span style=color:#ff79c6>=</span> NewObject<span style=color:#ff79c6>&lt;</span>UInventoryComponent<span style=color:#ff79c6>&gt;</span>(DummyActor);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        InvComp<span style=color:#ff79c6>-&gt;</span>RegisterComponent();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        <span style=color:#6272a4>// 3. Perform Action
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>        InvComp<span style=color:#ff79c6>-&gt;</span>AddItem(<span style=color:#f1fa8c>&#34;Gold&#34;</span>, <span style=color:#bd93f9>100</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        <span style=color:#6272a4>// 4. Verify
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (InvComp<span style=color:#ff79c6>-&gt;</span>GetItemCount(<span style=color:#f1fa8c>&#34;Gold&#34;</span>) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>100</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>            FinishTest(EFunctionalTestResult<span style=color:#ff79c6>::</span>Succeeded, TEXT(<span style=color:#f1fa8c>&#34;Gold added successfully&#34;</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        <span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>            FinishTest(EFunctionalTestResult<span style=color:#ff79c6>::</span>Failed, TEXT(<span style=color:#f1fa8c>&#34;Gold count mismatch&#34;</span>));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>        <span style=color:#6272a4>// Cleanup
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#6272a4></span>        DummyActor<span style=color:#ff79c6>-&gt;</span>Destroy();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>};
</span></span></code></pre></div><p>How to run:</p><ul><li>Create a Level named <code>L_Test_Inventory</code></li><li>Drag <code>AInventoryFunctionalTest</code> into the level</li><li>Open Session Frontend (Window -> Developer Tools -> Session Frontend)</li><li>Go to the Automation tab</li><li>Check your test and hit Start Tests</li></ul><h3 class=heading id=9c-running-test-headlessly-cicd-friendly>9c. Running test headlessly (CI/CD-friendly)
<a class=anchor href=#9c-running-test-headlessly-cicd-friendly>#</a></h3><p>We can run tests without opening the Editor. Typically this is called Headless. This is useful when we already have pipeline in place doing auto-build every commit for example. You&rsquo;d want to have build tested to catch logic / integration errors before ever reaching QAs</p><p>You do not use the standard UnrealEditor.exe (which loads the GUI). You use the Command-line version</p><ul><li>Location: [EnginePath]/Engine/Binaries/Win64/UnrealEditor-Cmd.exe</li><li>It runs significantly faster because it doesn&rsquo;t load the Slate UI, and it can run on servers that don&rsquo;t have a monitor (Headless)</li></ul><p>The template: <code>UnrealEditor-Cmd.exe "C:\Path\To\MyGame.uproject" -ExecCmds="Automation RunTests MyGame.Inventory" -unattended -nopause -testexit="Automation Test Queue Empty" -log -nullrhi</code></p><ul><li><code>-ExecCmds="Automation RunTests [Name]"</code><ul><li>This runs the specific test we wrote in the previous section (<code>MyGame.Inventory</code>)</li><li>You can also use <code>Automation RunAll</code> to run every test in the project</li><li>Note: <code>RunTests</code> performs a substring match. <code>RunTests MyGame</code> runs all tests starting with &ldquo;<code>MyGame</code>&rdquo;</li></ul></li><li><code>-unattended</code><ul><li>Crucial for CI. It suppresses message boxes (e.g., &ldquo;Do you want to restore assets?&rdquo;). If a message box pops up on a CI server, the build hangs forever</li></ul></li><li><code>-nullrhi</code><ul><li>Null Render Hardware Interface</li><li>This tells the engine: &ldquo;Do not try to create a Window or initialize the GPU&rdquo;</li><li>Essential for cloud servers (AWS/Azure) that might not have a GPU attached</li></ul></li><li><code>-testexit="Automation Test Queue Empty"</code><ul><li>Tells the engine to shut down automatically once the tests are finished. Without this, the process stays open, and your CI job never completes</li></ul></li><li><code>-log</code><ul><li>Ensures the output is written to the console (stdout) so your CI tool (Jenkins/TeamCity) can capture the text to check for &ldquo;Success&rdquo; or &ldquo;Fail&rdquo;</li></ul></li></ul><p><strong>Parsing the result</strong>
The engine will output a lot of text. To determine if the build passed or failed in your automation script (Python/Batch), you look for specific strings in the log</p><ul><li>Success: Test Passed: [<code>MyGame.Inventory.AddItem</code>]</li><li>Failure: Test Failed: [<code>MyGame.Inventory.AddItem</code>]</li></ul><h2 class=heading id=10-networking>10. Networking
<a class=anchor href=#10-networking>#</a></h2><p>In Multiplayer games, <strong>Bandwidth is the bottleneck</strong>. You cannot replicate everything every frame</p><h3 class=heading id=10a-quantization>10a. Quantization
<a class=anchor href=#10a-quantization>#</a></h3><p>Never send a full <code>float</code> (4 bytes) if you don&rsquo;t need perfect precision</p><ul><li>A health bar (0-100) doesn&rsquo;t need 32-bit float precision</li><li>A rotation (0-360) doesn&rsquo;t need 32-bit float precision</li></ul><p>In Unreal, we use <code>NetQuantize</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// BAD: Sends 12 bytes (3 x 4 bytes)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>FVector ExactPosition; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>// GOOD: Sends ~6 bytes. Rounds to 2 decimal places.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4>// Sufficient for visual effects or non-gameplay critical items.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>FVector_NetQuantize100 ApproximatePosition; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// BEST: Compressing a float (0.0 to 1.0) into a single Byte (0 to 255)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>// 4x bandwidth savings!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>uint8 ReplicatedAlpha <span style=color:#ff79c6>=</span> (uint8)(MyFloat <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>255.0f</span>);
</span></span></code></pre></div><h3 class=heading id=10b-custom-struct-serialization-netserialize>10b. Custom Struct Serialization (<code>NetSerialize</code>)
<a class=anchor href=#10b-custom-struct-serialization-netserialize>#</a></h3><p>By default, replicating a <code>USTRUCT</code> replicates every property individually, adding metadata overhead for each field</p><p><strong>The Pro-gamer move</strong>:</p><p>Write a custom NetSerialize function to pack data at the bit-level</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FMyGunData</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    int32 Ammo; <span style=color:#6272a4>// 4 bytes normally
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#8be9fd>bool</span> bIsReloading; <span style=color:#6272a4>// 1 byte normally (plus padding)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// Custom Serialization
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>bool</span> <span style=color:#50fa7b>NetSerialize</span>(FArchive<span style=color:#ff79c6>&amp;</span> Ar, <span style=color:#ff79c6>class</span> <span style=color:#50fa7b>UPackageMap</span><span style=color:#ff79c6>*</span> Map, <span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&amp;</span> bOutSuccess) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        <span style=color:#6272a4>// Write/Read Ammo. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Optimization: We know max ammo is 100. We only need 7 bits (up to 127).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// Standard int is 32 bits. We save 25 bits!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>        Ar.SerializeBits(<span style=color:#ff79c6>&amp;</span>Ammo, <span style=color:#bd93f9>7</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        <span style=color:#6272a4>// Write/Read Bool. Takes exactly 1 bit.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>        Ar.SerializeBits(<span style=color:#ff79c6>&amp;</span>bIsReloading, <span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        bOutSuccess <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4>// Result: This struct now takes ~1 byte (8 bits) to send over network.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#6272a4>// Without NetSerialize, it would take ~5-8 bytes.
</span></span></span></code></pre></div><h3 class=heading id=10c-fast-array-serialization-ffastarrayserializer>10c. Fast Array Serialization (<code>FFastArraySerializer</code>)
<a class=anchor href=#10c-fast-array-serialization-ffastarrayserializer>#</a></h3><p>Replicating a standard <code>TArray</code> is expensive. If you change one element, UE might check the whole array or send inefficient updates</p><p>For arrays that change frequently (Inventory, Active Buffs), use <code>FFastArraySerializer</code>. It uses an ID/Dirty-Bit system to only send exactly what changed</p><p><strong>The Setup:</strong></p><ol><li>An Item Struct inheriting <code>FFastArraySerializerItem</code></li><li>An Array Struct inheriting <code>FFastArraySerializer</code></li><li>The <code>NetDeltaSerialize</code> function</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// 1. The Item
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FInventoryItem</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> FFastArraySerializerItem {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    int32 ItemID;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// 2. The Array Manager
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FInventoryArray</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> FFastArraySerializer {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    TArray<span style=color:#ff79c6>&lt;</span>FInventoryItem<span style=color:#ff79c6>&gt;</span> Items;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#6272a4>// Boilerplate to link the array to the serializer
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>bool</span> <span style=color:#50fa7b>NetDeltaSerialize</span>(FNetDeltaSerializeInfo<span style=color:#ff79c6>&amp;</span> DeltaParms) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        <span style=color:#ff79c6>return</span> FFastArraySerializer<span style=color:#ff79c6>::</span>FastArrayDeltaSerialize<span style=color:#ff79c6>&lt;</span>FInventoryItem, FInventoryArray<span style=color:#ff79c6>&gt;</span>(Items, DeltaParms, <span style=color:#ff79c6>*</span><span style=color:#ff79c6>this</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4>// 3. Usage
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> APlayer<span style=color:#ff79c6>::</span>AddItem() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    FInventoryItem<span style=color:#ff79c6>&amp;</span> NewItem <span style=color:#ff79c6>=</span> Inventory.Items.AddDefaulted_GetRef();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    NewItem.ItemID <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>50</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#6272a4>// CRITICAL: You must mark the item or array as dirty!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// This tells the engine &#34;Only replicate this specific index&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>    Inventory.MarkItemDirty(NewItem); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>}
</span></span></code></pre></div><h3 class=heading id=10d-replication-graph>10d. Replication Graph
<a class=anchor href=#10d-replication-graph>#</a></h3><p>The standard Unreal replication system works by iterating over <strong>every replicated actor</strong> for <strong>every connected client</strong></p><ul><li>Complexity: O(N * M) where N = Actors, M = Players</li><li>In a Battle Royale with 100 players and 50,000 loot items, this kills the server CPU</li></ul><p><strong>What is it?</strong>
Replication Graph is a high-level filtering system. It acts as a &ldquo;Broadphase&rdquo; for networking. Instead of checking every actor, it organizes actors into <strong>Nodes</strong> (usually based on location) and only checks actors inside the nodes relevant to the client</p><p><strong>Why use it?</strong>
To scale player counts and actor counts beyond standard limits (e.g., Fortnite, Warzone)</p><ul><li>Spatialization: Divides the map into a Grid. If Player A is in Cell [0,0], they don&rsquo;t need to know about a gun in Cell [10,10]</li><li>Frequency Management: You can tick distant actors less frequently than close actors</li></ul><p><strong>How it works?</strong>
The node system. You create a custom <code>UReplicationGraph</code> class and route actors into specific nodes:</p><ol><li>Grid Node: For spatial actors (Players, Loot, Vehicles). Divides world into cells</li><li>Always Relevant Node: For things everyone must see (GameState, Storm/Zone)</li><li>Dormancy Node: For actors that rarely change</li></ol><p><strong>Code example: Routing Actors</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// MyReplicationGraph.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#8be9fd>void</span> UMyReplicationGraph<span style=color:#ff79c6>::</span>InitGlobalActorClassSettings()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#6272a4>// 1. Create a Grid Node for spatial lookups
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>    GridNode <span style=color:#ff79c6>=</span> CreateNewNode<span style=color:#ff79c6>&lt;</span>UReplicationGraphNode_GridSpatialization2D<span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    GridNode<span style=color:#ff79c6>-&gt;</span>CellSize <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10000.0f</span>; <span style=color:#6272a4>// 100 meters per cell
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    AddGlobalGraphNode(GridNode);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// 2. Create an Always Relevant Node
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    AlwaysRelevantNode <span style=color:#ff79c6>=</span> CreateNewNode<span style=color:#ff79c6>&lt;</span>UReplicationGraphNode_ActorList<span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    AddGlobalGraphNode(AlwaysRelevantNode);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#6272a4>// 3. Define Routing Rules
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// &#34;If it&#39;s a Weapon, put it in the Grid.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>    GlobalActorReplicationInfoMap.SetClassInfo(AWeapon<span style=color:#ff79c6>::</span>StaticClass(), { GridNode });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#6272a4>// &#34;If it&#39;s the GameState, put it in Always Relevant.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4></span>    GlobalActorReplicationInfoMap.SetClassInfo(AGameState<span style=color:#ff79c6>::</span>StaticClass(), { AlwaysRelevantNode });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#8be9fd>void</span> UMyReplicationGraph<span style=color:#ff79c6>::</span>RouteAddNetworkActorToNodes(<span style=color:#ff79c6>const</span> FNewReplicatedActorInfo<span style=color:#ff79c6>&amp;</span> ActorInfo, FGlobalActorReplicationInfo<span style=color:#ff79c6>&amp;</span> GlobalInfo)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#6272a4>// This function runs when an Actor spawns.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We look up where it belongs based on the settings above.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (UReplicationGraphNode<span style=color:#ff79c6>*</span> <span style=color:#8be9fd;font-style:italic>Node</span> : GlobalInfo.Settings.RoutingNodes)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        Node<span style=color:#ff79c6>-&gt;</span>NotifyAddNetworkActor(ActorInfo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>}
</span></span></code></pre></div><p><strong>Issues and Gotchas</strong></p><ul><li>Starvation: If the bandwidth limit is hit, RepGraph has to decide what not to send. Sometimes it prioritizes incorrectly, causing nearby enemies to &ldquo;teleport&rdquo; or not appear because the graph thought a distant explosion was more important</li><li>Edge Case Logic: Fast-moving actors (planes/missiles) crossing grid boundaries can sometimes be lost or stutter if the graph update logic lags behind the physics</li><li>Complexity: You lose the &ldquo;It just works&rdquo; nature of standard replication. If you spawn an actor and it doesn&rsquo;t replicate, it&rsquo;s likely because you forgot to add a Routing Rule for its class, so it sits in &ldquo;Limbo&rdquo; (no node owns it) lmao</li></ul><h3 class=heading id=10e-iris-new-data-oriented-replication-system>10e. Iris, new data-oriented replication system
<a class=anchor href=#10e-iris-new-data-oriented-replication-system>#</a></h3><p>Introduced experimentally in UE 5.1 and production-ready in later versions. Iris is a complete rewrite of the underlying replication architecture</p><p><strong>Why use this?</strong>
Legacy replication is <strong>Object-Oriented</strong> and <strong>Reflection-based</strong></p><p>To replicate a <code>Health</code> float, the engine iterates properties via Reflection (slow), compares current value to shadow state (cache miss heavy), and writes to a bitstream.</p><p>Iris on the other hand, is data-oriented and descriptor-based</p><ul><li>It separates the Networking Data from the Game Actor</li><li>It uses <strong>Quantized State Buffers</strong> internally</li><li>It supports huge concurrency (multithreading) for replication, which the old system struggled with</li></ul><p><strong>Comparison</strong></p><div class=table-outer><table><thead><tr><th style=text-align:left>Feature</th><th style=text-align:left>Legacy Replication</th><th style=text-align:left>Iris Replication</th></tr></thead><tbody><tr><td style=text-align:left><strong>Architecture</strong></td><td style=text-align:left>Actor Channel + Reflection</td><td style=text-align:left>Replication System + Fragments</td></tr><tr><td style=text-align:left><strong>State Tracking</strong></td><td style=text-align:left>Shadow States (Deep Copy of Actor)</td><td style=text-align:left>Dirty Bitmasks & State Buffers</td></tr><tr><td style=text-align:left><strong>Filtering</strong></td><td style=text-align:left><code>IsNetRelevantFor()</code> (Virtual func)</td><td style=text-align:left>Filter Fragments (Data-driven)</td></tr><tr><td style=text-align:left><strong>Scalability</strong></td><td style=text-align:left>Linear degradation</td><td style=text-align:left>Highly parallelizable</td></tr><tr><td style=text-align:left><strong>Bandwidth</strong></td><td style=text-align:left>Good, but relies on manual <code>DOREPLIFETIME</code></td><td style=text-align:left>Automatic delta compression</td></tr></tbody></table></div><p><strong>Comparison in code</strong></p><ol><li>Legacy Replication (The &ldquo;Polling&rdquo; Model)</li></ol><p>In the legacy system, the engine polls your variables. Every tick (defined by NetUpdateFrequency), the engine compares your current variable value against a &ldquo;Shadow Copy&rdquo; it saved last frame to see if it changed</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>// Header (MyLegacyActor.h)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AMyLegacyActor</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> AActor
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// 1. Define variables directly in the class
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#8be9fd>float</span> Health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    int32 Ammo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#6272a4>// 2. Standard boilerplate override
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>GetLifetimeReplicatedProps</span>(TArray<span style=color:#ff79c6>&lt;</span>FLifetimeProperty<span style=color:#ff79c6>&gt;&amp;</span> OutLifetimeProps) <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>override</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4>// Cpp (MyLegacyActor.cpp)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Net/UnrealNetwork.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#8be9fd>void</span> AMyLegacyActor<span style=color:#ff79c6>::</span>GetLifetimeReplicatedProps(TArray<span style=color:#ff79c6>&lt;</span>FLifetimeProperty<span style=color:#ff79c6>&gt;&amp;</span> OutLifetimeProps) <span style=color:#ff79c6>const</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    Super<span style=color:#ff79c6>::</span>GetLifetimeReplicatedProps(OutLifetimeProps);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#6272a4>// 3. MACROS. The engine uses these to build a list of properties to check.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span>    DOREPLIFETIME(AMyLegacyActor, Health);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    DOREPLIFETIME(AMyLegacyActor, Ammo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#8be9fd>void</span> AMyLegacyActor<span style=color:#ff79c6>::</span>TakeDamage(<span style=color:#8be9fd>float</span> Damage)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#6272a4>// 4. Just change the value.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// The Engine will detect this change AUTOMATICALLY during the next NetUpdate tick
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// by comparing (CurrentHealth != ShadowHealth).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4></span>    Health <span style=color:#ff79c6>-=</span> Damage; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>}
</span></span></code></pre></div><p>Performance Cost (Under the hood): Even if Health didn&rsquo;t change, the CPU does this every update:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Pseudo-code of Legacy Engine Loop
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>Property</span> : ReplicatedProps) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#ff79c6>if</span> (CurrentValue <span style=color:#ff79c6>!=</span> ShadowValue) { <span style=color:#6272a4>// &lt;--- Cache miss potential
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>        SendToClient();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        ShadowValue <span style=color:#ff79c6>=</span> CurrentValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>}
</span></span></code></pre></div><ol start=2><li>Iris Replication (The &ldquo;Push&rdquo; Model)
In Iris, we group data into a struct (State). The engine does <strong>not</strong> poll individual variables. It waits for <strong>you</strong> to tell it &ldquo;I modified this chunk of memory&rdquo;</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Header (MyIrisActor.h)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Iris/ReplicationState/ReplicationStateDescriptor.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>// 1. Define the Data Layout (The Fragment)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FPlayerStatsState</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#8be9fd>float</span> Health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>    int32 Ammo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AMyIrisActor</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> AActor
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#6272a4>// 2. The State Container
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    FPlayerStatsState PlayerStats;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#6272a4>// Handle to the registered fragment (for efficiency)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>    UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FReplicationFragmentHandle StatsHandle;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> RegisterReplicationFragments(UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FFragmentRegistrationContext<span style=color:#ff79c6>&amp;</span> Context, UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>EFragmentRegistrationFlags RegistrationFlags) <span style=color:#ff79c6>override</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#6272a4>// Cpp (MyIrisActor.cpp)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Iris/ReplicationSystem/ReplicationSystem.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#8be9fd>void</span> AMyIrisActor<span style=color:#ff79c6>::</span>RegisterReplicationFragments(UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FFragmentRegistrationContext<span style=color:#ff79c6>&amp;</span> Context, UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>EFragmentRegistrationFlags RegistrationFlags)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#6272a4>// 3. Register the Memory Block
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We tell Iris: &#34;Here is a block of memory. Here is the Descriptor (Schema) for it.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>auto</span><span style=color:#ff79c6>*</span> Desc <span style=color:#ff79c6>=</span> UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>TReplicationStateDescriptor<span style=color:#ff79c6>&lt;</span>FPlayerStatsState<span style=color:#ff79c6>&gt;::</span>GetDescriptor();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    <span style=color:#6272a4>// We store the handle so we can mark it dirty later
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#6272a4></span>    StatsHandle <span style=color:#ff79c6>=</span> Context.RegisterReplicationFragment(<span style=color:#ff79c6>this</span>, Desc, <span style=color:#ff79c6>&amp;</span>PlayerStats);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#8be9fd>void</span> AMyIrisActor<span style=color:#ff79c6>::</span>TakeDamage(<span style=color:#8be9fd>float</span> Damage)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>    <span style=color:#6272a4>// 4. Modify the data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#6272a4></span>    PlayerStats.Health <span style=color:#ff79c6>-=</span> Damage;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    <span style=color:#6272a4>// 5. EXPLICIT DIRTYING (The &#34;Push&#34;)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We must tell Iris that this specific fragment changed.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// If we forget this, the client never sees the change.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>auto</span><span style=color:#ff79c6>*</span> RepSys <span style=color:#ff79c6>=</span> GetReplicationSystem())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>        RepSys<span style=color:#ff79c6>-&gt;</span>MarkDirty(StatsHandle);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>}
</span></span></code></pre></div><p>Performance Cost (Under the hood):</p><ul><li>If Health didn&rsquo;t change, the CPU does&mldr; nothing</li><li>If Health changed, the CPU sees the Dirty Bit is set and copies the memory immediately</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Pseudo-code of Iris Engine Loop
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>if</span> (FragmentHandle.IsDirty()) { <span style=color:#6272a4>// &lt;--- Bitwise check (Fast)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We know exactly which memory block to send.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// No property iteration. No shadow state comparison.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>    SerializeFragment(FragmentPtr); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}
</span></span></code></pre></div><p><strong>How to use it (Native / &ldquo;Pure&rdquo; Iris)</strong>
You can use Iris in &ldquo;Compatibility Mode&rdquo; (where it still reads GetLifetimeReplicatedProps), but to get the performance benefits and remove &ldquo;baggage,&rdquo; you should use Replication Fragments</p><ol><li>Setup (<code>DefaultEngine.ini</code>)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#ff79c6>[SystemSettings]</span>
</span></span><span style=display:flex><span><span style=color:#50fa7b>net.Iris.Enable</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>1</span>
</span></span></code></pre></div><ol start=2><li>The Code (Registering Fragments)
Instead of defining <code>DOREPLIFETIME</code> macros, we register data chunks</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// The header
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Iris/ReplicationState/ReplicationStateDescriptor.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>struct</span> <span style=color:#50fa7b>FMyReplicationState</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// We define the data layout here. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Iris will manage this memory block efficiently.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#8be9fd>float</span> Health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    int32 Ammo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>AMyIrisActor</span> <span style=color:#ff79c6>:</span> <span style=color:#ff79c6>public</span> AActor
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#6272a4>// The struct holding our data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4></span>    UPROPERTY(Replicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    FMyReplicationState NetState;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    <span style=color:#6272a4>// Override this to hook into Iris
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> RegisterReplicationFragments(UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FFragmentRegistrationContext<span style=color:#ff79c6>&amp;</span> Context, UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>EFragmentRegistrationFlags RegistrationFlags) <span style=color:#ff79c6>override</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#6272a4>// The cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Iris/ReplicationSystem/ReplicationFragment.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#6272a4>// 1. We don&#39;t use GetLifetimeReplicatedProps anymore!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#8be9fd>void</span> AMyIrisActor<span style=color:#ff79c6>::</span>RegisterReplicationFragments(UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FFragmentRegistrationContext<span style=color:#ff79c6>&amp;</span> Context, UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>EFragmentRegistrationFlags RegistrationFlags)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>    <span style=color:#6272a4>// 2. Create a Fragment
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// A fragment is a &#34;view&#34; into a piece of memory that needs replicating.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We point it to our &#39;NetState&#39; struct.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    <span style=color:#6272a4>// Create the descriptor (describes the layout of the struct)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>const</span> UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>FReplicationStateDescriptor<span style=color:#ff79c6>*</span> Desc <span style=color:#ff79c6>=</span> UE<span style=color:#ff79c6>::</span>Net<span style=color:#ff79c6>::</span>TReplicationStateDescriptor<span style=color:#ff79c6>&lt;</span>FMyReplicationState<span style=color:#ff79c6>&gt;::</span>GetDescriptor();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    <span style=color:#6272a4>// Register the fragment
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// This tells Iris: &#34;Monitor this memory address using this layout descriptor.&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#6272a4></span>    Context.RegisterReplicationFragment(<span style=color:#ff79c6>this</span>, Desc, <span style=color:#ff79c6>&amp;</span>NetState);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#6272a4>// 3. Modifying Data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> AMyIrisActor<span style=color:#ff79c6>::</span>TakeDamage(<span style=color:#8be9fd>float</span> Damage)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>    NetState.Health <span style=color:#ff79c6>-=</span> Damage;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>    <span style=color:#6272a4>// CRITICAL: In pure Iris, we must explicitly mark the state dirty.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// (Legacy system did this by comparing values every frame, which was slow).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Iris assumes nothing changed unless you say so.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#6272a4></span>    Iris<span style=color:#ff79c6>::</span>FReplicationSystem<span style=color:#ff79c6>*</span> RepSys <span style=color:#ff79c6>=</span> GetReplicationSystem();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>    <span style=color:#ff79c6>if</span> (RepSys)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span>        <span style=color:#6272a4>// Mark the &#39;Health&#39; member of the fragment as dirty
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span><span style=color:#6272a4></span>        RepSys<span style=color:#ff79c6>-&gt;</span>MarkDirty(<span style=color:#ff79c6>this</span>); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>}
</span></span></code></pre></div><p>In the Legacy system, the <code>UNetDriver</code> owns the replication logic. It is tightly coupled to <code>AActor</code></p><p>In Iris, the Replication System owns the data</p><ul><li>You can technically replicate things that are <em>not</em> Actors, as long as you register a Fragment</li><li>By using <code>RegisterReplicationFragments</code>, you bypass the expensive <code>PreReplication</code> -> <code>GetLifetimeReplicatedProps</code> -> Compare Properties loop of the legacy system. The engine simply looks at the Dirty Bitmask you set and sends that memory chunk</li></ul><h2 class=heading id=11-ues-multithreading>11. UE&rsquo;s Multithreading
<a class=anchor href=#11-ues-multithreading>#</a></h2><h3 class=heading id=11a-stdmutex--fcriticalsection>11a. <code>std::mutex</code> / <code>FCriticalSection</code>
<a class=anchor href=#11a-stdmutex--fcriticalsection>#</a></h3><p>The brute-force fix. &ldquo;I am using this variable, nobody else touch it&rdquo;</p><ul><li>Pros: Easy to use</li><li>Cons: Slow. If Thread A has the lock, Thread B goes to sleep (Context Switch). Waking up takes thousands of CPU cycles</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// UE4/5 Wrapper for mutex
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span>FCriticalSection MyLock; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>TakeDamage</span>(<span style=color:#8be9fd>int</span> Amount) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#6272a4>// Locks here. If another thread is here, we wait.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span>    FScopeLock Lock(<span style=color:#ff79c6>&amp;</span>MyLock); 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    Health <span style=color:#ff79c6>-=</span> Amount;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>} <span style=color:#6272a4>// Unlocks automatically when &#39;Lock&#39; goes out of scope
</span></span></span></code></pre></div><h3 class=heading id=11b-stdatomic>11b. <code>std::atomic</code>
<a class=anchor href=#11b-stdatomic>#</a></h3><p>The lightweight fix. Hardware-supported operations that cannot be interrupted</p><ul><li>Pros: Extremely fast (no context switching)</li><li>Cons: Only works for simple data (int, bool, pointers). You can&rsquo;t make an <code>atomic&lt;PlayerClass></code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;atomic&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>std<span style=color:#ff79c6>::</span>atomic<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&gt;</span> Health;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>TakeDamage</span>(<span style=color:#8be9fd>int</span> Amount) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    <span style=color:#6272a4>// This is a single CPU instruction. Impossible to interrupt.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// No locks needed.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#6272a4></span>    Health <span style=color:#ff79c6>-=</span> Amount; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h3 class=heading id=11c-job-systems-task-graph>11c. Job Systems (Task Graph)
<a class=anchor href=#11c-job-systems-task-graph>#</a></h3><p>Creating threads (<code>std::thread</code> or <code>FRunnable</code>) is expensive</p><ul><li>Each thread takes ~1MB stack memory</li><li>OS scheduling overhead</li></ul><p><strong>Ideal Approach</strong>: Create a pool of worker threads (one per CPU core) at startup. Break your work into tiny &ldquo;Tasks&rdquo; or &ldquo;Jobs&rdquo; and feed them to the pool</p><p>Unreal Example (<code>ParallelFor</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Don&#39;t spawn a thread to process 10,000 items. Use the Task Graph
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>UpdateParticles</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    int32 NumParticles <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10000</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// Splits the loop into chunks and distributes them to available Worker Threads.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Blocks the main thread until all chunks are done.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>    ParallelFor(NumParticles, [<span style=color:#ff79c6>&amp;</span>](int32 Index) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        <span style=color:#6272a4>// This code runs on multiple threads at once!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>        Particles[Index].Update();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    }); <span style=color:#6272a4>// &lt;--- Implicit synchronization barrier here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>Unreal Example (<code>Async</code> / TaskGraph):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Run on a background thread (Any available worker)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>AsyncTask(ENamedThreads<span style=color:#ff79c6>::</span>AnyBackgroundThreadNormalTask, [<span style=color:#ff79c6>this</span>]() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    HeavyCalculation();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// Return to Game Thread to update UI (UI is NOT thread-safe!)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    AsyncTask(ENamedThreads<span style=color:#ff79c6>::</span>GameThread, [<span style=color:#ff79c6>this</span>]() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        UpdateUI();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>});
</span></span></code></pre></div><h1 class=heading id=finding-and-fixing-framerate-hitches>Finding and Fixing Framerate Hitches
<a class=anchor href=#finding-and-fixing-framerate-hitches>#</a></h1><h2 class=heading id=1-the-tools-of-the-trade>1. The Tools of the Trade
<a class=anchor href=#1-the-tools-of-the-trade>#</a></h2><p>Before you fix it, you must see it. Never guess</p><ul><li>Unreal Engine: Unreal Insights (The gold standard) or the in-game command <code>stat unit</code> / <code>stat game</code></li><li>Unity: Unity Profiler and Frame Debugger</li><li>Graphics: RenderDoc (for inspecting exactly what the GPU drew in a specific frame)</li></ul><h2 class=heading id=2-what-to-see-and-search>2. What to see and search
<a class=anchor href=#2-what-to-see-and-search>#</a></h2><p>When you open a Profiler, you will see a timeline graph. You are looking for <strong>Spikes</strong> (tall bars). Here is exactly what to search for in the call stack when you click on a spike</p><h3 class=heading id=2a-the-game-logic-spike-cpu-bound>2a. The &ldquo;Game Logic&rdquo; Spike (CPU Bound)
<a class=anchor href=#2a-the-game-logic-spike-cpu-bound>#</a></h3><p>Symptoms: The &ldquo;Game Thread&rdquo; bar is huge. The GPU bar is waiting
Search Keywords:</p><ul><li><code>Tick</code></li><li><code>Blueprint</code></li><li><code>Physics</code></li><li><code>LineTrace</code></li></ul><p>What to look for (typically, not always):</p><ul><li>World Tick Time: If this is high, you have too many actors ticking</li><li>Blueprint Time: If you see a specific Blueprint function taking 5ms, you found the culprit. Itâs likely a heavy loop in a Blueprint</li><li>PhysX / Chaos: Too many colliding objects. Look for &ldquo;Complex Collision&rdquo; being used on moving objects</li><li>SpawnActor / DestroyActor: Spawning is expensive. If you see this inside a loop, you are killing the CPU</li></ul><h3 class=heading id=2b-the-garbage-collection-spike-memory-bound>2b. The &ldquo;Garbage Collection&rdquo; Spike (Memory Bound)
<a class=anchor href=#2b-the-garbage-collection-spike-memory-bound>#</a></h3><p>Symptoms: The game runs smooth, then freezes for 100ms every 10-20 seconds
Search Keywords:</p><ul><li><code>GC</code></li><li><code>CollectGarbage</code></li><li><code>MarkAndSweep</code></li><li><code>ReachabilityAnalysis</code></li></ul><p>What to look for:</p><ul><li>The &ldquo;Sawtooth&rdquo; Graph: If you graph memory usage, it goes up, up, up, then drops instantly (the spike)</li><li>Cause: You are creating temporary objects (e.g., <code>NewObject&lt;Bullet>()</code>) every frame. The GC has to pause the game to clean them up</li></ul><h3 class=heading id=2c-the-render-spike-gpudraw-call-bound>2c. The &ldquo;Render&rdquo; Spike (GPU/Draw Call Bound)
<a class=anchor href=#2c-the-render-spike-gpudraw-call-bound>#</a></h3><p>Symptoms: The &ldquo;Render Thread&rdquo; or &ldquo;GPU&rdquo; bar is high
Search Keywords:</p><ul><li><code>BasePass</code></li><li><code>ShadowDepths</code></li><li><code>Translucency</code></li><li><code>DrawCall</code></li></ul><p>What to look for:</p><ul><li>Draw Calls (Count): If this is > 2000-3000 (for mobile/mid-range), the CPU is struggling to tell the GPU what to draw</li><li>ShadowDepths: Dynamic shadows are expensive. If this is high, you have too many dynamic lights casting shadows</li><li>Translucency: Smoke, glass, water. If you have lots of overlapping transparent particles (Overdraw), this spikes</li></ul><h3 class=heading id=2d-the-loading-spike-io-bound>2d. The &ldquo;Loading&rdquo; Spike (I/O Bound)
<a class=anchor href=#2d-the-loading-spike-io-bound>#</a></h3><p>Symptoms: A spike happens exactly when you open a menu or walk into a new room
Search Keywords:</p><ul><li><code>LoadObject</code></li><li><code>Serialize</code></li><li><code>FAsyncLoading</code></li></ul><p>Typical cause: Synchronous Loading. The game paused execution to read a file from the hard drive because you referenced an asset that wasn&rsquo;t in memory yet (The &ldquo;Hard Reference&rdquo; problem we discussed earlier)</p><h3 class=heading id=3-how-to-fix>3. How to fix
<a class=anchor href=#3-how-to-fix>#</a></h3><h4 class=heading id=3a-object-pooling-fixes-spawnactor--gc-spikes>3a. Object Pooling (Fixes SpawnActor & GC Spikes)
<a class=anchor href=#3a-object-pooling-fixes-spawnactor--gc-spikes>#</a></h4><p>Instead of Spawn/Destroy every time a gun is fired:</p><ol><li>Create 100 bullets at the start of the level. Hide them</li><li>When firing: Teleport a hidden bullet to the gun, unhide it</li><li>When it hits: Hide it. <strong>Do not destroy it</strong></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Bad
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Fire</span>() { GetWorld()<span style=color:#ff79c6>-&gt;</span>SpawnActor<span style=color:#ff79c6>&lt;</span>ABullet<span style=color:#ff79c6>&gt;</span>(...); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>// Good (Pooling)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Fire</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    ABullet<span style=color:#ff79c6>*</span> b <span style=color:#ff79c6>=</span> BulletPool.GetNextAvailable();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    b<span style=color:#ff79c6>-&gt;</span>SetActorLocation(MuzzleLoc);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    b<span style=color:#ff79c6>-&gt;</span>SetHidden(<span style=color:#8be9fd;font-style:italic>false</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    b<span style=color:#ff79c6>-&gt;</span>Activate();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><h4 class=heading id=3b-amortization-fixes-tick-spikes>3b. Amortization (Fixes <code>Tick</code> Spikes)
<a class=anchor href=#3b-amortization-fixes-tick-spikes>#</a></h4><p>&ldquo;Amortization&rdquo; means spreading the cost over time. If you need to spawn 100 enemies, don&rsquo;t do it in one frame. Spawn 5 enemies per frame for 20 frames</p><p>If I see a spike due to a heavy calculation (like pathfinding for a squad), I would time-slice it. Calculate the path for Unit 1 on Frame A, Unit 2 on Frame B, etc.</p><p>Here&rsquo;s a simple amortization (splatting) system and the usage that I have made:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Header File (AmortizationSubsystem.h)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>#pragma once
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;CoreMinimal.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Subsystems/WorldSubsystem.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;AmortizationSubsystem.generated.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4>// Define a generic &#34;Job&#34; as a function that takes no args and returns void.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// We use TFunction so we can pass Lambdas with captured variables.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>using</span> FAmortizedJob <span style=color:#ff79c6>=</span> TFunction<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>void</span>()<span style=color:#ff79c6>&gt;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>MYGAME_API</span> <span style=color:#8be9fd;font-style:italic>UAmortizationSubsystem</span> : <span style=color:#ff79c6>public</span> UWorldSubsystem
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#6272a4>// 1. The Public API: &#34;Queue this work for later&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>void</span> QueueJob(FAmortizedJob Job);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#6272a4>// 2. Configuration: How much time per frame can we spend?
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Default: 2 milliseconds (leaving 14ms for the rest of the game at 60fps)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> MaxTimePerFrameMS <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2.0f</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#ff79c6>protected</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#6272a4>// 3. Tick: Process the queue
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>void</span> OnWorldBeginPlay(UWorld<span style=color:#ff79c6>&amp;</span> InWorld) <span style=color:#ff79c6>override</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>    <span style=color:#ff79c6>virtual</span> <span style=color:#8be9fd>bool</span> <span style=color:#50fa7b>DoesSupportWorldType</span>(<span style=color:#ff79c6>const</span> EWorldType<span style=color:#ff79c6>::</span>Type WorldType) <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>override</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    <span style=color:#6272a4>// We need to hook into the engine&#39;s Tick
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4></span>    FDelegateHandle TickDelegateHandle;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Tick</span>(UWorld<span style=color:#ff79c6>*</span> World, ELevelTick TickType, <span style=color:#8be9fd>float</span> DeltaSeconds);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#ff79c6>private</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>    <span style=color:#6272a4>// A simple Queue (FIFO - First In, First Out)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4></span>    TQueue<span style=color:#ff79c6>&lt;</span>FAmortizedJob<span style=color:#ff79c6>&gt;</span> JobQueue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#6272a4>// Cpp File (AmortizationSubsystem.cpp)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;AmortizationSubsystem.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&#34;Misc/ScopeLock.h&#34;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#8be9fd>void</span> UAmortizationSubsystem<span style=color:#ff79c6>::</span>OnWorldBeginPlay(UWorld<span style=color:#ff79c6>&amp;</span> InWorld)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    Super<span style=color:#ff79c6>::</span>OnWorldBeginPlay(InWorld);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>    <span style=color:#6272a4>// Register a Tick function for this subsystem
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#6272a4></span>    TickDelegateHandle <span style=color:#ff79c6>=</span> FWorldDelegates<span style=color:#ff79c6>::</span>OnWorldTickStart.AddUObject(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>UAmortizationSubsystem<span style=color:#ff79c6>::</span>Tick);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span><span style=color:#8be9fd>bool</span> UAmortizationSubsystem<span style=color:#ff79c6>::</span>DoesSupportWorldType(<span style=color:#ff79c6>const</span> EWorldType<span style=color:#ff79c6>::</span>Type WorldType) <span style=color:#ff79c6>const</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>    <span style=color:#6272a4>// Only run in Game or PIE (Play In Editor), not in asset previews
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span> WorldType <span style=color:#ff79c6>==</span> EWorldType<span style=color:#ff79c6>::</span>Game <span style=color:#ff79c6>||</span> WorldType <span style=color:#ff79c6>==</span> EWorldType<span style=color:#ff79c6>::</span>PIE;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span><span style=color:#8be9fd>void</span> UAmortizationSubsystem<span style=color:#ff79c6>::</span>QueueJob(FAmortizedJob Job)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>    JobQueue.Enqueue(MoveTemp(Job));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#8be9fd>void</span> UAmortizationSubsystem<span style=color:#ff79c6>::</span>Tick(UWorld<span style=color:#ff79c6>*</span> World, ELevelTick TickType, <span style=color:#8be9fd>float</span> DeltaSeconds)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span>    <span style=color:#ff79c6>if</span> (JobQueue.IsEmpty())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span>        <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71</span><span>    <span style=color:#6272a4>// 1. Start the stopwatch
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>double</span> StartTime <span style=color:#ff79c6>=</span> FPlatformTime<span style=color:#ff79c6>::</span>Seconds();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73</span><span>    <span style=color:#8be9fd>double</span> MaxTimeSeconds <span style=color:#ff79c6>=</span> MaxTimePerFrameMS <span style=color:#ff79c6>/</span> <span style=color:#bd93f9>1000.0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">74</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">75</span><span>    <span style=color:#6272a4>// 2. Process jobs until we run out of time
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">76</span><span><span style=color:#6272a4></span>    FAmortizedJob Job;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">77</span><span>    <span style=color:#ff79c6>while</span> (<span style=color:#ff79c6>!</span>JobQueue.IsEmpty())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">78</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">79</span><span>        <span style=color:#6272a4>// Check time budget
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">80</span><span><span style=color:#6272a4></span>        <span style=color:#8be9fd>double</span> CurrentTime <span style=color:#ff79c6>=</span> FPlatformTime<span style=color:#ff79c6>::</span>Seconds();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">81</span><span>        <span style=color:#ff79c6>if</span> ((CurrentTime <span style=color:#ff79c6>-</span> StartTime) <span style=color:#ff79c6>&gt;</span> MaxTimeSeconds)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">82</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">83</span><span>            <span style=color:#6272a4>// We ran out of budget! Stop here and resume next frame.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">84</span><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>break</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">85</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">86</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">87</span><span>        <span style=color:#6272a4>// Dequeue and Execute
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88</span><span><span style=color:#6272a4></span>        <span style=color:#ff79c6>if</span> (JobQueue.Dequeue(Job))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90</span><span>            Job();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93</span><span>}
</span></span></code></pre></div><p>Usage example, spawning high amount of actors</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Naive way
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#8be9fd>void</span> AZombieSpawner<span style=color:#ff79c6>::</span>SpawnArmy()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>500</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>        GetWorld()<span style=color:#ff79c6>-&gt;</span>SpawnActor<span style=color:#ff79c6>&lt;</span>AZombie<span style=color:#ff79c6>&gt;</span>(...); <span style=color:#6272a4>// LAG SPIKE!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>// &#34;Ammortized way&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#8be9fd>void</span> AZombieSpawner<span style=color:#ff79c6>::</span>SpawnArmy()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#6272a4>// Get the Subsystem
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    UAmortizationSubsystem<span style=color:#ff79c6>*</span> Amortizer <span style=color:#ff79c6>=</span> GetWorld()<span style=color:#ff79c6>-&gt;</span>GetSubsystem<span style=color:#ff79c6>&lt;</span>UAmortizationSubsystem<span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>Amortizer) <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>500</span>; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>        <span style=color:#6272a4>// Calculate spawn location here (or capture &#39;i&#39; to calculate inside)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>        FVector SpawnLoc <span style=color:#ff79c6>=</span> GetActorLocation() <span style=color:#ff79c6>+</span> FVector(i <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>        <span style=color:#6272a4>// Queue the job using a Lambda
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// [=] captures variables by value (safest for simple types)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4></span>        Amortizer<span style=color:#ff79c6>-&gt;</span>QueueJob([<span style=color:#ff79c6>this</span>, SpawnLoc]() 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>            <span style=color:#6272a4>// This code runs in the future, spread across multiple frames.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4></span>            <span style=color:#6272a4>// Check if &#39;this&#39; (Spawner) is still valid before spawning!
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>if</span> (IsValid(<span style=color:#ff79c6>this</span>)) 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>            {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>                GetWorld()<span style=color:#ff79c6>-&gt;</span>SpawnActor<span style=color:#ff79c6>&lt;</span>AZombie<span style=color:#ff79c6>&gt;</span>(ZombieClass, SpawnLoc, FRotator<span style=color:#ff79c6>::</span>ZeroRotator);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>            }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        });
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>}
</span></span></code></pre></div><h4 class=heading id=3c-lods--culling-fixes-render-spikes>3c. LODs & Culling (Fixes <code>Render</code> Spikes)
<a class=anchor href=#3c-lods--culling-fixes-render-spikes>#</a></h4><ul><li>LOD (Level of Detail): If an object is far away, switch to a low-poly version</li><li>Culling: If an object is behind a wall, don&rsquo;t draw it</li><li>Merge Meshes: If you have a fence made of 50 individual planks, merge them into 1 mesh. This reduces 50 Draw Calls to 1 Draw Call</li></ul><p><strong>Bottom line</strong>: Never guess. Always profile.
I would reproduce the hitch using a Profiler like Unreal Insights to isolate the bottleneck</p><ol><li>If it&rsquo;s on the <strong>Game Thread</strong>, I&rsquo;d look for expensive <code>Tick</code> logic or heavy Blueprint loops. I might move that logic to C++, use a Timer, or implement Object Pooling if it&rsquo;s related to spawning</li><li>If it&rsquo;s a <strong>GC Spike</strong>, I&rsquo;d check if we are allocating too many temporary objects and refactor to reuse memory</li><li>If it&rsquo;s on the <strong>Render Thread</strong>, I&rsquo;d check <strong>Draw Calls</strong> and dynamic shadows. I might suggest merging meshes or baking lighting</li></ol><h1 class=heading id=debugging-and-crash-analysis>Debugging and Crash Analysis
<a class=anchor href=#debugging-and-crash-analysis>#</a></h1><p>Writing code is half the job. Fixing it when it explodes is the other half</p><h2 class=heading id=1-unreal-asserts-check-ensure-verify>1. Unreal Asserts: <code>check</code>, <code>ensure</code>, <code>verify</code>
<a class=anchor href=#1-unreal-asserts-check-ensure-verify>#</a></h2><p>Unreal provides 3 main ways to scream when something goes wrong. Knowing the difference saves you from crashing the Production build</p><h3 class=heading id=1a-checkcondition>1a. <code>check(Condition)</code>
<a class=anchor href=#1a-checkcondition>#</a></h3><ul><li><strong>Behavior:</strong> If Condition is false, <strong>Crash immediately</strong></li><li><strong>Builds:</strong> Active in Editor and Development. <strong>Stripped (Removed)</strong> in Shipping</li><li><strong>Use case:</strong> &ldquo;Logic impossibility.&rdquo; If this happens, the game state is corrupted and we must stop immediately to preserve the callstack<ul><li><code>check(PlayerState != nullptr);</code></li></ul></li></ul><h3 class=heading id=1b-ensurecondition>1b. <code>ensure(Condition)</code>
<a class=anchor href=#1b-ensurecondition>#</a></h3><ul><li><strong>Behavior:</strong> If Condition is false, <strong>Log a Callstack</strong> to the console, but <strong>Do NOT Crash</strong>.</li><li><strong>Builds:</strong> Active in all builds</li><li><strong>Performance:</strong> The first time it fails, it pauses slightly to dump the stack. Subsequent failures are usually silenced</li><li><strong>Use case:</strong> &ldquo;Unexpected but recoverable.&rdquo; Something is wrong, but we can limp along.<ul><li><code>if (ensure(Texture != nullptr)) { Render(Texture); }</code></li></ul></li></ul><h3 class=heading id=1c-verifycondition>1c. <code>verify(Condition)</code>
<a class=anchor href=#1c-verifycondition>#</a></h3><ul><li><strong>Behavior:</strong> Same as <code>check</code> (Crashes on fail).</li><li><strong>Builds:</strong> The check remains in <strong>Shipping</strong>, but the crash behavior might vary. Crucially, the <em>expression inside</em> is always executed</li><li><strong>Use case:</strong> When the check itself performs a necessary action.<ul><li><code>verify(Component->RegisterComponent());</code> // We need RegisterComponent to run even in Shipping!</li></ul></li></ul><h2 class=heading id=2-data-breakpoints-the-god-tier-tool>2. Data Breakpoints (The &ldquo;God Tier&rdquo; Tool)
<a class=anchor href=#2-data-breakpoints-the-god-tier-tool>#</a></h2><p><strong>The Scenario:</strong> You have a variable <code>PlayerHealth</code>. Sometime during the frame, it changes from <code>100</code> to <code>-23421</code>. You have no idea which function touched it</p><p><strong>The Fix:</strong></p><ol><li>Run the game in Rider / Visual Studio</li><li>Hit a breakpoint <em>before</em> the bug happens</li><li>Go to the <strong>Watch</strong> window</li><li>Right-click the variable address -> <strong>&ldquo;Break when value changes&rdquo;</strong></li><li>Hit Continue</li></ol><p>Your IDE will pause execution the <strong>exact nanosecond</strong> that memory address is written to. You will land directly on the line of code causing the bug</p><h2 class=heading id=3-memory-stomps>3. Memory Stomps
<a class=anchor href=#3-memory-stomps>#</a></h2><p><strong>The Symptom:</strong> You have a class <code>Player</code>. The <code>Health</code> variable is fine, but the <code>Ammo</code> variable next to it contains garbage numbers like <code>3452816845</code></p><p><strong>The Cause:</strong> You likely wrote out of bounds on an array <em>before</em> this variable</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8be9fd>int</span> MyArray[<span style=color:#bd93f9>5</span>];
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> Ammo <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// Writing to index 5 (which is the 6th slot) overwrites the NEXT variable in memory.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>MyArray[<span style=color:#bd93f9>5</span>] <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>9999</span>; 
</span></span><span style=display:flex><span><span style=color:#6272a4>// Now &#39;Ammo&#39; is 9999.
</span></span></span></code></pre></div><p><strong>The Fix:</strong></p><ul><li>Use <code>std::vector</code> or <code>TArray</code> with bounds checking (<code>.at()</code> or <code>[]</code> in debug)</li><li>Enable <strong>PageHeap</strong> (gflags) on Windows to force a crash immediately when writing out of bounds</li></ul><h2 class=heading id=4-reading-a-call-stack>4. Reading a Call Stack
<a class=anchor href=#4-reading-a-call-stack>#</a></h2><p>When the game crashes, look at the Call Stack.</p><ol><li><strong>Ignore the top:</strong> Usually system DLLs (<code>ntdll.dll</code>, <code>kernel32.dll</code>)</li><li><strong>Find the first &ldquo;MyGame&rdquo; line:</strong> This is where your code crashed</li><li><strong>Check for &ldquo;Inline&rdquo;:</strong> In Release/Shipping, functions are inlined. The call stack might say you are in <code>Update()</code>, but the crash actually happened inside a small helper function called by <code>Update()</code> that the compiler merged</li><li><strong>Optimized Out:</strong> If the debugger says a variable is &ldquo;Optimized out,&rdquo; look at the <strong>Registers</strong> or assembly, or add a temporary <code>UE_LOG</code> to print the value before the crash</li></ol><h1 class=heading id=game-math>Game Math
<a class=anchor href=#game-math>#</a></h1><h2 class=heading id=1-vectors-the-basics>1. Vectors: The Basics
<a class=anchor href=#1-vectors-the-basics>#</a></h2><p>A Vector represents a <strong>Direction</strong> and a <strong>Magnitude</strong> (Length)</p><ul><li>Point: A specific location in space (e.g., (<code>10, 50, 0</code>))</li><li>Vector: The displacement between two points</li></ul><h2 class=heading id=1a-lookat-formula>1a. LookAt formula
<a class=anchor href=#1a-lookat-formula>#</a></h2><p>To get a vector pointing from <strong>A (You)</strong> to <strong>B (Enemy)</strong>:</p><p>$$Vector = Destination - Origin$$
$$Vector = EnemyPos - PlayerPos$$</p><h2 class=heading id=1b-normalization>1b. Normalization
<a class=anchor href=#1b-normalization>#</a></h2><p>Often, you only care about the <em>direction</em>, not the distance</p><ul><li>Normalize: Keeps the direction but sets the length to 1.</li><li>Usage: Movement. If you don&rsquo;t normalize, a player moving diagonally (1, 1) moves faster (length ââ 1.41) than a player moving forward (1, 0)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>FVector MoveDirection <span style=color:#ff79c6>=</span> TargetLocation <span style=color:#ff79c6>-</span> MyLocation;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>MoveDirection.Normalize(); <span style=color:#6272a4>// Now length is 1.0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4>// Move at speed 500
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>Velocity <span style=color:#ff79c6>=</span> MoveDirection <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>500.0f</span>;
</span></span></code></pre></div><h2 class=heading id=2-the-dot-product>2. The Dot Product
<a class=anchor href=#2-the-dot-product>#</a></h2><p>Used often to detect &ldquo;facing&rdquo;</p><p><strong>The Formula:</strong> $A \cdot B = |A| |B| \cos(\theta)$</p><p>If vectors A and B are <strong>Normalized</strong> (length 1), the result is simply the <strong>Cosine of the angle</strong> between them</p><p><strong>The Cheat Sheet (Result Range: -1 to 1):</strong></p><ul><li><strong>1.0:</strong> Vectors point in the <strong>exact same</strong> direction</li><li><strong>0.0:</strong> Vectors are <strong>Perpendicular</strong> (90 degrees)</li><li><strong>-1.0:</strong> Vectors point in <strong>opposite</strong> directions</li></ul><p>How do you detect if an enemy is in front of or behind the player?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// 1. Get the vector from Player to Enemy
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>FVector ToEnemy <span style=color:#ff79c6>=</span> EnemyLoc <span style=color:#ff79c6>-</span> PlayerLoc;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>ToEnemy.Normalize();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>// 2. Get Player&#39;s Forward Vector (Normalized by default)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>FVector PlayerForward <span style=color:#ff79c6>=</span> GetActorForwardVector();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4>// 3. Dot Product
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> DotResult <span style=color:#ff79c6>=</span> FVector<span style=color:#ff79c6>::</span>DotProduct(PlayerForward, ToEnemy);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>if</span> (DotResult <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0.0f</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// Enemy is In Front (roughly)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#ff79c6>if</span> (DotResult <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0.9f</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        <span style=color:#6272a4>// Enemy is directly in front (within narrow cone)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>} 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#6272a4>// Enemy is Behind
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=3-the-cross-product>3. The Cross Product
<a class=anchor href=#3-the-cross-product>#</a></h2><p>Used often to find &ldquo;axis&rdquo;</p><p>The concept: Takes two vectors and returns a <strong>third vector</strong> that is <strong>perpendicular</strong> (90 degrees) to both</p><p><strong>Usage:</strong>:</p><ol><li><strong>Finding &ldquo;Right&rdquo;:</strong> If you have <code>Forward</code> and <code>Up</code>, Cross Product gives you <code>Right</code></li><li><strong>Surface Normals:</strong> If you have a triangle (3 points), you can calculate the edges, Cross Product them, and get the direction the face is pointing (Lighting/Physics)</li><li><strong>Turret Rotation:</strong> To decide if a tank turret should turn Left or Right to face a target</li></ol><p>Say we&rsquo;d like to have a Tank Turret turning</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>FVector Forward <span style=color:#ff79c6>=</span> Turret<span style=color:#ff79c6>-&gt;</span>GetForwardVector();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>FVector ToTarget <span style=color:#ff79c6>=</span> (TargetLoc <span style=color:#ff79c6>-</span> TurretLoc).GetSafeNormal();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>// Cross Product returns a Vector (Up or Down relative to the tank)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>FVector Cross <span style=color:#ff79c6>=</span> FVector<span style=color:#ff79c6>::</span>CrossProduct(Forward, ToTarget);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4>// Assuming Z is Up:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>if</span> (Cross.Z <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// Turn Right
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>} <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// Turn Left
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h2 class=heading id=4-interpolation-lerp>4. Interpolation (Lerp)
<a class=anchor href=#4-interpolation-lerp>#</a></h2><p><strong>Linear Interpolation</strong> blends between two values based on an Alpha ($t$) between 0 and 1.</p><p><strong>Formula:</strong> $Result = A + (B - A) * t$</p><p><strong>BE CAREFUL THOUGH, DON&rsquo;T EVER MAKE SOMETHING INTERPOLATED IN A FRAME-DEPENDENT WAY</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// BAD: Framerate Dependent
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4>// If FPS is 60, this runs 60 times. If FPS is 30, it runs 30 times.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>// The object moves at different speeds on different computers.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span>CurrentPos <span style=color:#ff79c6>=</span> FMath<span style=color:#ff79c6>::</span>Lerp(CurrentPos, TargetPos, <span style=color:#bd93f9>0.1f</span>); 
</span></span></code></pre></div><p><strong>Time Corrected</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// GOOD: Uses DeltaTime
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4>// FInterpTo calculates the correct &#39;t&#39; based on time passed.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>CurrentPos <span style=color:#ff79c6>=</span> FMath<span style=color:#ff79c6>::</span>FInterpTo(CurrentPos, TargetPos, DeltaTime, InterpSpeed);
</span></span></code></pre></div><h2 class=heading id=5-quaternion-vs-euler-angles>5. Quaternion vs Euler Angles
<a class=anchor href=#5-quaternion-vs-euler-angles>#</a></h2><p>You typically don&rsquo;t need to know the complex imaginary number math behind Quaternions ($i^2 = j^2 = k^2 = ijk = -1$). You need to know <strong>why Euler angles fail</strong> and <strong>how to use Quaternions to fix it</strong></p><h3 class=heading id=5a-euler-angles-frotator>5a. Euler Angles (<code>FRotator</code>)
<a class=anchor href=#5a-euler-angles-frotator>#</a></h3><p>Euler angles represent rotation as three separate values applied in a specific order: <strong>Roll (X), Pitch (Y), and Yaw (Z)</strong></p><ul><li><strong>Pros:</strong> Human-readable. &ldquo;Pitch 90&rdquo; means looking straight up</li><li><strong>Cons:</strong> <strong>Gimbal Lock</strong> and messy interpolation</li></ul><p><strong>The Problem: Gimbal Lock</strong></p><p>Imagine a gyroscope with three rings (gimbals)</p><ol><li>You rotate the outer ring (Yaw)</li><li>You rotate the middle ring (Pitch) by <strong>90 degrees</strong></li><li>Now, the inner ring (Roll) is physically aligned with the outer ring (Yaw)</li></ol><p><strong>Result:</strong> Rotating &ldquo;Roll&rdquo; and rotating &ldquo;Yaw&rdquo; now spin the object on the <strong>exact same axis</strong>. You have lost a degree of freedom. You can no longer rotate left/right</p><p>If you try to interpolate Euler angles near 90 degrees pitch, the camera often flips out or spins wildly because the math breaks down</p><h3 class=heading id=5b-quaternions-fquat>5b. Quaternions (<code>FQuat</code>)
<a class=anchor href=#5b-quaternions-fquat>#</a></h3><p>A Quaternion uses 4 numbers (X, Y, Z, W) to represent a rotation around a specific 3D axis</p><ul><li><strong>Pros:</strong><ul><li><strong>No Gimbal Lock:</strong> It doesn&rsquo;t rely on sequential axes</li><li><strong>Shortest Path:</strong> When rotating from A to B, Quaternions always take the shortest arc. Euler angles might take a weird, wobbly path</li><li><strong>Performance:</strong> Multiplying Quaternions is computationally cheaper for the CPU than calculating sine/cosine for three Euler angles</li></ul></li><li><strong>Cons:</strong> Impossible to visualize (e.g., <code>X=0.2, Y=0.5, Z=0.1, W=0.8</code> means nothing to a human)</li></ul><h3 class=heading id=5c-code-example-1>5c. Code example
<a class=anchor href=#5c-code-example-1>#</a></h3><p>Say You want a turret to smoothly rotate to face the player</p><p><strong>The &ldquo;Bad&rdquo; Way (Euler/FRotator):</strong></p><p>Using <code>RInterpTo</code> (which uses Euler math) works for simple things, but if the turret has to look straight up or flip upside down, it will jitter or take a long path</p><p><strong>The &ldquo;Pro-gamer&rdquo; Way (Quaternion/FQuat):</strong></p><p>We use <strong>SLERP</strong> (Spherical Linear Interpolation). This guarantees the smoothest, shortest path between two rotations</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> ATurret<span style=color:#ff79c6>::</span>Tick(<span style=color:#8be9fd>float</span> DeltaTime)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>// 1. Where am I looking now? (Convert Euler to Quat)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    FQuat CurrentQuat <span style=color:#ff79c6>=</span> GetActorQuat();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#6272a4>// 2. Where do I WANT to look?
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>    FVector DirectionToTarget <span style=color:#ff79c6>=</span> (Target<span style=color:#ff79c6>-&gt;</span>GetActorLocation() <span style=color:#ff79c6>-</span> GetActorLocation()).GetSafeNormal();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#6272a4>// Create a Quaternion from a Direction Vector
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// (This is much safer than MakeRotFromX)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    FQuat TargetQuat <span style=color:#ff79c6>=</span> DirectionToTarget.ToOrientationQuat();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#6272a4>// 3. Interpolate (SLERP)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Slerp takes (Start, End, Alpha). 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Alpha needs to be 0.0 to 1.0. 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// We use a constant speed trick here for frame-rate independence.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> RotationSpeed <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5.0f</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    FQuat NewQuat <span style=color:#ff79c6>=</span> FQuat<span style=color:#ff79c6>::</span>Slerp(CurrentQuat, TargetQuat, RotationSpeed <span style=color:#ff79c6>*</span> DeltaTime);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#6272a4>// 4. Apply Rotation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4></span>    SetActorRotation(NewQuat);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div><p>Or you&rsquo;d like to combine rotations. Say you have a spaceship, you&rsquo;d like to apply a &ldquo;Roll&rdquo; rotation based on input, relative to its current rotation</p><p><strong>The &ldquo;Bad&rdquo; Way (Euler Addition):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Adding Euler angles is dangerous because order matters.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4>// Doing this might accidentally affect Pitch/Yaw due to axis coupling.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>FRotator Current <span style=color:#ff79c6>=</span> GetActorRotation();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>Current.Roll <span style=color:#ff79c6>+=</span> <span style=color:#bd93f9>5.0f</span>; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>SetActorRotation(Current);
</span></span></code></pre></div><p><strong>The &ldquo;Pro-gamer&rdquo; Way (Quaternion Multiplication):</strong></p><p>In Quaternion math, <strong>Multiplication = Addition</strong>
To apply rotation B to rotation A, you multiply them: <code>Result = B * A</code>
<em>Note: Order matters! <code>Parent * Child</code> vs <code>Local * World</code></em></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#8be9fd>void</span> ASpaceship<span style=color:#ff79c6>::</span>AddRollInput(<span style=color:#8be9fd>float</span> Val)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#6272a4>// 1. Create a Quaternion representing ONLY the new roll
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Axis: X (Forward), Angle: Val (converted to Radians)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>float</span> AngleRadians <span style=color:#ff79c6>=</span> FMath<span style=color:#ff79c6>::</span>DegreesToRadians(Val);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    FQuat <span style=color:#50fa7b>RollDelta</span>(FVector<span style=color:#ff79c6>::</span>ForwardVector, AngleRadians);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#6272a4>// 2. Get current rotation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span>    FQuat CurrentQuat <span style=color:#ff79c6>=</span> GetActorQuat();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#6272a4>// 3. Combine them
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Multiplying (New * Old) applies the rotation in Local Space.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Multiplying (Old * New) applies it in World Space.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4></span>    FQuat NewQuat <span style=color:#ff79c6>=</span> CurrentQuat <span style=color:#ff79c6>*</span> RollDelta; 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#6272a4>// 4. Apply
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span>    SetActorRotation(NewQuat);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span></code></pre></div><h3 class=heading id=5d-misc-things-that-could-caught-you-off-guard-and-conclusion>5d. Misc things that could caught you off-guard and conclusion
<a class=anchor href=#5d-misc-things-that-could-caught-you-off-guard-and-conclusion>#</a></h3><ul><li><strong><code>FRotator</code>:</strong> Used in the Editor (Details Panel) and Blueprints because it&rsquo;s easy to read</li><li><strong><code>FQuat</code>:</strong> Used by the Physics Engine (PhysX/Chaos) and the Renderer internally</li><li><strong>Conversion:</strong><ul><li><code>MyRotator.Quaternion()</code> -> Returns <code>FQuat</code></li><li><code>MyQuat.Rotator()</code> -> Returns <code>FRotator</code></li></ul></li></ul><p>So, when to use <code>FQuat</code>, over <code>FRotator</code>?</p><p>Prefer <code>FRotator</code> for UI, logging, and simple level placement. However, for any runtime logic involving interpolation (like a homing missile or camera smoothing) or combining multiple rotations (like a tank turret on a moving hull), then I convert to <code>FQuat</code> to avoid Gimbal Lock and ensure smooth SLERPing</p><h2 class=heading id=6-distance-squared>6. Distance Squared
<a class=anchor href=#6-distance-squared>#</a></h2><p>Calculating distance requires a Square Root (<code>sqrt</code>), which is computationally expensive</p><p><strong>Formula:</strong> $Distance = \sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$</p><p><strong>Optimization:</strong>
If you just want to check &ldquo;Is Player within 10 meters?&rdquo;, you don&rsquo;t need the exact distance. You can compare the <strong>Squared Distance</strong></p><p><strong>Code Example:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd>float</span> Range <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1000.0f</span>; <span style=color:#6272a4>// 10 meters
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> RangeSq <span style=color:#ff79c6>=</span> Range <span style=color:#ff79c6>*</span> Range; <span style=color:#6272a4>// 1,000,000
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4>// DistSquared is much faster than Dist (No Sqrt)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>float</span> DistSq <span style=color:#ff79c6>=</span> FVector<span style=color:#ff79c6>::</span>DistSquared(PlayerLoc, EnemyLoc);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#ff79c6>if</span> (DistSq <span style=color:#ff79c6>&lt;</span> RangeSq) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    <span style=color:#6272a4>// Player is in range
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h1 class=heading id=modular-project-example>Modular project example
<a class=anchor href=#modular-project-example>#</a></h1><p>Unfortunately, the world runs in OOP. To get a job, you have to know and willing to do OOP. This means you have to deal with abstractions and bad decisions that comes with an attempt to &ldquo;simplify&rdquo; things initially</p><p>Like they said, &ldquo;The road to hell is paved with good intentions&rdquo;</p><p>But anyway, this architecture implemented in Unreal is what gets me through to Stairway Games. I won&rsquo;t share the code (it&rsquo;s on my private repo), but the explanation is here</p><blockquote><p><strong>Relevant source files</strong></p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></li></ul></blockquote><h2 class=heading id=home>Home
<a class=anchor href=#home>#</a></h2><h3 class=heading id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h3><p>I built this Unreal Fishing Test project to implement a modular, event-driven fishing gameplay system. I centered the core architecture around the <code>UActorComponent_FishingComponent</code>, which acts as the primary logic controller for all fishing-related actions. I decoupled the system by using a <code>UVAGameplayMessagingSubsystem</code> and <code>FGameplayTag</code> for state management and event communication, allowing different parts of the system (UI, animation, game logic) to react to events without direct dependencies.</p><p>The gameplay loop involves player input for casting, a timed waiting period, and reeling in a catch. I created distinct actors for the fishing rod, the fish, and spawn areas, each with its own configurable behavior driven by <code>UDataAsset</code> instances. This data-driven approach allows me to tune parameters like cast distance, fish behavior, and spawn rates without altering code. I managed high-level game states, such as transitioning from fishing to displaying the caught fish, via the <code>AGameModeBase_StairwayFishingGame</code>, which handles camera transitions and player input modes.</p><h3 class=heading id=system-architecture>System Architecture
<a class=anchor href=#system-architecture>#</a></h3><p>I composed the fishing system of several key classes that interact to create the gameplay experience. The <code>UActorComponent_FishingComponent</code> is the central orchestrator, attached to the player pawn. It processes input, manages the fishing state machine, and communicates with other actors and systems.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></p><pre class=mermaid>classDiagram
    direction TD
    class APawn_StairwayFishingGame
    class IPlayerActionInputInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class APlayerController_StairwayFishingGamePlayerController {
        +UInputMappingContext* DefaultInputMappingContext
        +UInputAction* CastingInputAction
        +FOnPlayerActionInput OnCastStartedDelegate
        +FOnPlayerActionInput OnCastTriggeredDelegate
        +FOnPlayerActionInput OnCastCompletedDelegate
        +OnCastStarted()
        +OnCastTriggered()
        +OnCastFinished()
    }

    class UActorComponent_FishingComponent {
        -FGameplayTag CurrentFishingState
        -ICatcherInterface* CurrentCatcher
        -ICatchableInterface* CurrentCatchable
        +OnCastAction()
        +OnCastActionEnded()
        +ReelBack()
        +AttemptGetNearestCatchable()
    }

    class AActor_FishingRod {
        +UStaticMeshComponent* FishingRodMeshComponent
        +UStaticMeshComponent* BobberMeshComponent
        +Throw(FVector InCastLocation)
        +ReelBack()
    }

    class AActor_Fish {
        -bool bBeingTargeted
        +ReeledIn(FVector RodLocation)
        +Escape()
        +WanderWithinBoundingBox()
    }

    class AActor_FishSpawnArea {
        +UBoxComponent* SpawnAreaBox
        +RequestLoadFishAssetSoftClass()
        +SpawnFishes()
    }

    class AGameModeBase_StairwayFishingGame {
        +OnFishingGameLoopStateChanged(FGameplayTag)
        +TriggerScreenFadeInOut()
    }

    class UVAGameplayMessagingSubsystem {
        +BroadcastMessage(FGameplayTag, FVAAnyUnreal)
        +RegisterNewMember(FGameplayTagContainer, listener)
    }

    class FFishingTags {
        +FGameplayTag Messaging_Fishing_Notify_Throw
        +FGameplayTag FishingComponent_State_Idling
        +FGameplayTag FishingGameLoopState_Fishing
    }

    APlayerController_StairwayFishingGamePlayerController --|&gt; IPlayerActionInputInterface
    UActorComponent_FishingComponent ..&gt; APlayerController_StairwayFishingGamePlayerController : Binds to delegates
    APawn_StairwayFishingGame &#34;1&#34; *-- &#34;1&#34; UActorComponent_FishingComponent : &#34;component&#34;
    UActorComponent_FishingComponent ..&gt; AActor_FishingRod : &#34;controls&#34;
    UActorComponent_FishingComponent ..&gt; AActor_Fish : &#34;catches&#34;
    UActorComponent_FishingComponent ..&gt; UVAGameplayMessagingSubsystem : &#34;uses&#34;
    AGameModeBase_StairwayFishingGame ..&gt; UVAGameplayMessagingSubsystem : &#34;uses&#34;
    AActor_FishSpawnArea ..&gt; AActor_Fish : &#34;spawns&#34;
    AGameModeBase_StairwayFishingGame ..&gt; APawn_StairwayFishingGame : &#34;manages&#34;
    UVAGameplayMessagingSubsystem ..&gt; FFishingTags : &#34;uses tags for channels&#34;
    UActorComponent_FishingComponent ..&gt; FFishingTags : &#34;uses tags for state&#34;
</pre><p>This diagram illustrates the primary classes and their relationships. The <code>PlayerController</code> captures input and invokes delegates that the <code>FishingComponent</code> listens to. The <code>FishingComponent</code> then drives the behavior of the <code>FishingRod</code> and interacts with <code>Fish</code> actors, which are spawned by the <code>FishSpawnArea</code>. I routed all major state changes and events via the <code>VAGameplayMessagingSubsystem</code> using channels defined in <code>FFishingTags</code>.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h>Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></p><h3 class=heading id=core-gameplay-loop-casting-and-catching>Core Gameplay Loop: Casting and Catching
<a class=anchor href=#core-gameplay-loop-casting-and-catching>#</a></h3><p>I designed the fishing process as a multi-stage sequence initiated by the player and managed by the <code>UActorComponent_FishingComponent</code>. It flows from input capture, through casting and waiting, to finally reeling in a fish.</p><h4 class=heading id=input-handling>Input Handling
<a class=anchor href=#input-handling>#</a></h4><p>Player input is the entry point for the fishing mechanic. I used the <code>APlayerController_StairwayFishingGamePlayerController</code> to bind hardware input to gameplay actions.</p><ol><li>On <code>BeginPlay</code>, the controller maps the <code>DefaultInputMappingContext</code>.</li><li>The <code>CastingInputAction</code> is bound to three separate trigger events: <code>Started</code>, <code>Triggered</code>, and <code>Completed</code>.</li><li>Each event calls a corresponding handler (<code>OnCastStarted</code>, <code>OnCastTriggered</code>, <code>OnCastFinished</code>), which in turn executes a public delegate (<code>OnCastStartedDelegate</code>, etc.).</li><li>The <code>UActorComponent_FishingComponent</code> binds its own functions (<code>OnCastAction</code>, <code>OnCastActionEnded</code>) to these delegates to initiate and conclude the fishing actions.</li></ol><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><pre class=mermaid>sequenceDiagram
    participant Player
    participant PC as APlayerController
    participant FC as UActorComponent_FishingComponent
    participant UI

    Player-&gt;&gt;PC: Press and Hold Cast Button
    PC-&gt;&gt;PC: OnCastStarted()
    PC--&gt;&gt;FC: OnCastStartedDelegate.Execute()
    FC-&gt;&gt;FC: OnCastAction(elapsedTime)
    FC-&gt;&gt;FC: ToggleDecalVisibility(true)
    loop While Button is Held
        PC-&gt;&gt;PC: OnCastTriggered()
        PC--&gt;&gt;FC: OnCastTriggeredDelegate.Execute()
        FC-&gt;&gt;FC: OnCastAction(elapsedTime)
        FC-&gt;&gt;FC: DetermineCastLocation(elapsedTime)
        FC--&gt;&gt;UI: BroadcastUIMessage(progress)
    end
    Player-&gt;&gt;PC: Release Cast Button
    PC-&gt;&gt;PC: OnCastFinished()
    PC--&gt;&gt;FC: OnCastCompletedDelegate.Execute()
    FC-&gt;&gt;FC: OnCastActionEnded()
</pre><p>This sequence shows how I translated player input into continuous updates for the casting power and visual feedback, culminating in the final cast action when the input is released.</p><h4 class=heading id=the-fishing-sequence>The Fishing Sequence
<a class=anchor href=#the-fishing-sequence>#</a></h4><p>Once the cast is initiated by <code>OnCastActionEnded</code>, a sequence of events involving animations, timelines, and messaging occurs to simulate the fishing process.</p><pre class=mermaid>sequenceDiagram
    autonumber
    participant FC as FishingComponent
    participant GMS as VAGameplayMessagingSubsystem
    participant Anim as AnimInstance
    participant Rod as AActor_FishingRod
    participant Fish as AActor_Fish
    participant GM as GameMode

    FC-&gt;&gt;GMS: BroadcastMessage(AnimInstance_State_Throwing)
    GMS--&gt;&gt;Anim: OnGameplayMessageReceived
    Anim-&gt;&gt;Anim: Play Throw Montage
    Note right of Anim: Montage contains Anim Notifies
    Anim-&gt;&gt;GMS: BroadcastMessage(Notify_Throw)
    GMS--&gt;&gt;FC: OnThrowNotifyMessageReceived
    FC-&gt;&gt;Rod: Throw(CastLocation)
    Rod-&gt;&gt;Rod: ThrowReelInTimeline.PlayFromStart()
    Note over Rod: Animates bobber to water
    Rod--&gt;&gt;FC: CatchableLandsOnWaterDelegate.Execute()
    FC-&gt;&gt;FC: OnBobberLandsOnWater()
    FC-&gt;&gt;FC: AttemptGetNearestCatchable()
    FC-&gt;&gt;Fish: ReeledIn(RodLocation)
    Fish-&gt;&gt;Fish: ReeledInTimeline.PlayFromStart()
    Note over Fish: Animates fish towards bobber
    FC-&gt;&gt;FC: StartWaitingForFishTimer()
    FC--&gt;&gt;FC: CurrentFishingState = WaitingForFish
    
    alt Player Reels In Successfully
        Note over FC: Timer completes, player reels
        FC-&gt;&gt;GMS: BroadcastMessage(AnimInstance_State_Reeling_In)
        GMS--&gt;&gt;Anim: OnGameplayMessageReceived
        Anim-&gt;&gt;Anim: Play Reel In Montage
        Anim-&gt;&gt;GMS: BroadcastMessage(Notify_ReelDone)
        GMS--&gt;&gt;FC: OnReelDoneNotifyMessageReceived
        FC-&gt;&gt;GMS: BroadcastMessage(GameState_StateChange, ShowFish)
        GMS--&gt;&gt;GM: OnGameplayMessageReceived
        GM-&gt;&gt;GM: OnFishingGameLoopStateChanged(ShowFish)
    else Player Fails or Releases Early
        FC-&gt;&gt;Fish: Escape()
        Fish-&gt;&gt;Fish: EscapeTimeline.PlayFromStart()
        Fish--&gt;&gt;Fish: bBeingTargeted = false
        FC-&gt;&gt;FC: ReelBack()
        FC--&gt;&gt;FC: ResetStateAndTimer()
    end
</pre><p>This diagram details the event-driven flow of the fishing action. The <code>FishingComponent</code> initiates state changes by sending messages, which are received by the Animation Instance. The animation, in turn, sends notify messages back at key moments, driving the logic forward without the <code>FishingComponent</code> needing to know about animation specifics.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></p><h3 class=heading id=key-components-and-actors>Key Components and Actors
<a class=anchor href=#key-components-and-actors>#</a></h3><h4 class=heading id=uactorcomponent_fishingcomponent><code>UActorComponent_FishingComponent</code>
<a class=anchor href=#uactorcomponent_fishingcomponent>#</a></h4><p>This is the central class of the feature, responsible for managing the entire fishing lifecycle.</p><div class=table-outer><table><thead><tr><th style=text-align:left>Responsibility</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left><strong>State Management</strong></td><td style=text-align:left>Uses <code>FGameplayTag</code> to track the current state (e.g., <code>Idling</code>, <code>Throwing</code>, <code>WaitingForFish</code>).</td></tr><tr><td style=text-align:left><strong>Input Binding</strong></td><td style=text-align:left>Binds to delegates from the <code>PlayerController</code> to react to player input.</td></tr><tr><td style=text-align:left><strong>Actor Spawning</strong></td><td style=text-align:left>Asynchronously loads and spawns the <code>AActor_FishingRod</code>.</td></tr><tr><td style=text-align:left><strong>Logic Orchestration</strong></td><td style=text-align:left>Calls functions on the <code>FishingRod</code> and <code>Fish</code> actors at appropriate times.</td></tr><tr><td style=text-align:left><strong>Event Handling</strong></td><td style=text-align:left>Listens for messages (e.g., animation notifies) from the <code>VAGameplayMessagingSubsystem</code>.</td></tr><tr><td style=text-align:left><strong>Physics/Tracing</strong></td><td style=text-align:left>Performs line traces to find a valid water surface for casting and sphere traces to find nearby fish.</td></tr></tbody></table></div><p>I made the component&rsquo;s behavior configurable through <code>UDataAsset_FishingComponentConfig</code>, which defines properties like cast range, timing, and socket names for attaching the rod.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><h4 class=heading id=aactor_fishingrod><code>AActor_FishingRod</code>
<a class=anchor href=#aactor_fishingrod>#</a></h4><p>This actor is the visual representation of the fishing rod and bobber.</p><ul><li><strong>Components</strong>: It consists of a <code>FishingRodMeshComponent</code> (the rod) and a <code>BobberMeshComponent</code>. I attached a <code>CatchableAttachPoint</code> to the bobber for holding the fish.</li><li><strong>Animation</strong>: It does not use skeletal animation. Instead, I used <code>FTimeline</code> objects driven by <code>UCurveFloat</code> assets to interpolate the bobber&rsquo;s position when <code>Throw()</code> and <code>ReelBack()</code> are called. This provides a simple procedural animation.</li></ul><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></p><h4 class=heading id=aactor_fish><code>AActor_Fish</code>
<a class=anchor href=#aactor_fish>#</a></h4><p>Represents a single fish that can be caught.</p><ul><li><strong>AI Behavior</strong>: When not targeted, the fish performs a simple <code>WanderWithinBoundingBox</code> behavior, moving towards random points within the confines of its <code>AActor_FishSpawnArea</code>.</li><li><strong>State</strong>: A boolean <code>bBeingTargeted</code> flag controls whether the fish is wandering or being interacted with.</li><li><strong>Interaction</strong>: Implements the <code>ICatchableInterface</code>. The <code>ReeledIn</code> function triggers a timeline to move the fish towards the bobber. The <code>Escape</code> function triggers a different timeline to return it to its initial location.</li></ul><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></p><h4 class=heading id=aactor_fishspawnarea><code>AActor_FishSpawnArea</code>
<a class=anchor href=#aactor_fishspawnarea>#</a></h4><p>This actor defines a volume in the world where fish can be spawned and exist.</p><ul><li><strong>Spawning Logic</strong>: On <code>BeginPlay</code>, it asynchronously requests to load the fish actor&rsquo;s class from a <code>TSoftClassPtr</code> defined in its config data asset.</li><li><strong>Async Loading</strong>: I used <code>UAssetManager::GetStreamableManager().RequestAsyncLoad</code> to prevent hitches from loading the fish asset.</li><li><strong>Volume</strong>: Once the asset is loaded, it spawns a configured number of fish at random locations within its <code>UBoxComponent</code> bounds. It also passes its bounds to each fish so they know the area within which they can wander.</li></ul><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></p><h3 class=heading id=state-and-event-management>State and Event Management
<a class=anchor href=#state-and-event-management>#</a></h3><p>I relied on a decoupled messaging system and gameplay tags for managing state and communication.</p><h4 class=heading id=gameplay-tags-ffishingtags>Gameplay Tags (<code>FFishingTags</code>)
<a class=anchor href=#gameplay-tags-ffishingtags>#</a></h4><p>I created a central singleton class, <code>FFishingTags</code>, to define all gameplay tags used by the system. This prevents errors from typos and provides a single source of truth for all tags.</p><div class=table-outer><table><thead><tr><th style=text-align:left>Tag Category</th><th style=text-align:left>Example</th><th style=text-align:left>Purpose</th></tr></thead><tbody><tr><td style=text-align:left><strong>Messaging Channel</strong></td><td style=text-align:left><code>Messaging.Fishing.Notify.Throw</code></td><td style=text-align:left>Used as a channel ID for broadcasting and listening to events.</td></tr><tr><td style=text-align:left><strong>Anim Instance State</strong></td><td style=text-align:left><code>AnimInstance.Fishing.State.Throwing</code></td><td style=text-align:left>Sent to the Animation Blueprint to trigger a specific animation state.</td></tr><tr><td style=text-align:left><strong>Component State</strong></td><td style=text-align:left><code>FishingComponent.State.WaitingForFish</code></td><td style=text-align:left>Used internally by <code>FishingComponent</code> to manage its state machine.</td></tr><tr><td style=text-align:left><strong>Game Loop State</strong></td><td style=text-align:left><code>FishingGameLoopState.ShowFish</code></td><td style=text-align:left>A high-level state managed by the Game Mode.</td></tr></tbody></table></div><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></p><h4 class=heading id=game-mode-state-transitions>Game Mode State Transitions
<a class=anchor href=#game-mode-state-transitions>#</a></h4><p>The <code>AGameModeBase_StairwayFishingGame</code> handles high-level game states that affect the entire experience, such as switching between active gameplay and a cinematic view of a caught fish.</p><pre class=mermaid>stateDiagram-v2
    [*] --&gt; Fishing
    Fishing: Player can cast and fish
    ShowFish: Player input disabled, shows caught fish

    Fishing --&gt; ShowFish: On successful catch
    ShowFish --&gt; Fishing: On returning to gameplay
</pre><p>This state transition is handled in <code>OnFishingGameLoopStateChanged</code>. When the state changes, this function:</p><ol><li>Toggles player input between <code>FInputModeGameOnly</code> and <code>FInputModeUIOnly</code>.</li><li>Initiates a camera fade-out.</li><li>Switches the active camera on the pawn (which implements <code>ISwitchableFishingViewInterface</code>).</li><li>Broadcasts a <code>Messaging_GameMode_StateChangeFinish</code> message.</li><li>Initiates a camera fade-in.</li></ol><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></p><h3 class=heading id=conclusion>Conclusion
<a class=anchor href=#conclusion>#</a></h3><p>I built this fishing system to be modular and component-based. I focused on decoupling the messaging system for communication. The data-driven configuration via <code>UDataAsset</code>s allows me to tweak and balance the gameplay without code changes. I separated concernsâinput handling in the <code>PlayerController</code>, core logic in the <code>ActorComponent</code>, and visual representation in various <code>Actor</code> classesâto keep the system maintainable.</p><hr><h3 class=heading id=getting-started>Getting Started
<a class=anchor href=#getting-started>#</a></h3><h4 class=heading id=related-pages>Related Pages
<a class=anchor href=#related-pages>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp>Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp</a></li></ul></blockquote><h2 class=heading id=getting-started-1>Getting Started
<a class=anchor href=#getting-started-1>#</a></h2><p>Here is a technical overview of the fishing gameplay system I created for the Unreal-Fishing-Test project. I designed the system as a self-contained feature to handle all aspects of fishing, from casting a line to catching a fish. I built it upon several core components, a data-driven configuration approach using Data Assets, and a decoupled messaging system for communication between different parts of the game. I encapsulated the core logic within an Actor Component, making it portable and easy to attach to any player character.</p><p>My architecture emphasizes separation of concerns: player input, fishing logic, actor behaviors (fish, fishing rod), and game state transitions are all handled by distinct classes. I facilitated communication via the <code>VAGameplayMessagingSubsystem</code>, which uses <code>FGameplayTag</code> as channels to broadcast and listen for events, avoiding hard references between components. This guide details the key components, the overall gameplay flow, the state management system, and the configuration options I made available.</p><h3 class=heading id=core-architecture-and-components>Core Architecture and Components
<a class=anchor href=#core-architecture-and-components>#</a></h3><p>I composed the fishing system of several key classes that work together to create the full gameplay experience. The main components are the Player Pawn, the Fishing Component, the Fishing Rod, the Fish, and the Fish Spawn Area.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></p><pre class=mermaid>classDiagram
    direction TD

    class APawn_StairwayFishingGame {
        +UActorComponent_FishingComponent* FishingComponent
        +UCameraComponent* Camera
        +UCameraComponent* ShowFishCamera
        +SetFishingView(FGameplayTag)
    }

    class UActorComponent_FishingComponent {
        -ICatcherInterface* CurrentCatcher
        -ICatchableInterface* CurrentCatchable
        -FGameplayTag CurrentFishingState
        +OnCastAction(float)
        +OnCastActionEnded(float)
        +AttemptToCast(FVector)
        +AttemptGetNearestCatchable()
        +ReelInCurrentCatchable()
    }

    class ICatcherInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class AActor_FishingRod {
        +UStaticMeshComponent* BobberMeshComponent
        +Throw(FVector)
        +ReelBack()
    }

    class ICatchableInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class AActor_Fish {
        +ReeledIn(FVector)
        +Escape()
        +WanderWithinBoundingBox(float)
    }

    class AActor_FishSpawnArea {
        +UBoxComponent* SpawnAreaBox
        +SpawnFishes(...)
    }

    class IPlayerActionInputInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class APlayerController_StairwayFishingGamePlayerController {
        +UInputAction* CastingInputAction
        +OnCastActionStarted()
        +OnCastActionTriggered()
        +OnCastActionCompleted()
    }

    APawn_StairwayFishingGame &#34;1&#34; *-- &#34;1&#34; UActorComponent_FishingComponent : contains
    APlayerController_StairwayFishingGamePlayerController ..&gt; UActorComponent_FishingComponent : provides input
    UActorComponent_FishingComponent ..&gt; AActor_FishingRod : controls
    UActorComponent_FishingComponent ..&gt; AActor_Fish : catches
    AActor_FishSpawnArea ..&gt; AActor_Fish : spawns
    AActor_FishingRod --|&gt; ICatcherInterface
    AActor_Fish --|&gt; ICatchableInterface
    APlayerController_StairwayFishingGamePlayerController --|&gt; IPlayerActionInputInterface
</pre><p>This diagram illustrates the primary classes and their relationships within the fishing system.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h>Source/FishingFeature/Public/Actor/Actor_FishSpawnArea.h</a></p><h4 class=heading id=key-components>Key Components
<a class=anchor href=#key-components>#</a></h4><div class=table-outer><table><thead><tr><th>Component</th><th>Description</th><th>Source File</th></tr></thead><tbody><tr><td><code>APawn_StairwayFishingGame</code></td><td>The player character pawn. It hosts the <code>UActorComponent_FishingComponent</code> and manages the active camera between the main gameplay view and the &ldquo;show fish&rdquo; view.</td><td><code>Pawn/Pawn_StairwayFishingGame.h</code></td></tr><tr><td><code>UActorComponent_FishingComponent</code></td><td>The central logic hub for the fishing mechanic. It manages states, handles player input for casting, detects catchable fish, and controls the fishing rod and caught fish.</td><td><code>ActorComponent/ActorComponent_FishingComponent.h</code></td></tr><tr><td><code>APlayerController_StairwayFishingGamePlayerController</code></td><td>Implements <code>IPlayerActionInputInterface</code> to handle raw input from Unreal&rsquo;s Enhanced Input system. It binds the <code>CastingInputAction</code> and broadcasts delegates for <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events.</td><td><code>PlayerController/PlayerController_StairwayFishingGamePlayerController.h</code></td></tr><tr><td><code>AActor_FishSpawnArea</code></td><td>An actor responsible for spawning <code>AActor_Fish</code> instances within a defined <code>UBoxComponent</code> volume at the start of the game. It asynchronously loads the fish asset before spawning.</td><td><code>Actor/Actor_FishSpawnArea.h</code></td></tr><tr><td><code>AActor_Fish</code></td><td>Represents a catchable fish. It implements the <code>ICatchableInterface</code>, manages its own wandering movement within its spawn area, and handles being reeled in or escaping.</td><td><code>Actor/Actor_Fish.h</code></td></tr><tr><td><code>AActor_FishingRod</code></td><td>The visual representation of the fishing rod and bobber. It implements the <code>ICatcherInterface</code> and uses timelines to animate the bobber being thrown and reeled back.</td><td><code>Actor/Actor_FishingRod.h</code></td></tr><tr><td><code>AGameModeBase_StairwayFishingGame</code></td><td>Manages the high-level game loop state transitions. It listens for state change requests and orchestrates screen fades and player input mode changes between &ldquo;fishing&rdquo; and &ldquo;show fish&rdquo; states.</td><td><code>GameModeBase/GameModeBase_StairwayFishingGame.h</code></td></tr></tbody></table></div><h3 class=heading id=gameplay-flow>Gameplay Flow
<a class=anchor href=#gameplay-flow>#</a></h3><p>The fishing process follows a sequence of events, from game initialization to catching a fish. This flow is managed by the core components and driven by player input and a messaging system.</p><h4 class=heading id=initialization-and-fish-spawning>Initialization and Fish Spawning
<a class=anchor href=#initialization-and-fish-spawning>#</a></h4><p>When the level starts, the <code>AActor_FishSpawnArea</code> is responsible for populating the water with fish.</p><pre class=mermaid>sequenceDiagram
    participant World
    participant AActor_FishSpawnArea
    participant UAssetManager
    participant ICatchableInterface

    World-&gt;&gt;AActor_FishSpawnArea: BeginPlay()
    AActor_FishSpawnArea-&gt;&gt;UAssetManager: RequestAsyncLoad(FishActorClass)
    UAssetManager--&gt;&gt;AActor_FishSpawnArea: OnFishSpawnAssetLoaded()
    loop For each fish to spawn
        AActor_FishSpawnArea-&gt;&gt;World: SpawnActorDeferred(AActor)
        World--&gt;&gt;AActor_FishSpawnArea: SpawnedActor
        AActor_FishSpawnArea-&gt;&gt;ICatchableInterface: SetSpawnAreaCenterAndExtent(...)
        ICatchableInterface--&gt;&gt;AActor_FishSpawnArea: (acknowledge)
        AActor_FishSpawnArea-&gt;&gt;World: FinishSpawning()
        World--&gt;&gt;AActor_FishSpawnArea: (done)
    end
</pre><p>This sequence shows the asynchronous loading and subsequent spawning of fish actors within the defined spawn area. The spawn area provides its bounds to each fish so they can wander within it.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></p><h4 class=heading id=the-casting-process>The Casting Process
<a class=anchor href=#the-casting-process>#</a></h4><p>The casting process begins when the player presses and holds the cast input action. The duration of the hold determines the casting distance.</p><ol><li><strong>Input Handling</strong>: The <code>APlayerController_StairwayFishingGamePlayerController</code> captures the <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events from the <code>CastingInputAction</code>. These events are broadcast via delegates.</li><li><strong>Casting Logic</strong>: The <code>UActorComponent_FishingComponent</code> listens to these delegates.<ul><li>On <code>Started</code>, it begins tracking the cast time and shows a target decal on the water.</li><li>While <code>Triggered</code> (held down), it continuously updates the cast location based on the elapsed time, mapping it to a min/max distance. A line trace from the calculated position downwards determines the final water surface location.</li><li>On <code>Completed</code> (released), it triggers the throwing animation and instructs the <code>AActor_FishingRod</code> to throw its bobber.</li></ul></li></ol><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><pre class=mermaid>sequenceDiagram
    participant Player
    participant PlayerController
    participant FishingComponent
    participant World
    participant FishingRod

    Player-&gt;&gt;PlayerController: Press &amp; Hold Cast Button
    PlayerController-&gt;&gt;FishingComponent: OnCastActionStarted()
    FishingComponent-&gt;&gt;FishingComponent: Start Cast Timer
    loop While Button Held
        PlayerController-&gt;&gt;FishingComponent: OnCastActionTriggered(ElapsedTime)
        FishingComponent-&gt;&gt;FishingComponent: DetermineCastLocation(ElapsedTime)
        Note right of FishingComponent: Maps time to distance
        FishingComponent-&gt;&gt;World: LineTraceSingleByObjectType()
        World--&gt;&gt;FishingComponent: HitResult (Water Location)
        FishingComponent-&gt;&gt;FishingComponent: Update Decal Position
    end
    Player-&gt;&gt;PlayerController: Release Cast Button
    PlayerController-&gt;&gt;FishingComponent: OnCastActionCompleted()
    FishingComponent-&gt;&gt;FishingComponent: Set state to Throwing
    Note right of FishingComponent: Broadcasts Anim State Change Message
    FishingComponent-&gt;&gt;FishingRod: Throw(CastLocation)
</pre><p>This diagram details the flow from player input to the bobber being cast into the water.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></p><h4 class=heading id=catching-a-fish>Catching a Fish
<a class=anchor href=#catching-a-fish>#</a></h4><p>Once the bobber lands in the water, the <code>FishingComponent</code> attempts to find a nearby fish.</p><ol><li><strong>Bobber Lands</strong>: The <code>AActor_FishingRod</code> notifies the <code>FishingComponent</code> via a delegate (<code>OnLandsOnWater</code>) when its throwing timeline is complete.</li><li><strong>Find Catchable</strong>: The <code>FishingComponent</code> performs a sphere trace around the bobber&rsquo;s location to find all actors implementing <code>ICatchableInterface</code>. It sorts these actors by distance and selects the nearest one as <code>CurrentCatchable</code>.</li><li><strong>Luring the Fish</strong>: The <code>FishingComponent</code> calls <code>ReeledIn()</code> on the <code>CurrentCatchable</code> (<code>AActor_Fish</code>). The fish then uses a timeline to move from its current position to the bobber&rsquo;s location.</li><li><strong>Waiting State</strong>: The <code>FishingComponent</code> enters the <code>WaitingForFish</code> state and starts a timer (<code>TimeToFish</code>). If the player does not act before this timer runs out, the fish escapes.</li><li><strong>Reeling In</strong>: If the player presses the cast button again while in the <code>WaitingForFish</code> state, the catch is successful. The component transitions to the <code>Reeling_In</code> state, and a message is sent to the animation system to play the reeling animation.</li></ol><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></p><h3 class=heading id=state-management-and-messaging>State Management and Messaging
<a class=anchor href=#state-management-and-messaging>#</a></h3><p>I relied on Gameplay Tags for both internal state management and for communication via a global messaging subsystem.</p><h4 class=heading id=component-state-machine>Component State Machine
<a class=anchor href=#component-state-machine>#</a></h4><p>The <code>UActorComponent_FishingComponent</code> uses a set of <code>FGameplayTag</code> variables to manage its internal state, ensuring operations occur in the correct sequence.</p><pre class=mermaid>graph TD
    A[Idling] --&gt;|Cast Button Pressed| B(Throwing);
    B --&gt;|Throw Anim Notify| C(WaitingForFish);
    C --&gt;|Player Reels In Time| D(Reeling_In);
    C --&gt;|Timer Expires| E(Reeling_Out);
    E --&gt;|Reel Anim Done| A;
    D --&gt;|Reel Anim Done| F(CaughtFish);
    F --&gt;|State Change to Fishing| A;
</pre><p>This state diagram shows the primary states of the <code>FishingComponent</code> and the transitions between them.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Private/FishingTags.cpp>Source/FishingGameplayTags/Private/FishingTags.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><h4 class=heading id=messaging-system>Messaging System
<a class=anchor href=#messaging-system>#</a></h4><p>I achieved decoupled communication using <code>UVAGameplayMessagingSubsystem</code>. Components can broadcast messages on specific <code>FGameplayTag</code> channels, and other components can create listeners for those channels without needing direct references.</p><p><strong>Key Messaging Channels:</strong></p><div class=table-outer><table><thead><tr><th>Channel Tag</th><th>Payload Type</th><th>Description</th></tr></thead><tbody><tr><td><code>Messaging.Fishing.UI.Cast.Update</code></td><td><code>float</code></td><td>Broadcasts the current charge of the cast (0.0 to 1.0) for UI elements like a power bar.</td></tr><tr><td><code>Messaging.Fishing.AnimInstance.StateChange</code></td><td><code>FGameplayTag</code></td><td>Sent to the Animation Blueprint to switch between animation states (e.g., <code>Idling</code>, <code>Throwing</code>, <code>Reeling_In</code>).</td></tr><tr><td><code>Messaging.GameState.StateChange</code></td><td><code>FGameplayTag</code></td><td>Broadcast when a high-level game state change is required, such as from <code>Fishing</code> to <code>ShowFish</code>. This is received by the <code>GameState</code>.</td></tr><tr><td><code>Messaging.GameMode.StateChange.Finish</code></td><td><code>FGameplayTag</code></td><td>Broadcast by the <code>GameMode</code> after its state transition (including screen fade) is complete. The <code>FishingComponent</code> listens for this to finalize the catch.</td></tr><tr><td><code>Messaging.Fishing.Notify.Throw</code></td><td>Empty</td><td>An animation notify that signals the exact moment in an animation the bobber should be thrown. The <code>FishingComponent</code> listens for this.</td></tr><tr><td><code>Messaging.Fishing.Notify.ReelDone</code></td><td>Empty</td><td>An animation notify that signals the reeling animation has finished.</td></tr></tbody></table></div><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Private/FishingTags.cpp>Source/FishingGameplayTags/Private/FishingTags.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><p>The <code>VAGameplayMessagingSubsystem</code> uses a <code>TMap&lt;FGameplayTag, FChannelMembersData></code> to keep track of all active listeners for each channel. When a message is broadcast, it looks up the channel tag in the map and iterates through the list of listeners, invoking their <code>OnGameplayMessageReceived</code> delegate.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></p><h3 class=heading id=configuration-via-data-assets>Configuration via Data Assets
<a class=anchor href=#configuration-via-data-assets>#</a></h3><p>I made the fishing system configurable through the use of <code>UDataAsset</code>. This allows me to tweak gameplay parameters without modifying code.</p><ul><li><strong><code>DataAsset_FishingComponentConfig</code></strong>: Configures the core fishing mechanics.<ul><li><code>MaximumTimeToCast</code>: How long the player can hold the button to charge a cast.</li><li><code>MinimumCastDistance</code> / <code>MaximumCastDistance</code>: The range of the cast distance.</li><li><code>CastRadius</code>: The radius of the sphere trace used to find fish.</li><li><code>TimeToFish</code>: The window of time the player has to reel in a fish after it bites.</li><li><code>FishingRodActorClass</code>: A soft reference to the <code>AActor_FishingRod</code> blueprint to spawn.</li></ul></li><li><strong><code>DataAsset_ActorFishConfig</code></strong>: Configures the behavior of an individual fish.<ul><li><code>FishRotationSpeed</code> / <code>FishMoveSpeed</code>: Controls the speed of the fish&rsquo;s wandering movement.</li><li><code>FishReelingInCurve</code>: A <code>UCurveFloat</code> that defines the fish&rsquo;s movement as it&rsquo;s lured to the bobber.</li><li><code>FishBiteSound</code>: The sound to play when the fish is successfully caught.</li></ul></li><li><strong><code>DataAsset_FishSpawnAreaConfig</code></strong>: Configures the fish spawning logic.<ul><li><code>FishActorClass</code>: A soft reference to the <code>AActor_Fish</code> blueprint to spawn.</li><li><code>FishSpawnAmount</code>: The number of fish to spawn in the area.</li></ul></li><li><strong><code>DataAsset_FishingRodConfig</code></strong>: Configures the fishing rod&rsquo;s animations.<ul><li><code>BobberReelInCurve</code>: A <code>UCurveFloat</code> defining the bobber&rsquo;s trajectory when thrown.</li><li><code>BobberReelOutCurve</code>: A <code>UCurveFloat</code> defining the bobber&rsquo;s movement when reeled back.</li></ul></li></ul><h3 class=heading id=editor-enhancements>Editor Enhancements
<a class=anchor href=#editor-enhancements>#</a></h3><p>To improve the workflow, I implemented a custom details panel customization for the <code>UActorComponent_FishingComponent</code>.</p><p>The <code>FDetailCustomization_FishingComponent</code> class provides a dropdown menu for selecting socket names (<code>FishingPoleSocketName</code>, <code>CarryFishSocketName</code>) in the editor. Instead of requiring me to manually type in socket names, this customization inspects the <code>OwnerSkeletalMesh</code> property within the component&rsquo;s configuration. It then populates a <code>SComboBox</code> with all available bone and socket names from that mesh, preventing typos and making setup faster. The dropdown is automatically updated whenever the assigned <code>SkeletalMesh</code> is changed.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp>Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp</a></p><hr><h3 class=heading id=module-overview>Module Overview
<a class=anchor href=#module-overview>#</a></h3><h4 class=heading id=related-pages-1>Related Pages
<a class=anchor href=#related-pages-1>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><blockquote><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li></ul></blockquote><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp>Source/FishingFeatureEditor/Private/DetailCustomization/DetailCustomization_FishingComponent.cpp</a></li></ul></blockquote><h2 class=heading id=module-overview-1>Module Overview
<a class=anchor href=#module-overview-1>#</a></h2><p>Here is a technical overview of the Unreal-Fishing-Test project, a modular fishing game system I built in Unreal Engine. I designed the architecture to be event-driven and decoupled, separating the core gameplay logic, the fishing feature itself, and the messaging system into distinct modules. This separation facilitates maintenance, testing, and potential expansion of features.</p><p>The system&rsquo;s backbone is a custom gameplay messaging subsystem, <code>VAGameplayMessagingSubsystem</code>, which uses <code>FGameplayTag</code> channels for communication. This allows various components, such as the <code>PlayerController</code>, <code>FishingComponent</code>, and <code>GameMode</code>, to interact without direct dependencies. I managed the core gameplay loop through a state machine implemented across the <code>GameState</code> and <code>GameMode</code>, transitioning the player between fishing and displaying the catch.</p><h3 class=heading id=core-modules>Core Modules
<a class=anchor href=#core-modules>#</a></h3><p>I structured the project into several key modules, each with a specific responsibility.</p><div class=table-outer><table><thead><tr><th>Module</th><th>Responsibility</th></tr></thead><tbody><tr><td><code>StairwayFishingGameCore</code></td><td>Manages the main game loop, player pawn, controller, game mode, and game state.</td></tr><tr><td><code>FishingFeature</code></td><td>Contains all logic and assets for the fishing mechanic, including the fishing component, rod, fish, and spawn areas.</td></tr><tr><td><code>VAGameplayMessaging</code></td><td>Provides a global, event-driven messaging system for decoupled communication between modules.</td></tr><tr><td><code>FishingGameplayTags</code></td><td>Defines and registers all <code>FGameplayTag</code> constants used for messaging and state management.</td></tr><tr><td><code>FishingFeatureEditor</code></td><td>Implements Unreal Editor customizations to improve the development workflow, such as custom details panels.</td></tr></tbody></table></div><h4 class=heading id=module-dependency-diagram>Module Dependency Diagram
<a class=anchor href=#module-dependency-diagram>#</a></h4><p>The following diagram illustrates the dependencies between the primary modules. The core game logic depends on the fishing feature and the messaging system, while the feature itself also relies on messaging to communicate events.</p><pre class=mermaid>graph TD
    subgraph Application
        StairwayFishingGameCore
        FishingFeature
        VAGameplayMessaging
    end

    subgraph Editor
        FishingFeatureEditor
    end

    StairwayFishingGameCore --&gt; FishingFeature
    StairwayFishingGameCore --&gt; VAGameplayMessaging
    FishingFeature --&gt; VAGameplayMessaging
    FishingFeatureEditor --&gt; FishingFeature
</pre><h3 class=heading id=gameplay-flow-and-state-management>Gameplay Flow and State Management
<a class=anchor href=#gameplay-flow-and-state-management>#</a></h3><p>I managed the primary gameplay loop using a state machine pattern distributed between <code>AGameStateBase_StairwayFishingGame</code> and <code>AGameModeBase_StairwayFishingGame</code>.</p><h4 class=heading id=state-management>State Management
<a class=anchor href=#state-management>#</a></h4><ul><li><strong><code>AGameStateBase_StairwayFishingGame</code></strong>: This class is responsible for maintaining the current state of the game loop, stored in the <code>CurrentFishingGameLoopState</code> property. It listens for state change requests on the <code>Messaging_GameState_StateChange</code> channel. When a new state is received, it updates its internal state and broadcasts the change via its <code>OnFishingGameLoopStateChanged</code> delegate.</li><li><strong><code>AGameModeBase_StairwayFishingGame</code></strong>: The game mode listens to the <code>GameState</code>&rsquo;s <code>OnFishingGameLoopStateChanged</code> delegate. Upon a state change, it orchestrates the necessary transitions, such as triggering camera fades, changing player input modes (e.g., from <code>FInputModeGameOnly</code> to <code>FInputModeUIOnly</code>), and instructing the player pawn to switch cameras via the <code>ISwitchableFishingViewInterface</code>.</li></ul><h4 class=heading id=gameplay-sequence-diagram>Gameplay Sequence Diagram
<a class=anchor href=#gameplay-sequence-diagram>#</a></h4><p>This diagram illustrates the complete sequence of events from casting the line to catching a fish and transitioning to the &ldquo;Show Fish&rdquo; view.</p><pre class=mermaid>sequenceDiagram
    participant Player
    participant PC as PlayerController
    participant FC as FishingComponent
    participant FR as FishingRod
    participant Fish as FishActor
    participant GS as GameState
    participant GM as GameMode
    participant Pawn
    participant VAGameplayMessaging

    Player-&gt;&gt;PC: Press/Hold Cast Action
    PC-&gt;&gt;FC: OnCastActionTriggered()
    FC-&gt;&gt;FC: Calculate Cast Distance
    Player-&gt;&gt;PC: Release Cast Action
    PC-&gt;&gt;FC: OnCastActionCompleted()
    FC-&gt;&gt;VAGameplayMessaging: Broadcast(AnimInstance_State_Throwing)
    Note over FC: Anim BP triggers &#34;Throw&#34; notify

    VAGameplayMessaging--&gt;&gt;FC: OnThrowNotifyMessageReceived()
    FC-&gt;&gt;FR: Throw(CastLocation)
    FR--&gt;&gt;FC: CatchableLandsOnWaterDelegate.Execute()
    FC-&gt;&gt;FC: Find nearest Fish
    FC-&gt;&gt;Fish: ReeledIn(RodLocation)
    Fish--&gt;&gt;FC: (Fish moves to bobber)

    Player-&gt;&gt;PC: Press Cast Action (to reel)
    PC-&gt;&gt;FC: OnCastActionCompleted()
    FC-&gt;&gt;FR: ReelBack()
    FC-&gt;&gt;VAGameplayMessaging: Broadcast(AnimInstance_State_Reeling_In)
    Note over FC: Anim BP triggers &#34;ReelDone&#34; notify

    VAGameplayMessaging--&gt;&gt;FC: OnReelDoneNotifyMessageReceived()
    FC-&gt;&gt;VAGameplayMessaging: Broadcast(GameState_StateChange, &#34;ShowFish&#34;)

    VAGameplayMessaging--&gt;&gt;GS: OnGameStateChangeMessageReceived()
    GS-&gt;&gt;GS: SetCurrentFishingGameLoopState(&#34;ShowFish&#34;)
    GS-&gt;&gt;GM: OnFishingGameLoopStateChanged.Broadcast()
    GM-&gt;&gt;GM: TriggerScreenFadeInOut()
    GM-&gt;&gt;Pawn: SetFishingView(&#34;ShowFish&#34;)
    Pawn--&gt;&gt;Pawn: Switch to ShowFishCamera
    GM--&gt;&gt;GS: (Transition logic)
    GM-&gt;&gt;VAGameplayMessaging: Broadcast(GameMode_StateChangeFinish)

    VAGameplayMessaging--&gt;&gt;FC: OnGameModeStateChangeFinishMessageReceived()
    FC-&gt;&gt;FC: Attach fish to player socket
</pre><h3 class=heading id=event-driven-communication>Event-Driven Communication
<a class=anchor href=#event-driven-communication>#</a></h3><p>I relied on the <code>UVAGameplayMessagingSubsystem</code> for decoupled communication. This system allows any object to broadcast a message on a specific <code>FGameplayTag</code> channel, and any other object to listen for messages on that channel without needing a direct reference.</p><ul><li><strong>Broadcasting</strong>: Messages are sent using <code>UVAGameplayMessagingSubsystem::BroadcastMessage</code>. The payload can be any struct wrapped in the <code>FVAAnyUnreal</code> type, which allows for flexible data transfer.</li><li><strong>Listening</strong>: Listeners are created using the async action <code>UVAGameplayMessaging_ListenForGameplayMessages::ListenForGameplayMessagesViaChannel</code>. This node registers itself with the subsystem and exposes a delegate (<code>OnGameplayMessageReceived</code>) that fires when a message is broadcast on the subscribed channel.</li></ul><h4 class=heading id=key-gameplay-tags>Key Gameplay Tags
<a class=anchor href=#key-gameplay-tags>#</a></h4><p>Gameplay Tags are central to the messaging system, defining channels for events and states.</p><div class=table-outer><table><thead><tr><th>Tag Category</th><th>Tag Name</th><th>Purpose</th></tr></thead><tbody><tr><td><code>Messaging.Fishing</code></td><td><code>UI.Cast.Update</code></td><td>Sends updates to the UI about the casting power meter.</td></tr><tr><td><code>Messaging.Fishing</code></td><td><code>Notify.Throw</code></td><td>Fired by an animation notify to signal the moment to throw the line.</td></tr><tr><td><code>Messaging.Fishing</code></td><td><code>Notify.ReelDone</code></td><td>Fired by an animation notify when the reeling animation is complete.</td></tr><tr><td><code>Messaging.Fishing</code></td><td><code>AnimInstance.StateChange</code></td><td>Instructs the character&rsquo;s Animation Blueprint to switch states.</td></tr><tr><td><code>Messaging.GameState</code></td><td><code>StateChange</code></td><td>Requests a change in the global game loop state (e.g., to &ldquo;ShowFish&rdquo;).</td></tr><tr><td><code>Messaging.GameMode</code></td><td><code>StateChange.Finish</code></td><td>Signals that the GameMode has completed its state transition logic.</td></tr><tr><td><code>FishingGameLoopState</code></td><td><code>Fishing</code> / <code>ShowFish</code></td><td>Defines the primary states of the game loop.</td></tr><tr><td><code>FishingComponent.State</code></td><td><code>Idling</code>, <code>Throwing</code>, etc.</td><td>Defines the internal states of the <code>FishingComponent</code>.</td></tr><tr><td><code>AnimInstance.Fishing</code></td><td><code>Idling</code>, <code>Throwing</code>, etc.</td><td>Defines animation states for the character&rsquo;s animation blueprint.</td></tr></tbody></table></div><h3 class=heading id=fishing-mechanic-implementation>Fishing Mechanic Implementation
<a class=anchor href=#fishing-mechanic-implementation>#</a></h3><p>The <code>FishingFeature</code> module encapsulates all components related to the act of fishing.</p><h4 class=heading id=class-relationship-diagram>Class Relationship Diagram
<a class=anchor href=#class-relationship-diagram>#</a></h4><p>This diagram shows the main classes within the <code>FishingFeature</code> module and their relationships.</p><pre class=mermaid>classDiagram
    direction TD
    class APawn_StairwayFishingGame {
        +UActorComponent_FishingComponent* FishingComponent
    }
    class UActorComponent_FishingComponent {
        -ICatcherInterface* CurrentCatcher
        -ICatchableInterface* CurrentCatchable
        +OnCastActionStarted()
        +OnCastActionCompleted()
        +Throw()
        +ReelBack()
    }
    class ICatcherInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class AActor_FishingRod {
        +Throw(FVector InCastLocation)
        +ReelBack()
    }
    class ICatchableInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class AActor_Fish {
        +ReeledIn(FVector RodLocation)
        +Escape()
    }
    class AActor_FishSpawnArea {
        +SpawnFishes()
    }

    APawn_StairwayFishingGame &#34;1&#34; *-- &#34;1&#34; UActorComponent_FishingComponent : hosts
    UActorComponent_FishingComponent ..&gt; ICatcherInterface : uses
    UActorComponent_FishingComponent ..&gt; ICatchableInterface : uses
    AActor_FishingRod --|&gt; ICatcherInterface : implements
    AActor_Fish --|&gt; ICatchableInterface : implements
    AActor_FishSpawnArea ..&gt; AActor_Fish : spawns
</pre><h4 class=heading id=core-components>Core Components
<a class=anchor href=#core-components>#</a></h4><ul><li><strong><code>UActorComponent_FishingComponent</code></strong>: This is the brain of the fishing system. Attached to the player pawn, it manages the fishing state machine (<code>Idling</code>, <code>Throwing</code>, <code>WaitingForFish</code>, etc.). It binds to player input delegates from the <code>PlayerController</code>, handles the logic for casting distance, detects nearby fish using sphere traces, and orchestrates interactions between the fishing rod (<code>ICatcherInterface</code>) and the fish (<code>ICatchableInterface</code>).</li><li><strong><code>AActor_FishingRod</code></strong>: Implements the <code>ICatcherInterface</code>. This actor represents the physical fishing rod and bobber. It uses <code>FTimeline</code> components driven by <code>UCurveFloat</code> assets to create smooth, data-driven animations for casting out (<code>Throw</code>) and reeling back (<code>ReelBack</code>) the bobber.</li><li><strong><code>AActor_Fish</code></strong>: Implements the <code>ICatchableInterface</code>. Each fish is an autonomous actor that wanders within its spawn area. It uses timelines to handle its movement when it is being reeled in or when it escapes.</li><li><strong><code>AActor_FishSpawnArea</code></strong>: This actor defines a volume (<code>UBoxComponent</code>) where fish can be spawned. It asynchronously loads the fish actor class using <code>UAssetManager</code> and then spawns a configured number of fish at random points within its bounds.</li></ul><h3 class=heading id=input-handling-1>Input Handling
<a class=anchor href=#input-handling-1>#</a></h3><p>I managed player input using Unreal Engine&rsquo;s Enhanced Input system.</p><ul><li><strong><code>APlayerController_StairwayFishingGamePlayerController</code></strong>: This class is responsible for setting up the input mapping context and binding to input actions. It defines a <code>CastingInputAction</code> which is bound to <code>Started</code>, <code>Triggered</code>, and <code>Completed</code> events.</li><li><strong>Delegates</strong>: Instead of directly handling logic, the Player Controller exposes delegates (<code>OnCastActionStarted</code>, <code>OnCastActionTriggered</code>, <code>OnCastActionCompleted</code>). Other systems, like the <code>UActorComponent_FishingComponent</code>, can bind to these delegates to receive input events. This decouples the input source from the gameplay logic.</li></ul><h3 class=heading id=editor-customization>Editor Customization
<a class=anchor href=#editor-customization>#</a></h3><p>To enhance the developer experience, I included an editor module, <code>FishingFeatureEditor</code>.</p><ul><li><strong><code>FDetailCustomization_FishingComponent</code></strong>: This class provides a custom details panel UI for the <code>FFishingComponentConfig</code> struct within the <code>UActorComponent_FishingComponent</code>. It replaces the default <code>FName</code> text fields for socket names (<code>FishingPoleSocketName</code>, <code>CarryFishSocketName</code>) with a dropdown combo box. This combo box is dynamically populated with all available bone and socket names from the <code>USkeletalMesh</code> assigned in the config, reducing errors from typos and making configuration faster.</li></ul><hr><h3 class=heading id=core-gameplay-classes>Core Gameplay Classes
<a class=anchor href=#core-gameplay-classes>#</a></h3><h4 class=heading id=related-pages-2>Related Pages
<a class=anchor href=#related-pages-2>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><blockquote><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h</a></li></ul></blockquote><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></li></ul></blockquote><h2 class=heading id=core-gameplay-classes-1>Core Gameplay Classes
<a class=anchor href=#core-gameplay-classes-1>#</a></h2><p>I built the core gameplay classes on the standard Unreal Engine gameplay framework. This system is composed of four main classes: <code>AGameModeBase_StairwayFishingGame</code>, <code>AGameStateBase_StairwayFishingGame</code>, <code>APlayerController_StairwayFishingGamePlayerController</code>, and <code>APawn_StairwayFishingGame</code>. Together, they manage the game&rsquo;s rules, state, player input, and the player&rsquo;s representation in the world.</p><p>I designed the architecture to be event-driven, primarily using the <code>VAGameplayMessagingSubsystem</code> to communicate state changes between classes. The <code>GameState</code> acts as the central authority for the current game loop state, while the <code>GameMode</code> observes these changes and orchestrates transitions, such as camera fades and view switching on the <code>Pawn</code>. The <code>PlayerController</code> is dedicated to handling raw player input via the Enhanced Input system and broadcasting it to interested listeners, like the <code>FishingComponent</code> on the Pawn.</p><h3 class=heading id=system-architecture-overview>System Architecture Overview
<a class=anchor href=#system-architecture-overview>#</a></h3><p>The following diagram illustrates the primary relationships and dependencies between the core gameplay classes.</p><pre class=mermaid>classDiagram
    direction TD
    class AGameModeBase {
        &lt;&lt;Unreal&gt;&gt;
    }
    class AGameStateBase {
        &lt;&lt;Unreal&gt;&gt;
    }
    class APlayerController {
        &lt;&lt;Unreal&gt;&gt;
    }
    class APawn {
        &lt;&lt;Unreal&gt;&gt;
    }
    class AGameModeBase_StairwayFishingGame
    class AGameStateBase_StairwayFishingGame
    class APlayerController_StairwayFishingGamePlayerController
    class APawn_StairwayFishingGame
    class IPlayerActionInputInterface {
        &lt;&lt;Interface&gt;&gt;
        +OnCastActionStarted() FOnPlayerActionInput&amp;
        +OnCastActionTriggered() FOnPlayerActionInput&amp;
        +OnCastActionCompleted() FOnPlayerActionInput&amp;
    }
    class ISwitchableFishingViewInterface {
        &lt;&lt;Interface&gt;&gt;
        +SetFishingView(FGameplayTag)
    }
    class UActorComponent_FishingComponent {
        &lt;&lt;Component&gt;&gt;
    }

    AGameModeBase &lt;|-- AGameModeBase_StairwayFishingGame
    AGameStateBase &lt;|-- AGameStateBase_StairwayFishingGame
    APlayerController &lt;|-- APlayerController_StairwayFishingGamePlayerController
    APawn &lt;|-- APawn_StairwayFishingGame

    APlayerController_StairwayFishingGamePlayerController --|&gt; IPlayerActionInputInterface
    APawn_StairwayFishingGame --|&gt; ISwitchableFishingViewInterface

    AGameModeBase_StairwayFishingGame ..&gt; AGameStateBase_StairwayFishingGame : &#34;Listens to&#34;
    AGameModeBase_StairwayFishingGame ..&gt; APawn_StairwayFishingGame : &#34;Calls SetFishingView on&#34;
    AGameModeBase_StairwayFishingGame ..&gt; APlayerController_StairwayFishingGamePlayerController : &#34;Toggles Input Mode&#34;
    
    APawn_StairwayFishingGame &#34;1&#34; *-- &#34;1&#34; UActorComponent_FishingComponent : &#34;Contains&#34;
    UActorComponent_FishingComponent ..&gt; APlayerController_StairwayFishingGamePlayerController : &#34;Binds to delegates&#34;
</pre><p>This diagram shows the inheritance from base Unreal classes and the key interactions. The <code>GameMode</code> listens to the <code>GameState</code> and directs the <code>Pawn</code> and <code>PlayerController</code> during state transitions. The <code>Pawn</code> implements the view-switching logic and contains the core <code>FishingComponent</code>, which in turn binds to input delegates from the <code>PlayerController</code>.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></p><h3 class=heading id=agamestatebase_stairwayfishinggame><code>AGameStateBase_StairwayFishingGame</code>
<a class=anchor href=#agamestatebase_stairwayfishinggame>#</a></h3><p>The <code>AGameStateBase_StairwayFishingGame</code> class is the authority on the current state of the game loop. Its primary role is to hold and manage the <code>CurrentFishingGameLoopState</code> as an <code>FGameplayTag</code>.</p><h4 class=heading id=state-management-1>State Management
<a class=anchor href=#state-management-1>#</a></h4><p>The game state listens for messages on the <code>Messaging_GameState_StateChange</code> channel. When a message containing a new <code>FGameplayTag</code> is received, it updates its internal state and broadcasts the change via the <code>OnFishingGameLoopStateChanged</code> delegate. This decoupling allows any system to request a state change without needing a direct reference to the <code>GameState</code> or its observers.</p><p>In <code>BeginPlay</code>, it sets up an asynchronous listener for the state change message channel.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> AGameStateBase_StairwayFishingGame<span style=color:#ff79c6>::</span>BeginPlay()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	Super<span style=color:#ff79c6>::</span>BeginPlay();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	GameStateChangeMessageListenerAsync <span style=color:#ff79c6>=</span> UVAGameplayMessaging_ListenForGameplayMessages<span style=color:#ff79c6>::</span>ListenForGameplayMessagesViaChannel(<span style=color:#ff79c6>this</span>, FFishingTags<span style=color:#ff79c6>::</span>Get().Messaging_GameState_StateChange);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	GameStateChangeMessageListenerAsync<span style=color:#ff79c6>-&gt;</span>OnGameplayMessageReceived.AddUniqueDynamic(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>		<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnGameStateChangeMessageReceived);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	GameStateChangeMessageListenerAsync<span style=color:#ff79c6>-&gt;</span>Activate();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span></code></pre></div><p>When a message is received, <code>OnGameStateChangeMessageReceived</code> validates the payload and calls <code>SetCurrentFishingGameLoopState</code>, which triggers the broadcast.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/GameStateBase/GameStateBase_StairwayFishingGame.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</a></p><h3 class=heading id=agamemodebase_stairwayfishinggame><code>AGameModeBase_StairwayFishingGame</code>
<a class=anchor href=#agamemodebase_stairwayfishinggame>#</a></h3><p>The <code>AGameModeBase_StairwayFishingGame</code> orchestrates high-level game flow based on state changes from the <code>AGameStateBase</code>. It is responsible for managing visual transitions and player input modes.</p><h4 class=heading id=responding-to-state-changes>Responding to State Changes
<a class=anchor href=#responding-to-state-changes>#</a></h4><p>Upon <code>BeginPlay</code>, the <code>GameMode</code> finds the <code>GameState</code> and binds its <code>OnFishingGameLoopStateChanged</code> method to the <code>GameState</code>&rsquo;s delegate. When this event fires, the <code>GameMode</code> executes a series of actions to transition the game smoothly.</p><p>The core transition logic involves:</p><ol><li>Determining if the new state is for fishing (<code>FishingGameLoopState_Fishing</code>) or not.</li><li>Toggling the <code>PlayerController</code>&rsquo;s input mode between <code>FInputModeGameOnly</code> and <code>FInputModeUIOnly</code>, and showing/hiding the mouse cursor accordingly.</li><li>Triggering a screen fade-out, switching the camera view on the possessed <code>Pawn</code>, and then fading back in.</li></ol><p>This entire sequence is initiated within <code>OnFishingGameLoopStateChanged</code>.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></p><h4 class=heading id=state-transition-flow>State Transition Flow
<a class=anchor href=#state-transition-flow>#</a></h4><p>The following diagram illustrates the sequence of events when the game state changes.</p><pre class=mermaid>sequenceDiagram
    participant System as External System
    participant Messaging as VAGameplayMessagingSubsystem
    participant GameState as AGameStateBase_StairwayFishingGame
    participant GameMode as AGameModeBase_StairwayFishingGame
    participant PC as APlayerController
    participant Pawn as APawn_StairwayFishingGame

    System-&gt;&gt;Messaging: BroadcastMessage(&#39;Messaging.GameState.StateChange&#39;, NewStateTag)
    Messaging-&gt;&gt;GameState: OnGameStateChangeMessageReceived(NewStateTag)
    GameState-&gt;&gt;GameState: SetCurrentFishingGameLoopState(NewStateTag)
    GameState--&gt;&gt;GameState: Broadcast(OnFishingGameLoopStateChanged)
    
    Note over GameState, GameMode: GameMode has previously bound to this delegate.
    
    GameState-&gt;&gt;GameMode: OnFishingGameLoopStateChanged(NewStateTag)
    GameMode-&gt;&gt;PC: TogglePlayerControllerMode()
    PC-&gt;&gt;PC: SetInputMode()
    PC-&gt;&gt;PC: SetShowMouseCursor()
    
    GameMode-&gt;&gt;GameMode: TriggerScreenFadeInOut()
    Note right of GameMode: Starts a camera fade-out.
    
    loop After Fade-In Delay
        GameMode-&gt;&gt;Pawn: SetFishingView(NewStateTag)
        Pawn-&gt;&gt;Pawn: SetActive(Camera)
        Pawn-&gt;&gt;Pawn: SetActive(ShowFishCamera)
        
        GameMode-&gt;&gt;Messaging: BroadcastMessage(&#39;Messaging.GameMode.StateChange.Finish&#39;)
        Note right of GameMode: Starts a camera fade-in.
    end
</pre><p>This flow demonstrates the decoupled communication. An external system sends a message, the <code>GameState</code> updates and broadcasts, and the <code>GameMode</code> reacts by coordinating the <code>PlayerController</code> and <code>Pawn</code> to reflect the new state.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></p><h3 class=heading id=aplayercontroller_stairwayfishinggameplayercontroller><code>APlayerController_StairwayFishingGamePlayerController</code>
<a class=anchor href=#aplayercontroller_stairwayfishinggameplayercontroller>#</a></h3><p>This class is responsible for translating player hardware input into gameplay actions using Unreal&rsquo;s Enhanced Input system. It implements the <code>IPlayerActionInputInterface</code> to expose delegates that other systems can bind to.</p><h3 class=heading id=input-handling-2>Input Handling
<a class=anchor href=#input-handling-2>#</a></h3><p>Key properties for input are defined in the header:</p><div class=table-outer><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>DefaultInputMappingContext</code></td><td><code>UInputMappingContext*</code></td><td>The mapping context that links keys to input actions.</td></tr><tr><td><code>CastingInputAction</code></td><td><code>UInputAction*</code></td><td>The input action for the primary fishing cast.</td></tr></tbody></table></div><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a></p><p>In <code>BeginPlay</code>, the controller maps the <code>DefaultInputMappingContext</code>. The <code>MapInputActions</code> function then binds controller methods (<code>OnCastStarted</code>, <code>OnCastTriggered</code>, <code>OnCastFinished</code>) to the different trigger events of the <code>CastingInputAction</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> APlayerController_StairwayFishingGamePlayerController<span style=color:#ff79c6>::</span>MapInputActions()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#6272a4>// ... error checking ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Started, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastStarted);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Triggered, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastTriggered);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Completed, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastFinished);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>}
</span></span></code></pre></div><p>These handler functions then broadcast their respective delegates, passing the elapsed time of the input action as a parameter. This allows listeners, such as the <code>UActorComponent_FishingComponent</code>, to react to the input without being tightly coupled to the <code>PlayerController</code>.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></p><h3 class=heading id=apawn_stairwayfishinggame><code>APawn_StairwayFishingGame</code>
<a class=anchor href=#apawn_stairwayfishinggame>#</a></h3><p>This class represents the player character in the game world. Since no player movement is required, it inherits from <code>APawn</code> instead of <code>ACharacter</code>. It contains all the necessary visual and logical components for the fishing gameplay.</p><h4 class=heading id=components>Components
<a class=anchor href=#components>#</a></h4><p>The Pawn is an aggregate of several components that provide its functionality:</p><div class=table-outer><table><thead><tr><th>Component</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>Capsule</code></td><td><code>UCapsuleComponent*</code></td><td>The root component, providing collision.</td></tr><tr><td><code>Mesh</code></td><td><code>USkeletalMeshComponent*</code></td><td>The visual representation of the player character.</td></tr><tr><td><code>SpringArm</code></td><td><code>USpringArmComponent*</code></td><td>Positions the main camera at a distance from the pawn.</td></tr><tr><td><code>Camera</code></td><td><code>UCameraComponent*</code></td><td>The main top-down gameplay camera. Active by default.</td></tr><tr><td><code>CastMeterBarWidget</code></td><td><code>UWidgetComponent*</code></td><td>A UI widget component for displaying the cast meter.</td></tr><tr><td><code>FishingComponent</code></td><td><code>UActorComponent_FishingComponent*</code></td><td>The core component that contains all fishing logic.</td></tr><tr><td><code>ShowFishCamera</code></td><td><code>UCameraComponent*</code></td><td>A secondary camera used for showing the caught fish. Inactive by default.</td></tr></tbody></table></div><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a></p><h4 class=heading id=view-switching>View Switching
<a class=anchor href=#view-switching>#</a></h4><p>The Pawn implements the <code>ISwitchableFishingViewInterface</code>, which requires it to define the <code>SetFishingView</code> method. This function is called by the <code>GameMode</code> during a state transition. It activates or deactivates the <code>Camera</code> and <code>ShowFishCamera</code> based on whether the new game state tag matches <code>FishingGameLoopState_Fishing</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> APawn_StairwayFishingGame<span style=color:#ff79c6>::</span>SetFishingView(<span style=color:#ff79c6>const</span> FGameplayTag<span style=color:#ff79c6>&amp;</span> InFishingGameLoopStateTag)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#6272a4>// ... validation ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>bool</span> bShouldFish <span style=color:#ff79c6>=</span> InFishingGameLoopStateTag.MatchesTag(FFishingTags<span style=color:#ff79c6>::</span>Get().FishingGameLoopState_Fishing);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#ff79c6>if</span> (Camera)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>		Camera<span style=color:#ff79c6>-&gt;</span>SetActive(bShouldFish);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#ff79c6>if</span> (ShowFishCamera)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		ShowFishCamera<span style=color:#ff79c6>-&gt;</span>SetActive(<span style=color:#ff79c6>!</span>bShouldFish);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}
</span></span></code></pre></div><p>This simple mechanism allows the <code>GameMode</code> to control the player&rsquo;s perspective without needing to know the specific implementation details of the Pawn&rsquo;s cameras.</p><p>Sources: <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a>, <a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></p><h3 class=heading id=summary>Summary
<a class=anchor href=#summary>#</a></h3><p>I created the core gameplay classes to form a solid foundation using standard Unreal Engine patterns. The <code>GameState</code> serves as a single source of truth for the game loop state, while the <code>GameMode</code> acts as a director, orchestrating transitions. I handled player interaction cleanly via the <code>PlayerController</code> and its delegate system, which provides input to the <code>FishingComponent</code> on the <code>Pawn</code>. This separation of concerns ensures that each class has a distinct responsibility, making the system easier to maintain and expand.</p><hr><h3 class=heading id=messaging-system-vagameplaymessaging>Messaging System (VAGameplayMessaging)
<a class=anchor href=#messaging-system-vagameplaymessaging>#</a></h3><h4 class=heading id=related-pages-3>Related Pages
<a class=anchor href=#related-pages-3>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Public/GameInstanceSubsystem/VAGameplayMessagingSubsystem.h>Source/VAGameplayMessaging/Public/GameInstanceSubsystem/VAGameplayMessagingSubsystem.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp>Source/VAGameplayMessaging/Private/GameInstanceSubsystem/VAGameplayMessagingSubsystem.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Public/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.h>Source/VAGameplayMessaging/Public/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/VAGameplayMessaging/Private/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.cpp>Source/VAGameplayMessaging/Private/VACancellableAsyncAction/VAGameplayMessaging_ListenForGameplayMessages.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Public/FishingTags.h>Source/FishingGameplayTags/Public/FishingTags.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameStateBase/GameStateBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp>Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp</a></li></ul></blockquote><h2 class=heading id=messaging-system-vagameplaymessaging-1>Messaging System (VAGameplayMessaging)
<a class=anchor href=#messaging-system-vagameplaymessaging-1>#</a></h2><p>I used the VAGameplayMessaging system to provide a decoupled communication framework for different parts of the application. I leveraged a centralized <code>UGameInstanceSubsystem</code> to manage message channels identified by <code>FGameplayTag</code>. This allows various game features, UI elements, and animation instances to communicate without holding direct references to each other, promoting modularity and reducing dependencies.</p><p>Messages are broadcast on specific channels, and any object can listen to one or more channels using a cancellable asynchronous action. I ensured the system supports flexible data transfer through the <code>FVAAnyUnreal</code> struct, which can encapsulate any USTRUCT, UObject, or primitive type as a message payload.</p><h3 class=heading id=core-architecture>Core Architecture
<a class=anchor href=#core-architecture>#</a></h3><p>I built the system around a central hub, <code>UVAGameplayMessagingSubsystem</code>, which is a <code>UGameInstanceSubsystem</code>. This ensures it has a global scope and persists for the entire game session. The subsystem&rsquo;s primary responsibility is to maintain a map of message channels and their corresponding listeners.</p><ul><li><strong><code>UVAGameplayMessagingSubsystem</code></strong>: The central singleton that manages all message channels and listeners.</li><li><strong><code>ChannelToMembersMap</code></strong>: A <code>TMap&lt;FGameplayTag, FChannelMembersData></code> within the subsystem. It maps a gameplay tag (the channel) to a struct containing an array of active listeners.</li><li><strong><code>UVAGameplayMessaging_ListenForGameplayMessages</code></strong>: A <code>UVACancellableAsyncAction</code> that acts as a proxy for any object wanting to listen to messages. It handles its own registration and unregistration with the subsystem.</li></ul><h4 class=heading id=component-relationships>Component Relationships
<a class=anchor href=#component-relationships>#</a></h4><p>The following diagram illustrates the relationship between the core components of the messaging system.</p><pre class=mermaid>classDiagram
    direction TD
    class UVAGameplayMessagingSubsystem {
        -TMap&lt;FGameplayTag, FChannelMembersData&gt; ChannelToMembersMap
        +Get(UObject*) UVAGameplayMessagingSubsystem&amp;
        +BroadcastMessage(UObject*, FGameplayTag, FVAAnyUnreal) bool
        +RegisterNewMember(FGameplayTagContainer, UVAGameplayMessaging_ListenForGameplayMessages*) bool
        +UnregisterMember(UVAGameplayMessaging_ListenForGameplayMessages*) void
    }
    class FChannelMembersData {
        -TArray&lt;UVAGameplayMessaging_ListenForGameplayMessages*&gt; ChannelMembers
        +AddMembership(UVAGameplayMessaging_ListenForGameplayMessages*) void
        +RemoveMembership(UVAGameplayMessaging_ListenForGameplayMessages*) void
    }
    class UVAGameplayMessaging_ListenForGameplayMessages {
        -FGameplayTagContainer ChannelsToRegister
        +FAsyncGameplayMessageSignature OnGameplayMessageReceived
        +ListenForGameplayMessagesViaChannel(UObject*, FGameplayTag) UVAGameplayMessaging_ListenForGameplayMessages*
        +Activate() void
        +SetReadyToDestroy() void
    }

    UVAGameplayMessagingSubsystem &#34;1&#34; *-- &#34;*&#34; FChannelMembersData : Manages
    FChannelMembersData &#34;1&#34; *-- &#34;*&#34; UVAGameplayMessaging_ListenForGameplayMessages : Contains
</pre><p>This diagram shows that the <code>UVAGameplayMessagingSubsystem</code> contains a map of <code>FChannelMembersData</code>, and each <code>FChannelMembersData</code> instance holds a list of <code>UVAGameplayMessaging_ListenForGameplayMessages</code> listeners.</p><h3 class=heading id=broadcasting-messages>Broadcasting Messages
<a class=anchor href=#broadcasting-messages>#</a></h3><p>Messages are sent using the static function <code>UVAGameplayMessagingSubsystem::BroadcastMessage</code>. This function retrieves the subsystem instance and calls an internal method to perform the broadcast.</p><p>The internal broadcast process is as follows:</p><ol><li>Validate the <code>InChannel</code> <code>FGameplayTag</code>.</li><li>Check if the channel exists in the <code>ChannelToMembersMap</code>.</li><li>Retrieve the list of listeners (<code>UVAGameplayMessaging_ListenForGameplayMessages*</code>) for that channel.</li><li>Iterate through each listener, checking if it is valid.</li><li>If a listener is invalid, it is removed from the channel&rsquo;s member list.</li><li>For each valid listener, its <code>OnGameplayMessageReceived</code> delegate is broadcast, passing the channel tag and the message payload.</li></ol><h4 class=heading id=broadcast-flow-diagram>Broadcast Flow Diagram
<a class=anchor href=#broadcast-flow-diagram>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Broadcaster as Game Logic&lt;br&gt;(e.g., FishingComponent)
    participant Subsystem as UVAGameplayMessagingSubsystem
    participant Listener as UVAGameplayMessaging_ListenForGameplayMessages
    participant Receiver as Subscribed Object&lt;br&gt;(e.g., UI Widget)

    Broadcaster-&gt;&gt;Subsystem: BroadcastMessage(Channel, Payload)
    Note over Subsystem: Get subsystem instance
    Subsystem-&gt;&gt;Subsystem: BroadcastMessage_Internal(Channel, Payload)
    Subsystem-&gt;&gt;Subsystem: Find listeners for Channel in ChannelToMembersMap
    loop For each Listener
        Subsystem-&gt;&gt;Listener: Broadcast(OnGameplayMessageReceived)
        Listener-&gt;&gt;Receiver: Execute delegate binding
    end
</pre><p>This sequence shows a game object broadcasting a message, the subsystem finding and notifying the relevant listener, which in turn executes the delegate bound by the final receiving object.</p><h3 class=heading id=listening-for-messages>Listening for Messages
<a class=anchor href=#listening-for-messages>#</a></h3><p>Objects subscribe to message channels by creating an instance of <code>UVAGameplayMessaging_ListenForGameplayMessages</code>. This is typically done via one of its static factory functions, which are designed for use in both C++ and Blueprints.</p><ol><li><strong>Creation</strong>: An object calls <code>ListenForGameplayMessagesViaChannel</code> or <code>ListenForGameplayMessagesViaMultipleChannels</code>. This creates a new proxy object (the listener).</li><li><strong>Activation</strong>: The listener&rsquo;s <code>Activate()</code> method is called.</li><li><strong>Registration</strong>: Inside <code>Activate()</code>, the listener calls <code>Subsystem->RegisterNewMember()</code>, passing a reference to itself and the channels it wants to subscribe to.</li><li><strong>Storage</strong>: The subsystem adds the listener to the <code>ChannelToMembersMap</code> for each requested channel. If a channel does not exist, it is created.</li></ol><p>The listener&rsquo;s <code>OnGameplayMessageReceived</code> delegate should be bound to a function in the subscribing object before activation to handle incoming messages.</p><h4 class=heading id=listener-registration-and-cancellation-flow>Listener Registration and Cancellation Flow
<a class=anchor href=#listener-registration-and-cancellation-flow>#</a></h4><pre class=mermaid>sequenceDiagram
    participant Subscriber as Game Logic&lt;br&gt;(e.g., GameState)
    participant Listener as UVAGameplayMessaging_ListenForGameplayMessages
    participant Subsystem as UVAGameplayMessagingSubsystem

    Subscriber-&gt;&gt;Listener: ListenForGameplayMessagesViaChannel(this, Channel)
    Note right of Subscriber: Binds to OnGameplayMessageReceived delegate
    Subscriber-&gt;&gt;Listener: Activate()
    Listener-&gt;&gt;Subsystem: RegisterNewMember(Channels, this)
    Note over Subsystem: Adds listener to&lt;br&gt;ChannelToMembersMap
    Subsystem--&gt;&gt;Listener: return true
    
    Note over Subscriber, Subsystem: ...Time passes, messages are received...

    Subscriber-&gt;&gt;Listener: Cancel() / SetReadyToDestroy()
    Listener-&gt;&gt;Subsystem: UnregisterMember(this)
    Note over Subsystem: Removes listener from&lt;br&gt;all channels
</pre><p>This diagram illustrates the lifecycle of a listener, from its creation and registration with the subsystem to its eventual cancellation and unregistration.</p><h3 class=heading id=message-structure>Message Structure
<a class=anchor href=#message-structure>#</a></h3><h4 class=heading id=channels-fgameplaytag>Channels (<code>FGameplayTag</code>)
<a class=anchor href=#channels-fgameplaytag>#</a></h4><p>Communication channels are defined by <code>FGameplayTag</code>. This leverages Unreal Engine&rsquo;s hierarchical tagging system, allowing for organized and easily identifiable message streams. A central class, <code>FFishingTags</code>, defines all the native gameplay tags used by the fishing feature, ensuring consistency.</p><p>Example channels:</p><ul><li><code>Messaging.Fishing.UI.Cast.Update</code>: Used to update the UI with the current casting progress.</li><li><code>Messaging.Fishing.Notify.Throw</code>: An animation notify that triggers the fishing rod to throw the bobber.</li><li><code>Messaging.GameState.StateChange</code>: Used to request a change in the global game state.</li></ul><h4 class=heading id=payloads-fvaanyunreal>Payloads (<code>FVAAnyUnreal</code>)
<a class=anchor href=#payloads-fvaanyunreal>#</a></h4><p>The system uses the <code>FVAAnyUnreal</code> struct for message payloads. This is a wrapper that can hold a value of almost any Unreal type, including primitives (<code>float</code>, <code>int32</code>), USTRUCTs, and UObjects. The receiving end can then safely check the type of the payload before attempting to extract the value.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Example of a broadcaster sending a float payload
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span>UVAGameplayMessagingSubsystem<span style=color:#ff79c6>::</span>Get(<span style=color:#ff79c6>this</span>).BroadcastMessage(<span style=color:#ff79c6>this</span>, FFishingTags<span style=color:#ff79c6>::</span>Get().Messaging_Fishing_UI_Cast_Update, InProgress);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>// Example of a receiver handling the float payload
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4>// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>bool</span> bPayloadIsFloat <span style=color:#ff79c6>=</span> MessagePayload.Is<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>float</span><span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>bPayloadIsFloat)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#6272a4>// ... log error
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> Progress <span style=color:#ff79c6>=</span> MessagePayload.Get<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>float</span><span style=color:#ff79c6>&gt;</span>();
</span></span></code></pre></div><p>This provides type safety at runtime and avoids the need for multiple broadcast functions with different signatures.</p><h3 class=heading id=lifecycle-management>Lifecycle Management
<a class=anchor href=#lifecycle-management>#</a></h3><p>The lifecycle of listeners is managed primarily by the <code>UVACancellableAsyncAction</code> base class.</p><ul><li><strong>Registration</strong>: When <code>Activate()</code> is called on a <code>UVAGameplayMessaging_ListenForGameplayMessages</code> instance, it registers itself with the subsystem.</li><li><strong>Unregistration</strong>: When the async action is cancelled (e.g., via a <code>Cancel()</code> call or the owning object being destroyed), its <code>SetReadyToDestroy()</code> method is invoked. This method calls <code>Subsystem->UnregisterMember(this)</code>, which iterates through the entire <code>ChannelToMembersMap</code> and removes the listener from any channel it was a part of.</li><li><strong>Cleanup</strong>: The <code>UVAGameplayMessagingSubsystem</code> itself, upon <code>Deinitialize()</code>, clears its <code>ChannelToMembersMap</code> entirely, ensuring no dangling references remain.</li></ul><h3 class=heading id=key-components-summary>Key Components Summary
<a class=anchor href=#key-components-summary>#</a></h3><div class=table-outer><table><thead><tr><th>Component</th><th>Type</th><th>Role</th><th>Source File</th></tr></thead><tbody><tr><td><code>UVAGameplayMessagingSubsystem</code></td><td><code>UGameInstanceSubsystem</code></td><td>Central hub for message routing. Manages channels and listeners.</td><td><code>VAGameplayMessagingSubsystem.h</code></td></tr><tr><td><code>UVAGameplayMessaging_ListenForGameplayMessages</code></td><td><code>UVACancellableAsyncAction</code></td><td>Client-side proxy for subscribing to channels. Manages its own lifecycle.</td><td><code>VAGameplayMessaging_ListenForGameplayMessages.h</code></td></tr><tr><td><code>FChannelMembersData</code></td><td><code>USTRUCT</code></td><td>A container struct holding an array of listeners for a single channel.</td><td><code>VAGameplayMessagingSubsystem.h</code></td></tr><tr><td><code>FGameplayTag</code></td><td><code>struct</code></td><td>Used to define unique message channels.</td><td><code>FishingTags.h</code></td></tr><tr><td><code>FVAAnyUnreal</code></td><td><code>struct</code></td><td>A type-safe wrapper for message payloads of any type.</td><td><code>VAGameplayMessagingSubsystem.h</code></td></tr></tbody></table></div><h3 class=heading id=conclusion-1>Conclusion
<a class=anchor href=#conclusion-1>#</a></h3><p>The VAGameplayMessaging system is a data-driven framework that enables decoupled communication between different gameplay systems. By leveraging <code>UGameInstanceSubsystem</code> for global access, <code>FGameplayTag</code> for channel definition, and <code>UVACancellableAsyncAction</code> for lifecycle-aware listeners, I provided a clean and scalable solution for event handling within the project. Its use of <code>FVAAnyUnreal</code> for payloads adds a layer of type-safe flexibility, making it adaptable to a wide variety of communication needs.</p><hr><h3 class=heading id=fishing-gameplay-loop>Fishing Gameplay Loop
<a class=anchor href=#fishing-gameplay-loop>#</a></h3><h4 class=heading id=related-pages-4>Related Pages
<a class=anchor href=#related-pages-4>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><p>The following files were used as context for generating this wiki page:</p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingGameplayTags/Private/FishingTags.cpp>Source/FishingGameplayTags/Private/FishingTags.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/Pawn/Pawn_StairwayFishingGame.cpp</a></li></ul></blockquote><h2 class=heading id=fishing-gameplay-loop-1>Fishing Gameplay Loop
<a class=anchor href=#fishing-gameplay-loop-1>#</a></h2><p>I implemented the Fishing Gameplay Loop as a self-contained feature that manages all logic related to casting a fishing rod, waiting for a fish to bite, and reeling it in. I orchestrated the system via the <code>UActorComponent_FishingComponent</code>, which acts as a state machine and mediator between the player, the fishing rod, and the fish.</p><p>The feature is heavily reliant on a state management system using Gameplay Tags and communicates between different objects asynchronously via the <code>VAGameplayMessagingSubsystem</code>. This decoupled architecture allows me to clearly separate concerns between player input, animation, game logic, and actor behaviors. I made the entire process configurable through Data Assets, allowing designers to tweak parameters like casting distance, wait times, and actor classes without changing code.</p><h3 class=heading id=core-components-1>Core Components
<a class=anchor href=#core-components-1>#</a></h3><p>The system is composed of several key actors and components that work together to create the fishing experience.</p><div class=table-outer><table><thead><tr><th>Component/Actor</th><th>Role</th><th>Source File</th></tr></thead><tbody><tr><td><code>UActorComponent_FishingComponent</code></td><td>The central orchestrator of the fishing logic. Manages states, timers, player input, and communication between other components.</td><td><code>ActorComponent_FishingComponent.h</code></td></tr><tr><td><code>AActor_FishingRod</code></td><td>Represents the physical fishing rod and bobber. Implements the <code>ICatcherInterface</code> and handles the visual throwing and reeling of the line.</td><td><code>Actor_FishingRod.cpp</code></td></tr><tr><td><code>AActor_Fish</code></td><td>Represents a catchable fish. Implements the <code>ICatchableInterface</code> and manages its own movement, including wandering, being reeled in, and escaping.</td><td><code>Actor_Fish.cpp</code></td></tr><tr><td><code>AActor_FishSpawnArea</code></td><td>Spawns a configurable number of <code>AActor_Fish</code> instances within a defined <code>UBoxComponent</code> volume at the start of the game.</td><td><code>Actor_FishSpawnArea.cpp</code></td></tr><tr><td><code>AGameModeBase_StairwayFishingGame</code></td><td>Manages high-level game state transitions, such as fading the screen and switching cameras when a fish is caught and displayed.</td><td><code>GameModeBase_StairwayFishingGame.cpp</code></td></tr><tr><td><code>APawn_StairwayFishingGame</code></td><td>The player&rsquo;s pawn which owns the <code>UActorComponent_FishingComponent</code> and holds the different cameras used for gameplay and showing the catch.</td><td><code>Pawn_StairwayFishingGame.cpp</code></td></tr></tbody></table></div><h4 class=heading id=component-relationships-1>Component Relationships
<a class=anchor href=#component-relationships-1>#</a></h4><p>The following diagram illustrates the primary relationships between the core classes. The <code>FishingComponent</code> acts as a central hub, interacting with the rod (<code>ICatcherInterface</code>) and the fish (<code>ICatchableInterface</code>).</p><pre class=mermaid>classDiagram
    direction TD
    class UActorComponent
    class AActor
    class UActorComponent_FishingComponent
    class AActor_FishingRod
    class AActor_Fish
    class IMockableFishingInterface {
        &lt;&lt;Interface&gt;&gt;
    }
    class ICatcherInterface {
        &lt;&lt;Interface&gt;&gt;
        Throw(FVector)
        ReelBack()
    }
    class ICatchableInterface {
        &lt;&lt;Interface&gt;&gt;
        ReeledIn(FVector)
        Escape()
        Catch(USceneComponent*)
    }

    UActorComponent &lt;|-- UActorComponent_FishingComponent
    AActor &lt;|-- AActor_FishingRod
    AActor &lt;|-- AActor_Fish

    UActorComponent_FishingComponent --|&gt; IMockableFishingInterface
    AActor_FishingRod --|&gt; ICatcherInterface
    AActor_Fish --|&gt; ICatchableInterface

    UActorComponent_FishingComponent &#34;1&#34; --&gt; &#34;1&#34; ICatcherInterface : CurrentCatcher
    UActorComponent_FishingComponent &#34;1&#34; --&gt; &#34;1&#34; ICatchableInterface : CurrentCatchable
</pre><h3 class=heading id=state-management-with-gameplay-tags>State Management with Gameplay Tags
<a class=anchor href=#state-management-with-gameplay-tags>#</a></h3><p>I drove the fishing loop with a state machine implemented within <code>UActorComponent_FishingComponent</code>. The current state is tracked using a <code>FGameplayTag</code>, which dictates how the component responds to player input and game events. All tags are centrally defined in the <code>FFishingTags</code> class.</p><h4 class=heading id=fishing-component-states>Fishing Component States
<a class=anchor href=#fishing-component-states>#</a></h4><p>The <code>FishingComponent.State.*</code> tags define the current stage of the fishing process.</p><div class=table-outer><table><thead><tr><th>Tag</th><th>Description</th></tr></thead><tbody><tr><td><code>FishingComponent.State.Idling</code></td><td>The default state. The player can start casting.</td></tr><tr><td><code>FishingComponent.State.Throwing</code></td><td>The player has finished charging the cast and the rod is being thrown. Input is ignored.</td></tr><tr><td><code>FishingComponent.State.WaitingForFish</code></td><td>The bobber is in the water. A timer is active, waiting for a fish to bite. Early input will cause the fish to escape.</td></tr><tr><td><code>FishingComponent.State.AbleToReel</code></td><td>The fish has bitten. The player must press the action button to reel it in.</td></tr><tr><td><code>FishingComponent.State.Reeling_In</code></td><td>The fish has been caught and is being reeled back to the player.</td></tr><tr><td><code>FishingComponent.State.Reeling_Out</code></td><td>The rod is being reeled back after a failed attempt or the fish escaped.</td></tr></tbody></table></div><h4 class=heading id=animation-states>Animation States
<a class=anchor href=#animation-states>#</a></h4><p>A parallel set of tags, <code>AnimInstance.Fishing.State.*</code>, is used to drive the character&rsquo;s animations. These are broadcast via the messaging system to the character&rsquo;s Animation Blueprint.</p><div class=table-outer><table><thead><tr><th>Tag</th><th>Description</th></tr></thead><tbody><tr><td><code>AnimInstance.Fishing.State.Idling</code></td><td>Corresponds to the idle animation state.</td></tr><tr><td><code>AnimInstance.Fishing.State.Throwing</code></td><td>Triggers the casting/throwing animation montage.</td></tr><tr><td><code>AnimInstance.Fishing.State.Reeling_In</code></td><td>Triggers the animation for successfully reeling in a fish.</td></tr><tr><td><code>AnimInstance.Fishing.State.Reeling_Out</code></td><td>Triggers the animation for reeling in an empty line.</td></tr><tr><td><code>AnimInstance.Fishing.State.ShowFish</code></td><td>Triggers the animation for showing off the caught fish.</td></tr></tbody></table></div><h4 class=heading id=state-machine-flow>State Machine Flow
<a class=anchor href=#state-machine-flow>#</a></h4><p>The diagram below shows the typical flow of states within the <code>UActorComponent_FishingComponent</code>.</p><pre class=mermaid>graph TD
    subgraph Fishing State Machine
        A[Idling] --&gt;|Hold Cast Action| B(Casting Preview)
        B --&gt;|Release Cast Action| C(Throwing)
        C --&gt;|Bobber Lands| D(WaitingForFish)
        D --&gt;|Timer Finishes| E(AbleToReel)
        D --&gt;|Early Input| F(Reeling_Out)
        E --&gt;|Cast Action| G(Reeling_In)
        F --&gt;|Reel Finished| A
        G --&gt;|Reel Finished| H(Show Fish State)
    end
</pre><h3 class=heading id=the-fishing-process-step-by-step>The Fishing Process Step-by-Step
<a class=anchor href=#the-fishing-process-step-by-step>#</a></h3><p>The entire fishing sequence, from casting to catching, follows a well-defined series of events orchestrated by the <code>FishingComponent</code>.</p><h4 class=heading id=1-initialization-and-spawning>1. Initialization and Spawning
<a class=anchor href=#1-initialization-and-spawning>#</a></h4><ul><li><strong>Fish Spawning</strong>: On <code>BeginPlay</code>, the <code>AActor_FishSpawnArea</code> asynchronously loads the <code>FishActorClass</code> defined in its config. Once loaded, it spawns a specified number of fish actors at random locations within its <code>UBoxComponent</code> bounds. Each fish is initialized with the spawn area&rsquo;s center and extent, which it uses for its wandering behavior.</li><li><strong>Rod Spawning</strong>: The <code>UActorComponent_FishingComponent</code> also asynchronously loads its <code>FishingRodActorClass</code>. When loaded, the fishing rod actor is spawned and attached to a specified socket on the owner&rsquo;s skeletal mesh.</li></ul><h4 class=heading id=2-casting-the-line>2. Casting the Line
<a class=anchor href=#2-casting-the-line>#</a></h4><ul><li><strong>Charging the Cast</strong>: The player presses and holds the cast action button. This calls <code>OnCastAction</code> in the <code>FishingComponent</code>.</li><li><strong>Determining Location</strong>: While the button is held, <code>DetermineCastLocation</code> is called continuously. It maps the elapsed time the button has been held to a distance between a minimum and maximum value. This determines the cast&rsquo;s target position in front of the player.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> MappedForwardDistance <span style=color:#ff79c6>=</span> FMath<span style=color:#ff79c6>::</span>GetMappedRangeValueClamped(FVector2D(<span style=color:#bd93f9>0.f</span>, MaximumTimeToCast), FVector2D(MinimumCastDistance, MaximumCastDistance), InElapsedTime);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>const</span> FVector ForwardDirection <span style=color:#ff79c6>=</span> InitialActorForwardVector <span style=color:#ff79c6>*</span> MappedForwardDistance;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#ff79c6>const</span> FVector CastStartPosition <span style=color:#ff79c6>=</span> InitialActorLocation <span style=color:#ff79c6>+</span> ForwardDirection;
</span></span></code></pre></div></li><li><strong>Finding the Water</strong>: <code>AttemptToCast</code> then performs a line trace downwards from the target position to find a water body (identified by the <code>TRACE_WATER_BODY</code> collision channel). If water is found, the hit location is stored as <code>CastLocation</code>, and a decal actor is made visible at that spot to give the player feedback.</li></ul><h4 class=heading id=3-throwing-and-waiting>3. Throwing and Waiting
<a class=anchor href=#3-throwing-and-waiting>#</a></h4><ul><li><strong>Throwing</strong>: When the player releases the cast button, <code>OnCastActionEnded</code> is called. The component&rsquo;s state changes to <code>Throwing</code>, and it broadcasts a message to the animation system to play the &ldquo;throwing&rdquo; animation.</li><li><strong>Animation Notify</strong>: The throwing animation contains a notify that sends a <code>Messaging.Fishing.Notify.Throw</code> message. The <code>FishingComponent</code> listens for this message and, upon receiving it, calls the <code>Throw()</code> method on the <code>CurrentCatcher</code> (the fishing rod).</li><li><strong>Bobber Movement</strong>: <code>AActor_FishingRod::Throw</code> starts a timeline (<code>ThrowReelInTimeline</code>) that interpolates the bobber&rsquo;s position from the rod to the <code>CastLocation</code>.</li><li><strong>Landing on Water</strong>: When the timeline finishes, a delegate is executed, calling <code>OnBobberLandsOnWater</code> in the <code>FishingComponent</code>.</li><li><strong>Finding a Fish</strong>: The component then performs a sphere trace around the <code>CastLocation</code> to find the nearest <code>ICatchableInterface</code> (a fish).</li><li><strong>Waiting Period</strong>: A timer is started for a duration defined by <code>TimeToFish</code> in the config, and the state changes to <code>WaitingForFish</code>. The targeted fish is notified via its <code>ReeledIn()</code> method, causing it to swim towards the bobber.</li></ul><h4 class=heading id=4-reeling-in-the-catch>4. Reeling In the Catch
<a class=anchor href=#4-reeling-in-the-catch>#</a></h4><ul><li><strong>The Bite</strong>: When the <code>WaitingForFish</code> timer completes, the state transitions to <code>AbleToReel</code>.</li><li><strong>Player Action</strong>: The player must now press the cast action button again. If they do, <code>OnCastAction</code> is triggered while in the <code>AbleToReel</code> state.</li><li><strong>Catching</strong>: The fish is &ldquo;caught&rdquo; by calling <code>CurrentCatchable->Catch()</code>, which attaches the fish actor to an attach point on the fishing rod&rsquo;s bobber. The <code>ReelBack()</code> method is then called on the rod.</li><li><strong>Reeling Back</strong>: <code>AActor_FishingRod::ReelBack</code> uses another timeline (<code>PullReelOutTimeline</code>) to move the bobber (and the attached fish) back to its starting position on the rod.</li></ul><h4 class=heading id=5-success-and-failure>5. Success and Failure
<a class=anchor href=#5-success-and-failure>#</a></h4><ul><li><strong>Success</strong>: If the reeling process completes with a fish attached, an animation notify sends a <code>Messaging.Fishing.Notify.ReelDone</code> message. The <code>FishingComponent</code> receives this and broadcasts another message, <code>Messaging_GameState_StateChange</code>, with the payload <code>FishingGameLoopState_ShowFish</code>.</li><li><strong>Failure (Escaping Fish)</strong>: If the player presses the action button <em>during</em> the <code>WaitingForFish</code> state (before the timer finishes), it is considered an early reel. <code>LetCatchableEscape</code> is called, which in turn calls the <code>Escape()</code> method on the fish. The fish plays an escape timeline to swim back to its original location, and the player reels in an empty line.</li></ul><h3 class=heading id=system-communication-and-game-state-flow>System Communication and Game State Flow
<a class=anchor href=#system-communication-and-game-state-flow>#</a></h3><p>The <code>VAGameplayMessagingSubsystem</code> is used for decoupled communication between different parts of the game. This is particularly important for triggering logic from animation notifies and for signaling changes to the main game mode.</p><p>The sequence diagram below details the interactions during a successful fishing attempt.</p><pre class=mermaid>sequenceDiagram
    autonumber
    participant Player
    participant PlayerInput
    participant FishingComponent
    participant AnimInstance
    participant FishingRod
    participant Fish
    participant GameMode

    Player-&gt;&gt;PlayerInput: Hold Cast Button
    PlayerInput-&gt;&gt;FishingComponent: OnCastAction(elapsedTime)
    Note over FishingComponent: State: Idling
    
    Player-&gt;&gt;PlayerInput: Release Cast Button
    PlayerInput-&gt;&gt;FishingComponent: OnCastActionEnded()
    FishingComponent-&gt;&gt;AnimInstance: BroadcastMessage(AnimInstance_Fishing_State_Throwing)
    Note over FishingComponent: State -&gt; Throwing
    
    AnimInstance-&gt;&gt;FishingComponent: OnThrowNotifyMessageReceived()
    FishingComponent-&gt;&gt;FishingRod: Throw(castLocation)
    
    loop Bobber Movement Timeline
        FishingRod-&gt;&gt;FishingRod: Interpolate bobber location
    end
    
    FishingRod-&gt;&gt;FishingComponent: OnBobberLandsOnWater()
    Note over FishingComponent: State -&gt; WaitingForFish
    FishingComponent-&gt;&gt;Fish: ReeledIn(bobberLocation)
    Note over FishingComponent: Starts Wait Timer
    
    alt Player reels in too early
        Player-&gt;&gt;PlayerInput: Press Cast Button
        PlayerInput-&gt;&gt;FishingComponent: OnCastActionEnded()
        FishingComponent-&gt;&gt;Fish: Escape()
    else Timer Finishes
        Note over FishingComponent: State -&gt; AbleToReel
        Player-&gt;&gt;PlayerInput: Press Cast Button
        PlayerInput-&gt;&gt;FishingComponent: OnCastAction(0)
        FishingComponent-&gt;&gt;Fish: Catch(attachPoint)
        FishingComponent-&gt;&gt;FishingRod: ReelBack()
        Note over FishingComponent: State -&gt; Reeling_In
    end

    AnimInstance-&gt;&gt;FishingComponent: OnReelDoneNotifyMessageReceived()
    FishingComponent-&gt;&gt;GameMode: BroadcastMessage(FishingGameLoopState_ShowFish)
    GameMode-&gt;&gt;GameMode: OnFishingGameLoopStateChanged()
    GameMode-&gt;&gt;GameMode: TriggerScreenFadeInOut()
</pre><p>When the <code>GameMode</code> receives the <code>FishingGameLoopState_ShowFish</code> message, it initiates a screen fade, switches the active camera on the player pawn to a &ldquo;show fish&rdquo; camera, and changes the input mode to UI-only, presenting the player with options to continue or quit.</p><h3 class=heading id=testability>Testability
<a class=anchor href=#testability>#</a></h3><p>I designed the system with testability in mind. The <code>UActorComponent_FishingComponent</code> implements the <code>IMockableFishingInterface</code>, which exposes methods to drive the fishing logic programmatically.</p><ul><li><code>MockCast(float InElapsedTime)</code>: Simulates holding the cast button for a specific duration.</li><li><code>MockCastEnd()</code>: Simulates releasing the cast button.</li></ul><p>Functional tests, such as <code>AFunctionalTest_FishingFeatureTest</code>, can get a reference to this interface and call these methods to validate the entire fishing loop without requiring actual player input. The interface also provides delegates like <code>OnMockAbleToCatchFishDone</code> and <code>OnMockBobberLandsOnWater</code> that tests can bind to for asserting outcomes at specific stages of the process.</p><hr><h3 class=heading id=player-input-and-controls>Player Input and Controls
<a class=anchor href=#player-input-and-controls>#</a></h3><h4 class=heading id=related-pages-5>Related Pages
<a class=anchor href=#related-pages-5>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><p>The following files were used as context for generating this wiki page:</p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h>Source/StairwayFishingGameCore/Public/PlayerController/PlayerController_StairwayFishingGamePlayerController.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp>Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/GameModeBase/GameModeBase_StairwayFishingGame.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a></li></ul></blockquote><h2 class=heading id=player-input-and-controls-1>Player Input and Controls
<a class=anchor href=#player-input-and-controls-1>#</a></h2><p>I built the player input and control system upon Unreal Engine&rsquo;s Enhanced Input System. It provides a decoupled, event-driven architecture for handling player actions, primarily the fishing cast mechanic. The core components include a dedicated Player Controller that interprets raw input, an interface to broadcast input events, and a consumer component that implements the game logic. The system is also managed by the Game Mode, which controls whether the player is in a &ldquo;Game&rdquo; or &ldquo;UI&rdquo; input context based on the current game state.</p><p>The primary input action is the &ldquo;Casting&rdquo; action, which is bound to multiple trigger events (Started, Triggered, Completed) to allow for nuanced control, such as charging a cast by holding down a button. This design separates the input handling from the game mechanics, allowing different components to react to player input without being tightly coupled to the <code>PlayerController</code>.</p><h3 class=heading id=architecture-overview>Architecture Overview
<a class=anchor href=#architecture-overview>#</a></h3><p>The system revolves around four key classes that collaborate to translate a physical input into a gameplay action. The <code>APlayerController_StairwayFishingGamePlayerController</code> is the central hub, responsible for setting up input mappings and broadcasting actions. It uses the <code>IPlayerActionInputInterface</code> to expose delegates, which are then bound by the <code>UActorComponent_FishingComponent</code> to execute fishing logic. The <code>AGameModeBase_StairwayFishingGame</code> oversees the process by managing the overall input mode.</p><pre class=mermaid>classDiagram
    direction TD

    class APlayerController
    class AGameModeBase
    class APawn_StairwayFishingGame

    class APlayerController_StairwayFishingGamePlayerController {
      +UInputMappingContext* DefaultInputMappingContext
      +UInputAction* CastingInputAction
      +FOnPlayerActionInput OnCastStartedDelegate
      +FOnPlayerActionInput OnCastTriggeredDelegate
      +FOnPlayerActionInput OnCastCompletedDelegate
      +BeginPlay()
      +MapInputContext()
      +MapInputActions()
      +OnCastStarted()
      +OnCastTriggered()
      +OnCastFinished()
    }

    class IPlayerActionInputInterface {
      &lt;&lt;Interface&gt;&gt;
      +OnCastActionStarted() FOnPlayerActionInput&amp;
      +OnCastActionTriggered() FOnPlayerActionInput&amp;
      +OnCastActionCompleted() FOnPlayerActionInput&amp;
    }

    class UActorComponent_FishingComponent {
      -IPlayerActionInputInterface* OwnerControllerAsPlayerActionInput
      +BeginPlay()
      +BindToPlayerActionInputDelegates()
      +OnCastAction(float InElapsedTime)
      +OnCastActionEnded(float)
    }

    class AGameModeBase_StairwayFishingGame {
      +OnFishingGameLoopStateChanged()
      +TogglePlayerControllerMode(bool bIsEnabled)
    }

    APlayerController &lt;|-- APlayerController_StairwayFishingGamePlayerController
    APlayerController_StairwayFishingGamePlayerController ..|&gt; IPlayerActionInputInterface: implements
    APawn_StairwayFishingGame *-- UActorComponent_FishingComponent : component of
    UActorComponent_FishingComponent ..&gt; IPlayerActionInputInterface : uses/binds to
    AGameModeBase &lt;|-- AGameModeBase_StairwayFishingGame
    AGameModeBase_StairwayFishingGame ..&gt; APlayerController_StairwayFishingGamePlayerController : manages input mode
</pre><h4 class=heading id=input-handling-flow>Input Handling Flow
<a class=anchor href=#input-handling-flow>#</a></h4><p>The following diagram illustrates the sequence of events from a player&rsquo;s physical input to the execution of the corresponding game logic within the <code>UActorComponent_FishingComponent</code>.</p><pre class=mermaid>sequenceDiagram
    participant Player
    participant EILS as UEnhancedInput&lt;br&gt;LocalPlayerSubsystem
    participant PC as APlayerController_StairwayFishingGamePlayerController
    participant FC as UActorComponent_FishingComponent

    Player-&gt;&gt;EILS: Press/Hold/Release Cast Input
    EILS-&gt;&gt;PC: OnCastStarted(instance)
    PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastStartedDelegate, instance)
    PC-&gt;&gt;FC: OnCastAction(elapsedTime)
    
    loop While input held
        EILS-&gt;&gt;PC: OnCastTriggered(instance)
        PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastTriggeredDelegate, instance)
        PC-&gt;&gt;FC: OnCastAction(elapsedTime)
    end

    EILS-&gt;&gt;PC: OnCastCompleted(instance)
    PC-&gt;&gt;PC: BroadcastCastDelegateAndValue(OnCastCompletedDelegate, instance)
    PC-&gt;&gt;FC: OnCastActionEnded(elapsedTime)
</pre><h3 class=heading id=key-components-1>Key Components
<a class=anchor href=#key-components-1>#</a></h3><h4 class=heading id=aplayercontroller_stairwayfishinggameplayercontroller-1>APlayerController_StairwayFishingGamePlayerController
<a class=anchor href=#aplayercontroller_stairwayfishinggameplayercontroller-1>#</a></h4><p>This class is the primary handler for player input. It is configured with an Input Mapping Context and specific Input Actions to translate hardware inputs into game events.</p><h5 class=heading id=initialization-and-mapping>Initialization and Mapping
<a class=anchor href=#initialization-and-mapping>#</a></h5><p>On <code>BeginPlay</code>, the controller adds its <code>DefaultInputMappingContext</code> to the <code>UEnhancedInputLocalPlayerSubsystem</code> and binds its handler functions to the <code>CastingInputAction</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameCore/Private/PlayerController/PlayerController_StairwayFishingGamePlayerController.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> APlayerController_StairwayFishingGamePlayerController<span style=color:#ff79c6>::</span>MapInputActions()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	UEnhancedInputComponent<span style=color:#ff79c6>*</span> EnhancedInputComponent <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>nullptr</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	<span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>GetEnhancedInputComponent(EnhancedInputComponent))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>		<span style=color:#6272a4>// ... error logging ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>CastingInputAction)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>		<span style=color:#6272a4>// ... error logging ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Started, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastStarted);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Triggered, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastTriggered);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	EnhancedInputComponent<span style=color:#ff79c6>-&gt;</span>BindAction(CastingInputAction, ETriggerEvent<span style=color:#ff79c6>::</span>Completed, <span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastFinished);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>}
</span></span></code></pre></div><h5 class=heading id=iplayeractioninputinterface>IPlayerActionInputInterface
<a class=anchor href=#iplayeractioninputinterface>#</a></h5><p>To decouple input broadcasting from any specific consumer, the controller implements the <code>IPlayerActionInputInterface</code>. This interface defines a contract for any class that wants to provide player action events. It exposes delegates for the three primary states of the cast action.</p><div class=table-outer><table><thead><tr><th>Delegate</th><th>Description</th></tr></thead><tbody><tr><td><code>OnCastActionStarted()</code></td><td>Fired once when the <code>CastingInputAction</code> is started (e.g., button press).</td></tr><tr><td><code>OnCastActionTriggered()</code></td><td>Fired every frame that the <code>CastingInputAction</code> is active (e.g., button held).</td></tr><tr><td><code>OnCastActionCompleted()</code></td><td>Fired once when the <code>CastingInputAction</code> is completed (e.g., button release).</td></tr></tbody></table></div><h4 class=heading id=uactorcomponent_fishingcomponent-1>UActorComponent_FishingComponent
<a class=anchor href=#uactorcomponent_fishingcomponent-1>#</a></h4><p>This component contains the core fishing logic and acts as the consumer of the input events broadcast by the <code>PlayerController</code>.</p><h5 class=heading id=delegate-binding>Delegate Binding
<a class=anchor href=#delegate-binding>#</a></h5><p>In its <code>BeginPlay</code> sequence, the <code>UActorComponent_FishingComponent</code> finds the pawn&rsquo;s controller, verifies it implements <code>IPlayerActionInputInterface</code>, and binds its own functions to the interface&rsquo;s delegates. This establishes the communication link without the component needing a direct reference to the concrete <code>PlayerController</code> class.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> UActorComponent_FishingComponent<span style=color:#ff79c6>::</span>BindToPlayerActionInputDelegates()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#6272a4>// ... code to get OwnerControllerAsPlayerActionInput ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>	OwnerControllerAsPlayerActionInput<span style=color:#ff79c6>-&gt;</span>OnCastActionStarted().BindUObject(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastAction);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>	OwnerControllerAsPlayerActionInput<span style=color:#ff79c6>-&gt;</span>OnCastActionTriggered().BindUObject(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastAction);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>	OwnerControllerAsPlayerActionInput<span style=color:#ff79c6>-&gt;</span>OnCastActionCompleted().BindUObject(<span style=color:#ff79c6>this</span>, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnCastActionEnded);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><p>The <code>OnCastAction</code> method handles both starting the cast and reeling in a fish, depending on the current <code>CurrentFishingState</code>. The <code>OnCastActionEnded</code> method is responsible for executing the throw after the player releases the input.</p><h3 class=heading id=input-mode-management>Input Mode Management
<a class=anchor href=#input-mode-management>#</a></h3><p>The <code>AGameModeBase_StairwayFishingGame</code> is responsible for managing the global input mode of the <code>PlayerController</code>. This ensures the player can only control the character when appropriate and can interact with UI elements at other times.</p><h4 class=heading id=state-driven-control>State-Driven Control
<a class=anchor href=#state-driven-control>#</a></h4><p>The <code>OnFishingGameLoopStateChanged</code> function is the entry point for this logic. When the game state changes (e.g., from <code>Fishing</code> to <code>ShowFish</code>), it calls <code>TogglePlayerControllerMode</code> to update the input settings.</p><pre class=mermaid>graph TD
    A[Game State Changes] --&gt; B{OnFishingGameLoopStateChanged}
    B --&gt; C[bShouldFish = State == Fishing?]
    C --&gt;|true| D[TogglePlayerControllerMode]
    C --&gt;|false| E[TogglePlayerControllerMode]
    D --&gt; F[SetInputMode HideMouseCursor]
    E --&gt; G[SetInputMode ShowMouseCursor]
</pre><p>The <code>TogglePlayerControllerMode</code> function directly manipulates the <code>PlayerController</code> to switch between game input and UI input.</p><div class=table-outer><table><thead><tr><th>State</th><th>Input Mode</th><th>Mouse Cursor</th></tr></thead><tbody><tr><td>Fishing</td><td><code>FInputModeGameOnly</code></td><td>Hidden</td></tr><tr><td>Not Fishing</td><td><code>FInputModeUIOnly</code></td><td>Visible</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> AGameModeBase_StairwayFishingGame<span style=color:#ff79c6>::</span>TogglePlayerControllerMode(APlayerController<span style=color:#ff79c6>*</span> InPlayerController, <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>bool</span><span style=color:#ff79c6>&amp;</span> bIsEnabled) <span style=color:#ff79c6>const</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>InPlayerController)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>		<span style=color:#6272a4>// ... error logging ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	InPlayerController<span style=color:#ff79c6>-&gt;</span>EnableInput(InPlayerController);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	<span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>bIsEnabled)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>		InPlayerController<span style=color:#ff79c6>-&gt;</span>SetInputMode(FInputModeUIOnly());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>	<span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>		InPlayerController<span style=color:#ff79c6>-&gt;</span>SetInputMode(FInputModeGameOnly());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>	InPlayerController<span style=color:#ff79c6>-&gt;</span>SetShowMouseCursor(<span style=color:#ff79c6>!</span>bIsEnabled);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}
</span></span></code></pre></div><hr><h3 class=heading id=configuration-with-data-assets>Configuration with Data Assets
<a class=anchor href=#configuration-with-data-assets>#</a></h3><h4 class=heading id=related-pages-6>Related Pages
<a class=anchor href=#related-pages-6>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><p>The following files were used as context for generating this wiki page:</p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h>Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_FishSpawnAreaConfig.h>Source/FishingFeature/Public/DataAsset/DataAsset_FishSpawnAreaConfig.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp>Source/FishingFeature/Private/Actor/Actor_FishSpawnArea.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/DataAsset/DataAsset_ActorFishConfig.h>Source/FishingFeature/Public/DataAsset/DataAsset_ActorFishConfig.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Public/Actor/Actor_FishingRod.h>Source/FishingFeature/Public/Actor/Actor_FishingRod.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp>Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp</a></li></ul></blockquote><h2 class=heading id=configuration-with-data-assets-1>Configuration with Data Assets
<a class=anchor href=#configuration-with-data-assets-1>#</a></h2><p>I designed the fishing system to be configurable via Unreal Engine&rsquo;s Data Asset pattern. This approach decouples gameplay parameters from the core C++ logic, allowing me (or a designer) to create and modify different fishing behaviors, fish types, and spawning rules by editing asset files in the editor without changing code. The primary mechanism involves creating <code>UDataAsset</code>-derived classes that hold specific configuration structures. Actors and Components within the system then hold an editable reference to these Data Assets to retrieve their settings during initialization.</p><p>This document outlines the architecture of this configuration system and details the various Data Assets used to control the fishing feature, including the main <code>FishingComponent</code>, the <code>FishingRod</code>, individual <code>Fish</code> actors, and <code>FishSpawnArea</code>s.</p><h3 class=heading id=core-configuration-architecture>Core Configuration Architecture
<a class=anchor href=#core-configuration-architecture>#</a></h3><p>The system&rsquo;s configuration is based on a consistent pattern where a C++ struct defines a set of related properties, and a <code>UDataAsset</code> class acts as a container for an instance of that struct. This Data Asset can then be created and edited within the Unreal Editor. Game objects, such as Actors and Actor Components, expose a <code>UPROPERTY(EditAnywhere)</code> pointer to the specific Data Asset type they require, allowing designers to assign a configuration asset in the editor.</p><p>The diagram below illustrates the relationship between a game object (<code>UActorComponent_FishingComponent</code>), its Data Asset (<code>UDataAsset_FishingComponentConfig</code>), and the underlying configuration struct (<code>FFishingComponentConfig</code>).</p><pre class=mermaid>graph TD
    subgraph &#34;C++ Code&#34;
        A[FFishingComponentConfig Struct] --&gt; B(UDataAsset_FishingComponentConfig Class);
        B -- &#34;Contains instance of&#34; --&gt; A;
        C(UActorComponent_FishingComponent Class) -- &#34;Holds UPROPERTY pointer to&#34; --&gt; B;
    end

    subgraph &#34;Unreal Editor&#34;
        D(DA_FishingComponentConfig Asset) -- &#34;Instance of&#34; --&gt; B;
        E(Blueprint Actor) -- &#34;Has instance of&#34; --&gt; C;
        E -- &#34;Assigns Asset&#34; --&gt; D;
    end

    C -- &#34;Reads config from&#34; --&gt; D;
</pre><p><em>This diagram shows how the <code>UActorComponent_FishingComponent</code> class holds a reference to a <code>UDataAsset_FishingComponentConfig</code> class. In the editor, a Blueprint actor with this component assigns a specific Data Asset (e.g., <code>DA_FishingComponentConfig</code>) to it. The component then reads its configuration values from this asset at runtime.</em></p><h3 class=heading id=fishing-component-configuration>Fishing Component Configuration
<a class=anchor href=#fishing-component-configuration>#</a></h3><p>The <code>UActorComponent_FishingComponent</code> is the central component that manages the fishing state machine and logic. Its behavior is configured via <code>UDataAsset_FishingComponentConfig</code>.</p><h4 class=heading id=udataasset_fishingcomponentconfig><code>UDataAsset_FishingComponentConfig</code>
<a class=anchor href=#udataasset_fishingcomponentconfig>#</a></h4><p>This Data Asset contains an <code>FFishingComponentConfig</code> struct, which holds parameters related to casting, targeting, and asset references.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/FishingFeature/Public/DataAsset/DataAsset_FishingComponentConfig.h
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span>UCLASS()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>FISHINGFEATURE_API</span> <span style=color:#8be9fd;font-style:italic>UDataAsset_FishingComponentConfig</span> : <span style=color:#ff79c6>public</span> UDataAsset
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>public</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4>	 * Returns the fishing component config.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4>	 */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	FORCEINLINE FFishingComponentConfig GetFishingComponentConfig() <span style=color:#ff79c6>const</span> { <span style=color:#ff79c6>return</span> FishingComponentConfig; }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>protected</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4>	 * The fishing component config.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4>	 */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>	UPROPERTY(EditDefaultsOnly, Category <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;Fishing Component Config&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	FFishingComponentConfig FishingComponentConfig;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>};
</span></span></code></pre></div><p>The component retrieves these values to control gameplay logic, such as calculating the cast distance based on how long the cast action is held.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> UActorComponent_FishingComponent<span style=color:#ff79c6>::</span>DetermineCastLocation(<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span><span style=color:#ff79c6>&amp;</span> InElapsedTime)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4></span>	<span style=color:#ff79c6>const</span> FFishingComponentConfig FishingComponentConfig <span style=color:#ff79c6>=</span> FishingComponentConfigData<span style=color:#ff79c6>-&gt;</span>GetFishingComponentConfig();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> MaximumTimeToCast <span style=color:#ff79c6>=</span> FishingComponentConfig.MaximumTimeToCast;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> MinimumCastDistance <span style=color:#ff79c6>=</span> FishingComponentConfig.MinimumCastDistance;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> MaximumCastDistance <span style=color:#ff79c6>=</span> FishingComponentConfig.MaximumCastDistance;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span> MappedForwardDistance <span style=color:#ff79c6>=</span> FMath<span style=color:#ff79c6>::</span>GetMappedRangeValueClamped(FVector2D(<span style=color:#bd93f9>0.f</span>, MaximumTimeToCast), FVector2D(MinimumCastDistance, MaximumCastDistance), InElapsedTime);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><h3 class=heading id=fishing-rod-configuration>Fishing Rod Configuration
<a class=anchor href=#fishing-rod-configuration>#</a></h3><p>The <code>AActor_FishingRod</code> is responsible for the visual representation and movement of the fishing rod and its bobber. Its configuration, defined in <code>UDataAsset_FishingRodConfig</code>, primarily controls the animation of the bobber using <code>UCurveFloat</code> assets.</p><h4 class=heading id=udataasset_fishingrodconfig><code>UDataAsset_FishingRodConfig</code>
<a class=anchor href=#udataasset_fishingrodconfig>#</a></h4><p>This asset provides curves that drive timelines for the bobber&rsquo;s movement when it is cast (<code>Throw</code>) and reeled back.</p><p>The <code>SetupTimelines</code> function in <code>AActor_FishingRod</code> reads the curve assets from the config and binds them to <code>FTimeline</code> objects.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/FishingFeature/Private/Actor/Actor_FishingRod.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> AActor_FishingRod<span style=color:#ff79c6>::</span>SetupTimelines()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>	<span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>FishingRodConfigData)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>		<span style=color:#6272a4>//...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4></span>		<span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#ff79c6>const</span> FFishingRodConfig FishingRodConfig <span style=color:#ff79c6>=</span> FishingRodConfigData<span style=color:#ff79c6>-&gt;</span>GetFishingRodConfig();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>	UCurveFloat<span style=color:#ff79c6>*</span> BobberReelInCurve <span style=color:#ff79c6>=</span> FishingRodConfig.BobberReelInCurve;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	<span style=color:#ff79c6>if</span> (BobberReelInCurve)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>		BIND_TIMELINE(ThrowReelInFloatUpdate, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnThrowReelInUpdate, ThrowReelInFinishedEvent, <span style=color:#ff79c6>&amp;</span>ThisClass<span style=color:#ff79c6>::</span>OnThrowReelInFinished)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>		SetupTimelineDataAndCallbacks(<span style=color:#ff79c6>&amp;</span>ThrowReelInTimeline, ThrowReelInFloatUpdate, ThrowReelInFinishedEvent, BobberReelInCurve);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>	}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#6272a4>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4></span>}
</span></span></code></pre></div><p>This allows designers to visually author the acceleration and deceleration of the bobber&rsquo;s movement in the editor.</p><h3 class=heading id=fish-actor-configuration>Fish Actor Configuration
<a class=anchor href=#fish-actor-configuration>#</a></h3><p>The behavior of individual fish is defined by <code>UDataAsset_ActorFishConfig</code>. This allows for different types of fish with unique movement characteristics and sounds.</p><h4 class=heading id=udataasset_actorfishconfig><code>UDataAsset_ActorFishConfig</code>
<a class=anchor href=#udataasset_actorfishconfig>#</a></h4><p>This Data Asset contains an <code>FActorFishConfig</code> struct with parameters controlling the fish&rsquo;s AI and interaction behaviors.</p><div class=table-outer><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>FishRotationSpeed</code></td><td><code>float</code></td><td>The speed at which the fish turns while wandering.</td></tr><tr><td><code>FishMoveSpeed</code></td><td><code>float</code></td><td>The speed at which the fish moves while wandering.</td></tr><tr><td><code>FishWanderTargetRadius</code></td><td><code>float</code></td><td>The radius around a wander target point. Once the fish enters this radius, it selects a new target.</td></tr><tr><td><code>FishReelingInCurve</code></td><td><code>UCurveFloat*</code></td><td>A curve asset that controls the fish&rsquo;s movement when it&rsquo;s being reeled towards the bobber.</td></tr><tr><td><code>FishEscapedCurve</code></td><td><code>UCurveFloat*</code></td><td>A curve asset that controls the fish&rsquo;s movement when it escapes back to its original location.</td></tr><tr><td><code>FishBiteSound</code></td><td><code>USoundBase*</code></td><td>The sound played when the fish &ldquo;bites&rdquo; the bobber.</td></tr></tbody></table></div><p>The <code>AActor_Fish</code> class retrieves these values in <code>SetupFishMovementValues</code> and uses them in its <code>WanderWithinBoundingBox</code> logic, which runs every tick.</p><pre class=mermaid>graph TD
    subgraph &#34;Configuration&#34;
        ConfigAsset(DA_ActorFishConfig)
    end

    subgraph &#34;Initialization&#34;
        A[AActor_Fish::BeginPlay] --&gt; B(AActor_Fish::SetupFishMovementValues);
        B -- &#34;Reads values from&#34; --&gt; ConfigAsset;
        B --&gt; C{Cache values like&lt;br&gt;FishMoveSpeed,&lt;br&gt;FishRotationSpeed};
    end

    subgraph &#34;Runtime (Tick)&#34;
        D[AActor_Fish::Tick] --&gt; E(AActor_Fish::WanderWithinBoundingBox);
        E -- &#34;Uses cached values to&#34; --&gt; F(Calculate new location &amp; rotation);
        F --&gt; G(SetActorLocationAndRotation);
    end
</pre><p><em>This diagram illustrates the data flow from the <code>DA_ActorFishConfig</code> asset to the <code>AActor_Fish</code>&rsquo;s movement logic. Values are read once during initialization and then used every frame to drive the fish&rsquo;s wandering behavior.</em></p><h3 class=heading id=fish-spawning-configuration>Fish Spawning Configuration
<a class=anchor href=#fish-spawning-configuration>#</a></h3><p>The <code>AActor_FishSpawnArea</code> is a volume that handles the spawning of fish within its bounds. It uses <code>UDataAsset_FishSpawnAreaConfig</code> to determine what kind of fish to spawn and how many.</p><h4 class=heading id=udataasset_fishspawnareaconfig><code>UDataAsset_FishSpawnAreaConfig</code>
<a class=anchor href=#udataasset_fishspawnareaconfig>#</a></h4><p>This Data Asset holds an <code>FFishSpawnAreaConfig</code> struct.</p><div class=table-outer><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>FishActorClass</code></td><td><code>TSoftClassPtr&lt;AActor></code></td><td>A soft reference to the fish actor class to be spawned. Using a soft pointer allows for asynchronous loading.</td></tr><tr><td><code>FishSpawnAmount</code></td><td><code>int32</code></td><td>The number of fish to spawn within the area.</td></tr></tbody></table></div><p>The spawning process is asynchronous to avoid hitches when loading fish assets. The <code>AActor_FishSpawnArea</code> requests the asset load on <code>BeginPlay</code> and spawns the actors in a callback once the load is complete.</p><h4 class=heading id=asynchronous-spawning-flow>Asynchronous Spawning Flow
<a class=anchor href=#asynchronous-spawning-flow>#</a></h4><pre class=mermaid>sequenceDiagram
    participant A as AActor_FishSpawnArea
    participant B as UAssetManager
    participant C as StreamableManager

    A-&gt;&gt;A: BeginPlay()
    A-&gt;&gt;A: RequestLoadFishAssetSoftClass()
    Note right of A: Reads FishActorClass from its Data Asset
    A-&gt;&gt;B: GetStreamableManager()
    B--&gt;&gt;A: Returns StreamableManager
    A-&gt;&gt;C: RequestAsyncLoad(FishActorClass, OnFishSpawnAssetLoaded)
    C--&gt;&gt;A: Returns FStreamableHandle

    Note over A,C: ...Time passes while asset loads...

    C-&gt;&gt;A: OnFishSpawnAssetLoaded() callback
    A-&gt;&gt;A: SpawnFishes()
    loop For each FishSpawnAmount
        A-&gt;&gt;A: SpawnActorDeferred()
        A-&gt;&gt;A: SetSpawnAreaCenterAndExtent()
        A-&gt;&gt;A: FinishSpawning()
    end
</pre><p><em>This sequence diagram shows how <code>AActor_FishSpawnArea</code> initiates an asynchronous load of the fish actor class. The <code>UAssetManager</code> handles the loading in the background. Once complete, the <code>OnFishSpawnAssetLoaded</code> callback is executed, which then proceeds to spawn the configured number of fish.</em></p><h3 class=heading id=conclusion-2>Conclusion
<a class=anchor href=#conclusion-2>#</a></h3><p>The extensive use of Data Assets for configuration is a cornerstone of the fishing feature&rsquo;s design. It provides a clean separation between data and logic, empowering designers to iterate on gameplay balance, asset usage, and behavior without requiring engineering support. This modular and data-driven approach makes the system scalable and easy to maintain.</p><hr><h3 class=heading id=ui-widgets>UI Widgets
<a class=anchor href=#ui-widgets>#</a></h3><h4 class=heading id=related-pages-7>Related Pages
<a class=anchor href=#related-pages-7>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><p>The following files were used as context for generating this wiki page:</p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp>Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp>Source/StairwayFishingGameUI/Private/UserWidget/UserWidget_FishingDoneScreen.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameUI/Public/UserWidget/UserWidget_MainOverlay.h>Source/StairwayFishingGameUI/Public/UserWidget/UserWidget_MainOverlay.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp>Source/StairwayFishingGameCore/Private/GameModeBase/GameModeBase_StairwayFishingGame.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h>Source/StairwayFishingGameCore/Public/Pawn/Pawn_StairwayFishingGame.h</a></li></ul></blockquote><h2 class=heading id=ui-widgets-1>UI Widgets
<a class=anchor href=#ui-widgets-1>#</a></h2><p>I created the UI system in the Stairway Fishing Game to provide visual feedback to the player for key gameplay actions, such as casting power and end-of-round options. I designed the system to be decoupled from the core gameplay logic, reacting to events broadcasted through the <code>VAGameplayMessagingSubsystem</code>. This event-driven architecture allows for flexible and maintainable UI components that respond to specific gameplay tags and payloads.</p><p>The primary UI components include a main overlay that acts as a container, a dynamic cast meter bar that reflects the player&rsquo;s casting charge, and a &ldquo;Fishing Done&rdquo; screen that appears after a fish is successfully caught. These widgets are primarily managed through C++ logic, with their visual layout defined in Blueprint User Widgets.</p><h3 class=heading id=ui-architecture-overview>UI Architecture Overview
<a class=anchor href=#ui-architecture-overview>#</a></h3><p>The UI is structured with a main container widget, <code>UUserWidget_MainOverlay</code>, which holds other specialized widgets. The <code>APawn_StairwayFishingGame</code> pawn directly incorporates the <code>CastMeterBarWidget</code> as a <code>UWidgetComponent</code>, while the <code>UserWidget_MainOverlay</code> is likely added to the viewport by the game&rsquo;s HUD management system.</p><p>This diagram illustrates the composition of the UI widgets.</p><pre class=mermaid>graph TD
    subgraph &#34;Game UI&#34;
        A[UUserWidget_MainOverlay] --&gt; B[UUserWidget_FishingDoneScreen];
        C(APawn_StairwayFishingGame) --&gt; D[UWidgetComponent: CastMeterBarWidget];
    end
</pre><ul><li><code>UUserWidget_MainOverlay</code> is the top-level widget containing the <code>FishingDoneScreen</code>.</li><li>The <code>APawn_StairwayFishingGame</code> contains the <code>CastMeterBarWidget</code> as a component, which renders the <code>UUserWidgetMeterBar_CastMeterBar</code>.</li></ul><h4 class=heading id=key-ui-widgets>Key UI Widgets
<a class=anchor href=#key-ui-widgets>#</a></h4><div class=table-outer><table><thead><tr><th>Widget Class</th><th>Description</th><th>Source File</th></tr></thead><tbody><tr><td><code>UUserWidget_MainOverlay</code></td><td>The main overlay for the game, acting as a container for other UI elements like the fishing done screen.</td><td><code>UserWidget_MainOverlay.h</code></td></tr><tr><td><code>UUserWidgetMeterBar_CastMeterBar</code></td><td>A progress bar that visually represents the power of the player&rsquo;s cast. Its value and color are updated dynamically based on gameplay events.</td><td><code>UserWidgetMeterBar_CastMeterBar.cpp</code></td></tr><tr><td><code>UUserWidget_FishingDoneScreen</code></td><td>A screen that appears after a fishing attempt is complete, typically showing buttons to restart or quit.</td><td><code>UserWidget_FishingDoneScreen.cpp</code></td></tr></tbody></table></div><h3 class=heading id=cast-meter-bar>Cast Meter Bar
<a class=anchor href=#cast-meter-bar>#</a></h3><p>The <code>UUserWidgetMeterBar_CastMeterBar</code> provides real-time feedback to the player during the casting action. It listens for messages from the gameplay system to update its progress and color.</p><h4 class=heading id=initialization-and-state>Initialization and State
<a class=anchor href=#initialization-and-state>#</a></h4><p>Upon construction (<code>NativeConstruct</code>), the meter bar initializes itself to a progress of 0 and becomes hidden. It then registers a listener for UI update messages.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> UUserWidgetMeterBar_CastMeterBar<span style=color:#ff79c6>::</span>NativeConstruct()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>	Super<span style=color:#ff79c6>::</span>NativeConstruct();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>	ListenForUICastUpdateMessage();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>	InitializeMeterBar();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}
</span></span></code></pre></div><h4 class=heading id=event-listening-and-data-flow>Event Listening and Data Flow
<a class=anchor href=#event-listening-and-data-flow>#</a></h4><p>The cast meter&rsquo;s logic is driven by the <code>VAGameplayMessagingSubsystem</code>. It subscribes to a specific channel identified by the <code>Messaging_Fishing_UI_Cast_Update</code> gameplay tag.</p><p>The sequence of events for updating the cast meter is as follows:</p><ol><li>The <code>PlayerController</code> detects a &ldquo;Cast&rdquo; input action.</li><li>It notifies the <code>UActorComponent_FishingComponent</code> attached to the pawn.</li><li>The <code>FishingComponent</code> calculates the cast progress as a float value.</li><li>It broadcasts this float value on the <code>Messaging_Fishing_UI_Cast_Update</code> channel.</li><li>The <code>UUserWidgetMeterBar_CastMeterBar</code>, which is listening on this channel, receives the message.</li><li>It updates its progress bar&rsquo;s percentage and color based on the received float value.</li></ol><pre class=mermaid>sequenceDiagram
    participant PC as PlayerController
    participant FC as FishingComponent
    participant GMS as VAGameplayMessagingSubsystem
    participant CMB as CastMeterBar

    PC-&gt;&gt;FC: OnCastAction(elapsedTime)
    FC-&gt;&gt;FC: GetMappedElapsedTimeToMaximumCastTime()
    FC-&gt;&gt;GMS: BroadcastMessage(UI_Cast_Update, progress_float)
    GMS--&gt;&gt;FC: 
    GMS-&gt;&gt;CMB: OnGameplayMessageReceived(payload: float)
    CMB-&gt;&gt;CMB: SetProgress(progress)
    CMB-&gt;&gt;CMB: SetProgressBarColor(color)
    CMB-&gt;&gt;CMB: ToggleVisibility(true)
</pre><p><em>This diagram illustrates the message flow from player input to the UI update for the cast meter.</em></p><p>The <code>OnFishingMessageReceived</code> function handles the incoming message, validates that the payload is a float, and then updates the UI elements. The progress bar&rsquo;s color is determined by sampling a <code>UCurveLinearColor</code> asset (<code>CastMeterBarColorCurve</code>) at the given progress value.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>// Source/StairwayFishingGameUI/Private/UserWidget/MeterBar/UserWidgetMeterBar_CastMeterBar.cpp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#8be9fd>void</span> UUserWidgetMeterBar_CastMeterBar<span style=color:#ff79c6>::</span>OnFishingMessageReceived(<span style=color:#ff79c6>const</span> FGameplayTag<span style=color:#ff79c6>&amp;</span> Channel,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>	<span style=color:#ff79c6>const</span> FVAAnyUnreal<span style=color:#ff79c6>&amp;</span>                                                             MessagePayload)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>	<span style=color:#6272a4>// ... payload validation ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>float</span>        Progress <span style=color:#ff79c6>=</span> MessagePayload.Get<span style=color:#ff79c6>&lt;</span><span style=color:#8be9fd>float</span><span style=color:#ff79c6>&gt;</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#ff79c6>const</span> FLinearColor Color <span style=color:#ff79c6>=</span> GetColorForProgress(Progress);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#ff79c6>const</span> <span style=color:#8be9fd>bool</span> bShouldBeVisible <span style=color:#ff79c6>=</span> Progress <span style=color:#ff79c6>&gt;</span> <span style=color:#bd93f9>0.f</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>	ToggleVisibility(bShouldBeVisible);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>	SetProgress(Progress);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	SetProgressBarColor(Color);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><h3 class=heading id=fishing-done-screen>Fishing Done Screen
<a class=anchor href=#fishing-done-screen>#</a></h3><p>The <code>UUserWidget_FishingDoneScreen</code> is a widget that becomes visible at the end of a successful fishing sequence, presenting the player with further options. Its visibility is controlled by the game&rsquo;s overall state.</p><h4 class=heading id=visibility-control>Visibility Control
<a class=anchor href=#visibility-control>#</a></h4><p>Similar to the cast meter, this widget listens for messages via the <code>VAGameplayMessagingSubsystem</code>. It subscribes to the <code>Messaging_GameMode_StateChangeFinish</code> channel. When it receives a message, it checks if the payload <code>FGameplayTag</code> matches <code>FishingGameLoopState_ShowFish</code>. If it does, the widget&rsquo;s button container becomes visible.</p><p>The flow for showing the &ldquo;Fishing Done&rdquo; screen is:</p><ol><li>The <code>FishingComponent</code> determines a fish has been caught and notifies the system to change the game state to <code>ShowFish</code>.</li><li>The <code>GameMode</code> processes this state change.</li><li>After the state transition is complete (including camera fades), the <code>GameMode</code> broadcasts a <code>Messaging_GameMode_StateChangeFinish</code> message with the new state tag (<code>FishingGameLoopState_ShowFish</code>).</li><li>The <code>UUserWidget_FishingDoneScreen</code> receives this message and makes its buttons visible.</li></ol><pre class=mermaid>sequenceDiagram
    participant FC as FishingComponent
    participant GMS as VAGameplayMessagingSubsystem
    participant GM as GameMode
    participant FDS as FishingDoneScreen

    FC-&gt;&gt;GMS: BroadcastMessage(GameState_StateChange, ShowFish)
    
    Note over GMS, GM: GameState notifies GameMode
    
    GM-&gt;&gt;GM: OnFishingGameLoopStateChanged(ShowFish)
    GM-&gt;&gt;GM: TriggerScreenFadeInOut()
    
    loop Fade-in Timer
        GM-&gt;&gt;GMS: BroadcastMessage(StateChangeFinish, ShowFish)
    end
    
    GMS-&gt;&gt;FDS: OnFishingGameLoopStateChanged(payload: ShowFish)
    FDS-&gt;&gt;FDS: ToggleWidgetButtonsContainerVisibility(true)
</pre><p><em>This diagram shows the event sequence that leads to the &ldquo;Fishing Done&rdquo; screen being displayed.</em></p><h4 class=heading id=ui-message-subscriptions>UI Message Subscriptions
<a class=anchor href=#ui-message-subscriptions>#</a></h4><p>The UI widgets rely on a set of predefined gameplay messages to function.</p><div class=table-outer><table><thead><tr><th>Message Channel Tag</th><th>Payload Type</th><th>Emitter(s)</th><th>Listener(s)</th><th>Description</th></tr></thead><tbody><tr><td><code>Messaging_Fishing_UI_Cast_Update</code></td><td><code>float</code></td><td><code>UActorComponent_FishingComponent</code></td><td><code>UUserWidgetMeterBar_CastMeterBar</code></td><td>Updates the cast meter&rsquo;s progress during the casting action.</td></tr><tr><td><code>Messaging_GameMode_StateChangeFinish</code></td><td><code>FGameplayTag</code></td><td><code>AGameModeBase_StairwayFishingGame</code></td><td><code>UUserWidget_FishingDoneScreen</code></td><td>Signals that a game state transition has finished, used to show the UI.</td></tr></tbody></table></div><p>This decoupled, message-based approach ensures that the UI can react to gameplay events without having direct dependencies on the actors or components that trigger them.</p><hr><h3 class=heading id=functional-testing>Functional Testing
<a class=anchor href=#functional-testing>#</a></h3><h4 class=heading id=related-pages-8>Related Pages
<a class=anchor href=#related-pages-8>#</a></h4><blockquote><p><strong>Relevant source files</strong></p><ul><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp>Source/FishingFeatureTests/Private/FunctionalTest/FunctionalTest_FishingFeatureTest.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp>Source/FishingFeatureTests/Private/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h>Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_AbleToCatchFish.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h>Source/FishingFeatureTests/Public/FunctionalTest/FishingFeatureTest/FunctionalFishingFeatureTest_ReelTest.h</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp>Source/FishingFeature/Private/ActorComponent/ActorComponent_FishingComponent.cpp</a></li><li><a href=https://github.com/rezonated/Unreal-Fishing-Test/blob/main/Source/FishingFeature/Private/Actor/Actor_Fish.cpp>Source/FishingFeature/Private/Actor/Actor_Fish.cpp</a></li></ul></blockquote><h2 class=heading id=functional-testing-1>Functional Testing
<a class=anchor href=#functional-testing-1>#</a></h2><p>I utilized Unreal Engine&rsquo;s built-in Functional Test framework to automate the validation of the core fishing gameplay mechanics. I designed these tests to run within a game session, simulating player actions and verifying the responses of the <code>UActorComponent_FishingComponent</code>. My primary goal was to ensure that key features like casting, fish detection, and reeling behave as expected under various conditions.</p><p>The testing architecture is built around a base test class, <code>AFunctionalTest_FishingFeatureTest</code>, which provides common setup and utility functions. I implemented specific test scenarios, such as verifying the ability to catch a fish or successfully reeling one in, in derived classes. These tests interact with the fishing component through a dedicated <code>IMockableFishingInterface</code>, allowing the test framework to drive the component&rsquo;s state machine and listen for outcomes via delegates.</p><h3 class=heading id=test-framework-architecture>Test Framework Architecture
<a class=anchor href=#test-framework-architecture>#</a></h3><p>The functional testing setup is composed of a base class that handles common initialization and several derived classes that implement specific test cases.</p><pre class=mermaid>graph TD
    A[AFunctionalTest] --&gt; B[AFunctionalTest_FishingFeatureTest];
    B --&gt; C[AFunctionalFishingFeatureTest_AbleToCatchFish];
    B --&gt; D[AFunctionalFishingFeatureTest_ReelTest];
</pre><center><i>Functional Test Class Hierarchy</i></center><h4 class=heading id=base-test-class-afunctionaltest_fishingfeaturetest>Base Test Class: AFunctionalTest_FishingFeatureTest
<a class=anchor href=#base-test-class-afunctionaltest_fishingfeaturetest>#</a></h4><p>This class serves as the foundation for all fishing-related functional tests. Its main responsibility is to prepare the test environment by locating the target <code>UActorComponent_FishingComponent</code> to be tested.</p><ul><li><strong><code>PrepLookForMockableFishingComponent()</code></strong>: This function is called at the start of a test. It finds the first player controller and its associated pawn. It then iterates through the pawn&rsquo;s components to find one that implements the <code>UMockableFishingInterface</code>. This interface provides the necessary hooks (<code>MockCast</code>, <code>MockCastEnd</code>, and delegates) for the test to drive and monitor the fishing component&rsquo;s behavior. If a valid component cannot be found, the test fails immediately.</li></ul><h4 class=heading id=test-execution-flow>Test Execution Flow
<a class=anchor href=#test-execution-flow>#</a></h4><p>The tests simulate player input by using the <code>Tick</code> function to manage time. A common pattern is to increment a timer (<code>CurrentMockFishingTime</code>) and continuously call the <code>MockCast</code> function on the fishing component. Once the timer reaches a randomized duration, <code>MockCastEnd</code> is called to simulate the player releasing the cast action. The test then waits for delegates to be fired from the fishing component to determine the outcome.</p><pre class=mermaid>sequenceDiagram
    participant Test as AFunctionalTest_FishingFeatureTest
    participant Component as UActorComponent_FishingComponent

    loop Every Frame
        Test-&gt;&gt;Test: CurrentMockFishingTime += DeltaTime
        Test-&gt;&gt;Component: MockCast(CurrentMockFishingTime)
    end

    alt CurrentMockFishingTime &gt;= RandomizedTime
        Test-&gt;&gt;Component: MockCastEnd()
        Note over Component: Begins internal logic (casting, waiting for fish, etc.)
    end
</pre><center><i>General Test Input Simulation Flow</i></center><h3 class=heading id=test-scenarios>Test Scenarios
<a class=anchor href=#test-scenarios>#</a></h3><p>Specific gameplay mechanics are validated through dedicated test actor classes.</p><h4 class=heading id=able-to-catch-fish-test>Able to Catch Fish Test
<a class=anchor href=#able-to-catch-fish-test>#</a></h4><p>The <code>AFunctionalFishingFeatureTest_AbleToCatchFish</code> class is designed to verify that the fishing component can successfully detect a fish after casting.</p><p><strong>Purpose</strong>: To confirm that after a cast, a sphere trace is performed, a nearby &ldquo;catchable&rdquo; actor is identified, and the component transitions to the &ldquo;waiting for fish&rdquo; state.</p><p><strong>Execution Steps</strong>:</p><ol><li><strong>BeginPlay</strong>: The test prepares the environment using <code>PrepLookForMockableFishingComponent</code>. It then binds a handler, <code>OnMockAbleToCatchFishDone</code>, to the corresponding delegate on the mockable interface. A random hold time for the cast is calculated.</li><li><strong>Tick</strong>: The test simulates holding down the cast button for the randomized duration.</li><li><strong>Cast End</strong>: <code>MockCastEnd</code> is called, triggering the fishing component&rsquo;s casting logic.</li><li><strong>Verification</strong>: The fishing component, upon the bobber landing, performs a sphere trace to find catchable actors (<code>AttemptGetNearestCatchable</code>). It then sorts them by distance and selects the nearest one. Finally, it executes the <code>MockAbleToCatchFishDoneDelegate</code> with <code>true</code> if a catchable was found, or <code>false</code> otherwise.</li><li><strong>Result</strong>: The test&rsquo;s <code>OnMockAbleToCatchFishDone</code> handler receives the result. If the result is <code>true</code>, the test passes; otherwise, it fails.</li></ol><pre class=mermaid>sequenceDiagram
    autonumber
    participant Test as AFunctionalFishingFeatureTest_AbleToCatchFish
    participant Component as UActorComponent_FishingComponent

    Test-&gt;&gt;Component: OnMockAbleToCatchFishDone().BindUObject()
    
    loop Until RandomizedMockFishingTime
        Test-&gt;&gt;Component: MockCast(CurrentTime)
    end
    
    Test-&gt;&gt;Component: MockCastEnd()
    Note over Component: Initiates cast animation and logic
    
    Note over Component: Bobber lands...
    Component-&gt;&gt;Component: AttemptGetNearestCatchable()
    Note right of Component: Sphere trace for fish
    
    alt Fish found
        Component--&gt;&gt;Test: MockAbleToCatchFishDoneDelegate.Execute(true)
    else No fish found
        Component--&gt;&gt;Test: MockAbleToCatchFishDoneDelegate.Execute(false)
    end

    Test-&gt;&gt;Test: OnMockAbleToCatchFishDone(bSuccess)
    Test-&gt;&gt;Test: FinishTest(Succeeded or Failed)
</pre><center><i>"Able to Catch Fish" Test Sequence</i></center><h4 class=heading id=reel-in-test>Reel In Test
<a class=anchor href=#reel-in-test>#</a></h4><p>The <code>AFunctionalFishingFeatureTest_ReelTest</code> class validates the player&rsquo;s ability to reel in a fish. This test is more complex as it involves multiple stages of the fishing process and can be configured to test both success and failure scenarios.</p><p><strong>Purpose</strong>: To confirm the entire sequence from casting, waiting for a fish to bite, and reeling it in. The <code>bExpectedResult</code> property allows the test to verify both successful reels and failures (e.g., reeling in too early).</p><div class=table-outer><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>MinMockHoldFishingTime</code></td><td><code>float</code></td><td>Minimum time to simulate holding the cast action.</td></tr><tr><td><code>MaxMockHoldFishingTime</code></td><td><code>float</code></td><td>Maximum time to simulate holding the cast action.</td></tr><tr><td><code>MinMockReelInTime</code></td><td><code>float</code></td><td>Minimum delay before simulating the reel-in action after a fish is on the line.</td></tr><tr><td><code>MaxMockReelInTime</code></td><td><code>float</code></td><td>Maximum delay before simulating the reel-in action after a fish is on the line.</td></tr><tr><td><code>bExpectedResult</code></td><td><code>bool</code></td><td>The expected outcome of the test (<code>true</code> for a successful catch, <code>false</code> for a failed one).</td></tr></tbody></table></div><p><strong>Execution Steps</strong>:</p><ol><li><strong>BeginPlay</strong>: The test binds to two delegates: <code>OnMockReelInDone</code> and <code>OnBobberLandsOnWater</code>.</li><li><strong>Casting</strong>: The test simulates a cast, similar to the &ldquo;Able to Catch Fish&rdquo; test.</li><li><strong>Bobber Lands</strong>: The <code>OnBobberLandsOnWater</code> delegate is triggered by the fishing component. The test handler for this delegate then starts another timer to simulate waiting for the fish to bite before reeling.</li><li><strong>Reeling</strong>: After a randomized <code>ReelInTime</code>, the test calls <code>OnCastAction</code> again, which in the <code>AbleToReel</code> state, triggers the catch logic.</li><li><strong>Verification</strong>: The fishing component processes the reel-in action. If the state is correct (<code>AbleToReel</code>), it attaches the fish and reels back, eventually firing <code>MockReelInDoneDelegate</code> with <code>true</code>. If the player reels too early (while in <code>WaitingForFish</code> state), the fish escapes, and the delegate is fired with <code>false</code>.</li><li><strong>Result</strong>: The <code>OnMockReelInDone</code> handler compares the boolean result from the delegate with its configured <code>bExpectedResult</code> to determine if the test passed or failed.</li></ol><h2 class=heading id=summary-1>Summary
<a class=anchor href=#summary-1>#</a></h2><p>The functional testing suite provides an automated and reliable way to validate the fishing feature&rsquo;s complex state machine. By simulating player actions and using a mockable interface with delegates, the tests can confirm the correctness of critical gameplay flows, from casting and finding a fish to successfully reeling it in. This ensures that changes to the fishing component or related data assets do not introduce regressions and that the core mechanic remains stable.</p></div></article><script defer type=module id=mermaid_script data-light-theme=default data-dark-theme=dark src=/js/mermaid.js>
  </script><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script><script src=https://code.jquery.com/jquery-3.6.0.min.js></script><script src=/js/lastfm.js></script></html>