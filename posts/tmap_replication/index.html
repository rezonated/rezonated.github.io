<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://rezonated.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rezonated.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rezonated.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://rezonated.github.io/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://rezonated.github.io/apple-touch-icon.png><meta name=description content="This article shows two approaches to replicate TMap structures in Unreal Engine"><title>Approaches to replicate Unreal Engine's TMap | V's personal site</title><link rel=canonical href=https://rezonated.github.io/posts/tmap_replication/><meta property="og:url" content="https://rezonated.github.io/posts/tmap_replication/"><meta property="og:site_name" content="V's personal site"><meta property="og:title" content="Approaches to replicate Unreal Engine's TMap"><meta property="og:description" content="This article shows two approaches to replicate TMap structures in Unreal Engine"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-14T00:00:00+00:00"><meta property="article:tag" content="Multiplayer"><meta property="article:tag" content="Ue"><meta property="article:tag" content="C++"><link rel=stylesheet href=/assets/combined.min.44deaa6678e01a128f508829cd0a154395ad2bd3fb767197239c535cd99516a1.css media=all></head><body class=dark><div class=content><header><div class=header></div></header><main class=main><div class=breadcrumbs><a href=/>~</a><span class=breadcrumbs-separator>/</span><a href=/posts/>Posts</a><span class=breadcrumbs-separator>/</span>
<a href=/posts/tmap_replication/>Approaches to replicate Unreal Engine's TMap</a></div><div><article><header class=single-intro-container><h1 class=single-title>Approaches to replicate Unreal Engine's TMap</h1><div class=single-subsummary><div><p class=single-date><time datetime=2025-06-14T00:00:00+00:00>June 14, 2025</time>
&nbsp; · &nbsp;7 min read</p></div></div></header><div class=single-content><h1 class=heading id=introduction>Introduction
<a class=anchor href=#introduction>#</a></h1><p>If you ever attempt to put a <code>Replicated</code> specifier on your <code>UPROPERTY</code> with <code>TMap</code>, your IDE or compiler might yell at you like this:</p><p><p><img src=/posts/tmap_replication/tmap_doesnt_support_replication.png alt="TMap Replication Attempt" title="Replication maps are not supported?"></p></p><h1 class=heading id=why-cant-tmap-be-replicated-by-unreal>Why can&rsquo;t TMap be replicated by Unreal?
<a class=anchor href=#why-cant-tmap-be-replicated-by-unreal>#</a></h1><p>Unreal&rsquo;s built-in replication only supports certain types that the replication system knows how to serialize. This includes basic primitives, some containers like <code>TArray</code>, <code>FVector</code>, or custom structs containing <code>UPROPERTY</code> fields.</p><p><code>TMap</code> is considered a dynamic container because of its non-fixed size, ordering, and hashing behavior. That makes replication much trickier to handle reliably - which is likely why Epic doesn’t provide built-in support for replicating <code>TMap</code>.</p><h1 class=heading id=so-we-cant-replicate-tmap-at-all>So&mldr; we can&rsquo;t replicate TMap at all?
<a class=anchor href=#so-we-cant-replicate-tmap-at-all>#</a></h1><p>Not exactly. While you can&rsquo;t simply slap a <code>Replicated</code> specifier onto a <code>TMap</code>, there are still ways to replicate map-like data manually. One is relatively straightforward, while the other requires a bit more advanced serialization work.</p><p>The two approaches we’ll cover:</p><ol><li>Replicate a separate array of key-value structs alongside your map.</li><li>Wrap your <code>TMap</code> inside a custom <code>USTRUCT</code> and implement <code>NetSerialize()</code> for full control over serialization.</li></ol><h1 class=heading id=approach-1---the-separate-array-approach>Approach 1 - The separate array approach
<a class=anchor href=#approach-1---the-separate-array-approach>#</a></h1><p>The idea here is simple: create a separate replicated <code>TArray</code> (which Unreal does support) containing your map’s key-value pairs as custom structs. Then rebuild the <code>TMap</code> on the client when the array replicates.</p><p>The server holds its own <code>TMap</code>, but updates the replicated array to reflect its contents. Clients receive the array and reconstruct their local copy of the map from that.</p><hr><h2 class=heading id=step-1---define-key-value-struct>Step 1 - Define key-value struct
<a class=anchor href=#step-1---define-key-value-struct>#</a></h2><p>Suppose you want to replicate a <code>TMap&lt;uint32, float></code>. First, define a <code>USTRUCT</code> holding the key-value pair:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 1</span><span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 2</span><span><span style=color:#cdcd00>struct</span> <span style=color:#00cdcd>FUnsignedIntFloatEntry</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 4</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 6</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 7</span><span>    uint32 Key <span style=color:#39c>=</span> <span style=color:#cd00cd>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 9</span><span>    UPROPERTY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">10</span><span>    <span style=color:#00cd00>float</span> Value <span style=color:#39c>=</span> <span style=color:#cd00cd>0.f</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">11</span><span>};
</span></span></code></pre></div><hr><h2 class=heading id=step-2---declare-replicated-array-and-local-map>Step 2 - Declare replicated array and local map
<a class=anchor href=#step-2---declare-replicated-array-and-local-map>#</a></h2><p>Now define both your replicated array and the actual map you’ll use internally:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">1</span><span>UPROPERTY(ReplicatedUsing <span style=color:#39c>=</span> OnRep_UnsignedIntFloatArrays)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">2</span><span>TArray<span style=color:#39c>&lt;</span>FUnsignedIntFloatEntry<span style=color:#39c>&gt;</span> UnsignedIntFloatArrays;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">4</span><span>UPROPERTY(Transient)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">5</span><span>TMap<span style=color:#39c>&lt;</span>uint32, <span style=color:#00cd00>float</span><span style=color:#39c>&gt;</span> UniqueIdToFloatMap;
</span></span></code></pre></div><hr><h2 class=heading id=step-3---populate-your-map-on-the-server>Step 3 - Populate your map on the server
<a class=anchor href=#step-3---populate-your-map-on-the-server>#</a></h2><p>Here’s an example where we grab random actors in the world and assign random float values to build the map:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 1</span><span><span style=color:#cdcd00>if</span> (<span style=color:#39c>!</span>HasAuthority()) <span style=color:#cdcd00>return</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 3</span><span>TArray<span style=color:#39c>&lt;</span>AActor<span style=color:#39c>*&gt;</span> ActorsInWorld;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 4</span><span>UGameplayStatics<span style=color:#39c>::</span>GetAllActorsOfClass(<span style=color:#cdcd00>this</span>, AActor<span style=color:#39c>::</span>StaticClass(), ActorsInWorld);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 6</span><span><span style=color:#cdcd00>for</span> (<span style=color:#00cd00>int</span> I <span style=color:#39c>=</span> <span style=color:#cd00cd>0</span>; I <span style=color:#39c>&lt;</span> <span style=color:#cd00cd>10</span>; <span style=color:#39c>++</span>I)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 7</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 8</span><span>    <span style=color:#cdcd00>const</span> int32 RandomIdx <span style=color:#39c>=</span> FMath<span style=color:#39c>::</span>RandRange(<span style=color:#cd00cd>0</span>, ActorsInWorld.Num() <span style=color:#39c>-</span> <span style=color:#cd00cd>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">10</span><span>    <span style=color:#cdcd00>const</span> uint32 RandomChosenActorUniqueId <span style=color:#39c>=</span> ActorsInWorld[RandomIdx]<span style=color:#39c>-&gt;</span>GetUniqueID();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">11</span><span>    <span style=color:#cdcd00>const</span> <span style=color:#00cd00>float</span> RandomFloat <span style=color:#39c>=</span> FMath<span style=color:#39c>::</span>FRand();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">12</span><span>    UniqueIdToFloatMap.Emplace(RandomChosenActorUniqueId, RandomFloat);  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">13</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">15</span><span><span style=color:#cdcd00>const</span> TArray<span style=color:#39c>&lt;</span>TPair<span style=color:#39c>&lt;</span>uint32, <span style=color:#00cd00>float</span><span style=color:#39c>&gt;&gt;&amp;</span> PairArray <span style=color:#39c>=</span> UniqueIdToFloatMap.Array();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">16</span><span><span style=color:#cdcd00>for</span> (<span style=color:#cdcd00>const</span> TPair<span style=color:#39c>&lt;</span>uint32, <span style=color:#00cd00>float</span><span style=color:#39c>&gt;&amp;</span> Pair : PairArray)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">17</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">18</span><span>    FUnsignedIntFloatEntry Entry;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">19</span><span>    Entry.Key <span style=color:#39c>=</span> Pair.Key;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">20</span><span>    Entry.Value <span style=color:#39c>=</span> Pair.Value;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">22</span><span>    UE_LOG(LogTemp, Warning, TEXT(<span style=color:#cd0000>&#34;%s - Key: %d, Value: %f&#34;</span>), <span style=color:#39c>*</span>NetModeToString(), Pair.Key, Pair.Value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">23</span><span>    UnsignedIntFloatArrays.Emplace(MoveTemp(Entry));
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">24</span><span>}
</span></span></code></pre></div><p>The important part: only <code>UnsignedIntFloatArrays</code> is replicated. Once it updates, the client receives the notification.</p><hr><h2 class=heading id=step-4---rebuild-the-map-on-client-using-repnotify>Step 4 - Rebuild the map on client using RepNotify
<a class=anchor href=#step-4---rebuild-the-map-on-client-using-repnotify>#</a></h2><p>The client receives the updated array, and reconstructs its own local map:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">1</span><span>UniqueIdToFloatMap.Reset();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">3</span><span><span style=color:#cdcd00>for</span> (<span style=color:#cdcd00>const</span> FUnsignedIntFloatEntry<span style=color:#39c>&amp;</span> Entry : UnsignedIntFloatArrays)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">4</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">5</span><span>    UE_LOG(LogTemp, Warning, TEXT(<span style=color:#cd0000>&#34;%s - Key: %d, Value: %f&#34;</span>), <span style=color:#39c>*</span>NetModeToString(), Entry.Key, Entry.Value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">6</span><span>    UniqueIdToFloatMap.Emplace(Entry.Key, Entry.Value);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">7</span><span>}
</span></span></code></pre></div><hr><p>And that’s it - you’ve successfully replicated a <code>TMap</code> manually.</p><pre tabindex=0><code>Warning LogTemp AddMapEntry
Warning LogTemp ListenServer - Key: 141843, Value: 0.205267
Warning LogTemp ListenServer - Key: 102850, Value: 0.510819
Warning LogTemp ListenServer - Key: 141885, Value: 0.806024
Warning LogTemp ListenServer - Key: 141881, Value: 0.757683
Warning LogTemp ListenServer - Key: 102854, Value: 0.755730
Warning LogTemp ListenServer - Key: 103198, Value: 0.526231
Warning LogTemp ListenServer - Key: 141865, Value: 0.435102
Warning LogTemp ListenServer - Key: 141839, Value: 0.839351
Warning LogTemp OnRep_UnsignedIntFloatArrays
Warning LogTemp Client - Key: 141843, Value: 0.205267
Warning LogTemp Client - Key: 102850, Value: 0.510819
Warning LogTemp Client - Key: 141885, Value: 0.806024
Warning LogTemp Client - Key: 141881, Value: 0.757683
Warning LogTemp Client - Key: 102854, Value: 0.755730
Warning LogTemp Client - Key: 103198, Value: 0.526231
Warning LogTemp Client - Key: 141865, Value: 0.435102
Warning LogTemp Client - Key: 141839, Value: 0.839351
</code></pre><hr><h1 class=heading id=approach-2---custom-netserialize>Approach 2 - Custom NetSerialize
<a class=anchor href=#approach-2---custom-netserialize>#</a></h1><p>This approach takes a bit more work, but offers far more flexibility and cleaner code.</p><p>The idea: wrap your <code>TMap</code> inside a custom <code>USTRUCT</code>, and override Unreal’s <code>NetSerialize()</code> function to manually define how it should serialize across the network.</p><hr><h2 class=heading id=step-1---declare-your-wrapper-struct>Step 1 - Declare your wrapper struct
<a class=anchor href=#step-1---declare-your-wrapper-struct>#</a></h2><p>We’ll wrap our <code>TMap</code> and disable default replication on it:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">1</span><span>USTRUCT()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">2</span><span><span style=color:#cdcd00>struct</span> <span style=color:#00cdcd>FUnsignedIntFloatMapWrapper</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">4</span><span>    GENERATED_BODY()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">6</span><span>    UPROPERTY(NotReplicated)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">7</span><span>    TMap<span style=color:#39c>&lt;</span>uint32, <span style=color:#00cd00>float</span><span style=color:#39c>&gt;</span> WrappedMap;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">8</span><span>};
</span></span></code></pre></div><blockquote><p>Note: if you forget <code>NotReplicated</code>, Unreal’s header tool will still complain about unsupported types!</p></blockquote><p><p><img src=/posts/tmap_replication/unsupported_tmap_in_struct.png alt="Unsupported TMap in Struct"></p></p><hr><h2 class=heading id=step-2---tell-unreal-to-expect-netserialize>Step 2 - Tell Unreal to expect NetSerialize()
<a class=anchor href=#step-2---tell-unreal-to-expect-netserialize>#</a></h2><p>We now define a type trait to let Unreal know our struct implements custom serialization:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">1</span><span><span style=color:#cdcd00>template</span> <span style=color:#39c>&lt;&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">2</span><span><span style=color:#cdcd00>struct</span> <span style=color:#00cdcd>TStructOpsTypeTraits</span><span style=color:#39c>&lt;</span>FUnsignedIntFloatMapWrapper<span style=color:#39c>&gt;</span> <span style=color:#39c>:</span> TStructOpsTypeTraitsBase2<span style=color:#39c>&lt;</span>FUnsignedIntFloatMapWrapper<span style=color:#39c>&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">4</span><span>    <span style=color:#cdcd00>enum</span> { WithNetSerializer <span style=color:#39c>=</span> <span style=color:#cd00cd>true</span> };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">5</span><span>};
</span></span></code></pre></div><blockquote><p>You may see your IDE warn you that <code>NetSerialize()</code> is not implemented yet - that&rsquo;s expected.</p></blockquote><p><p><img src=/posts/tmap_replication/missing_type_traits.png alt="Missing NetSerialize() type trait" title="Which leads us to..."></p></p><hr><h2 class=heading id=step-3---implement-netserialize>Step 3 - Implement NetSerialize()
<a class=anchor href=#step-3---implement-netserialize>#</a></h2><p>Let’s quickly understand what <code>FArchive</code> is.</p><p>Unreal uses <code>FArchive</code> as a low-level stream abstraction for many systems - including replication, asset cooking, file saves, etc.</p><p>Within <code>NetSerialize()</code>, we’ll:</p><ul><li>Send the map’s length first.</li><li>Serialize each key-value pair.</li><li>Handle both writing (<code>IsSaving()</code>) and reading (<code>IsLoading()</code>).</li></ul><p>Here’s the full implementation:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 1</span><span><span style=color:#00cd00>bool</span> NetSerialize(FArchive<span style=color:#39c>&amp;</span> Ar, UPackageMap<span style=color:#39c>*</span> Map, <span style=color:#00cd00>bool</span><span style=color:#39c>&amp;</span> bOutSuccess)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 2</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 3</span><span>    int32 MapLength <span style=color:#39c>=</span> WrappedMap.Num();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 4</span><span>    Ar <span style=color:#39c>&lt;&lt;</span> MapLength;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 6</span><span>    <span style=color:#cdcd00>if</span> (Ar.IsLoading())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 7</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 8</span><span>        WrappedMap.Empty(MapLength);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 9</span><span>        <span style=color:#cdcd00>for</span> (<span style=color:#00cd00>int</span> I <span style=color:#39c>=</span> <span style=color:#cd00cd>0</span>; I <span style=color:#39c>&lt;</span> MapLength; <span style=color:#39c>++</span>I)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">10</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">11</span><span>            uint32 TempKey;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">12</span><span>            <span style=color:#00cd00>float</span> TempValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">13</span><span>            Ar <span style=color:#39c>&lt;&lt;</span> TempKey;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">14</span><span>            Ar <span style=color:#39c>&lt;&lt;</span> TempValue;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">15</span><span>            WrappedMap.Emplace(TempKey, TempValue);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">16</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">17</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">18</span><span>    <span style=color:#cdcd00>else</span> <span style=color:#cdcd00>if</span> (Ar.IsSaving())
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">19</span><span>    {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">20</span><span>        <span style=color:#cdcd00>for</span> (TPair<span style=color:#39c>&lt;</span>uint32, <span style=color:#00cd00>float</span><span style=color:#39c>&gt;&amp;</span> Pair : WrappedMap)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">21</span><span>        {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">22</span><span>            Ar <span style=color:#39c>&lt;&lt;</span> Pair.Key;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">23</span><span>            Ar <span style=color:#39c>&lt;&lt;</span> Pair.Value;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">24</span><span>        }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">25</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">26</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">27</span><span>    bOutSuccess <span style=color:#39c>=</span> <span style=color:#cd00cd>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">28</span><span>    <span style=color:#cdcd00>return</span> <span style=color:#cd00cd>true</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">29</span><span>}
</span></span></code></pre></div><hr><h2 class=heading id=step-4---use-your-struct-in-rpcs>Step 4 - Use your struct in RPCs
<a class=anchor href=#step-4---use-your-struct-in-rpcs>#</a></h2><p>Because it&rsquo;s now fully serializable, you can easily pass it inside RPCs:</p><div class=highlight><pre tabindex=0 style=color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 1</span><span>FUnsignedIntFloatMapWrapper WrappedUnsignedIntFloatMap;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 3</span><span>TArray<span style=color:#39c>&lt;</span>AActor<span style=color:#39c>*&gt;</span> ActorsInWorld;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 4</span><span>UGameplayStatics<span style=color:#39c>::</span>GetAllActorsOfClass(<span style=color:#cdcd00>this</span>, AActor<span style=color:#39c>::</span>StaticClass(), ActorsInWorld);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 6</span><span><span style=color:#cdcd00>for</span> (<span style=color:#00cd00>int</span> I <span style=color:#39c>=</span> <span style=color:#cd00cd>0</span>; I <span style=color:#39c>&lt;</span> <span style=color:#cd00cd>10</span>; <span style=color:#39c>++</span>I)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 7</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 8</span><span>    <span style=color:#cdcd00>const</span> int32 RandomIdx <span style=color:#39c>=</span> FMath<span style=color:#39c>::</span>RandRange(<span style=color:#cd00cd>0</span>, ActorsInWorld.Num() <span style=color:#39c>-</span> <span style=color:#cd00cd>1</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666"> 9</span><span>    <span style=color:#cdcd00>const</span> uint32 RandomChosenActorUniqueId <span style=color:#39c>=</span> ActorsInWorld[RandomIdx]<span style=color:#39c>-&gt;</span>GetUniqueID();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">10</span><span>    <span style=color:#cdcd00>const</span> <span style=color:#00cd00>float</span> RandomFloat <span style=color:#39c>=</span> FMath<span style=color:#39c>::</span>FRand();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">11</span><span>    WrappedUnsignedIntFloatMap.WrappedMap.Emplace(RandomChosenActorUniqueId, RandomFloat);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">12</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#666">14</span><span>Client_UpdateWrappedUnsignedIntFloatMap(WrappedUnsignedIntFloatMap);
</span></span></code></pre></div><p>And that&rsquo;s it!</p><pre tabindex=0><code>Warning LogTemp Server_UpdateWrappedUnsignedIntFloat_Implementation
Warning LogTemp ListenServer - Key: 102882, Value: 0.963286
Warning LogTemp ListenServer - Key: 103196, Value: 0.561937
Warning LogTemp ListenServer - Key: 141897, Value: 0.334910
Warning LogTemp ListenServer - Key: 103223, Value: 0.789727
Warning LogTemp ListenServer - Key: 141845, Value: 0.871975
Warning LogTemp ListenServer - Key: 102850, Value: 0.330668
Warning LogTemp ListenServer - Key: 103206, Value: 0.947081
Warning LogTemp ListenServer - Key: 141879, Value: 0.844203
Warning LogTemp ListenServer - Key: 141856, Value: 0.412580
Warning LogTemp Client_UpdateWrappedUnsignedIntFloatMap_Implementation
Warning LogTemp Client - Key: 102882, Value: 0.963286
Warning LogTemp Client - Key: 103196, Value: 0.561937
Warning LogTemp Client - Key: 141897, Value: 0.334910
Warning LogTemp Client - Key: 103223, Value: 0.789727
Warning LogTemp Client - Key: 141845, Value: 0.871975
Warning LogTemp Client - Key: 102850, Value: 0.330668
Warning LogTemp Client - Key: 103206, Value: 0.947081
Warning LogTemp Client - Key: 141879, Value: 0.844203
Warning LogTemp Client - Key: 141856, Value: 0.412580
</code></pre><hr><h1 class=heading id=conclusion>Conclusion
<a class=anchor href=#conclusion>#</a></h1><p>While Unreal doesn’t support replicating <code>TMap</code> out-of-the-box, you can still work around it depending on your needs:</p><ul><li>The <strong>array approach</strong> is simple, easy to integrate with native replication, and perfectly valid if your map changes infrequently.</li><li>The <strong>NetSerialize() approach</strong> gives you much tighter control, cleaner encapsulation, and allows you to pass entire maps directly inside RPC calls.</li></ul><p>Both approaches showcase how flexible Unreal’s replication system can be once you dig into custom serialization.</p><p>Whichever you choose depends on your use case - how large your map is, how often it changes, and how much control you need.</p><p>Thanks for reading! I hope this helps anyone looking to replicate <code>TMap</code>s or just exploring Unreal’s replication internals.</p><p>See you next time!</p></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=rezonated/portfolio-workspace data-repo-id=R_kgDOO7BdjA data-category data-category-id=DIC_kwDOO7BdjM4Crcmc data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=dark data-lang=en data-loading=lazy crossorigin=anonymous async></script></div></div></main></div><footer></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script><script src=https://code.jquery.com/jquery-3.6.0.min.js></script><script src=/js/lastfm.js></script></html>